本视频讲述了**React协调器的新架构Fiber与代数效应的关系**，通过虚构语法演示副作用分离机制，并解释Fiber如何实现异步可中断更新及优先级调度。

![[b1faef95428210e8c99e9fb2deca9f6a_MD5.webp]]

### 代数效应
[00:26](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=26)

- 概念定义  
    `代数效应`是*函数式编程*中的一个概念，用于**将副作用从函数调用中分离**。
- 虚构示例说明
    - 函数 getTotalPictureNumber 接收两个用户名并返回其图片数量之和。
    - 图片数量获取封装在 getPictureNumber方法内部，不破坏主流程同步逻辑。
    - 使用虚构关键字 perform 和 try handle 捕获副作用。

#### 代数效应的执行机制 
[02:33](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=153)

- 关键词介绍
    - `perform name`：表示当前需要处理的副作用。
    - `try handle`：捕获 `perform` 并进行处理。
- 执行流程
    - 类似于 `try catch`，但 `perform` 被处理后可通过 `resume` 返回原调用栈继续执行。
    - 示例中 `perform "卡送"` 被 handle 后通过 `resume 123` 回到原处继续计算。

### 代数效应在React中的体现 
[04:52](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=292)

- React Hooks示例
    - 使用 `useState` 返回状态值和更新方法。
    - *组件只需关注展示与更新逻辑，状态存储细节由React处理*。
- 异步组件示例
    - 组件 `ProfilePage` 包含两个子组件 `ProfileDetails` 和 `ProfileTimely`。
    - *子组件同步写法，异步请求和加载状态由React处理*。
    - *体现了代数效应的核心思想：副作用隔离*。

### Fiber架构与代数效应的关系 
[06:03](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=363)

- 异步可中断更新原理
    - 在 `getTotalPictureNumber` 执行过程中，遇到 `perform name` 后暂停执行。
    - `handle` 处理完成后通过 `resume` 恢复执行，实现任务中断与恢复。
    - 此机制正是Fiber架构实现异步可中断更新的基础。

### Fiber架构的设计初衷 
[06:54](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=414)

- Fiber的定义与背景
    - `Fiber` 是操作系统中 *“纤程”* 的一种实现，*与进程、线程、协程同属程序执行过程、模型*。
    - JS中已有类似实现为 Generator，协程。
- *为何不使用Generator？*
    - Generator具有传染性，影响整个调用链的同步特性。
    - 无法支持多优先级更新机制。
- Fiber架构的目标
    - 支持中断并继续的更新过程。
    - 支持不同优先级的任务，高优先级可打断低优先级任务。
- 结论
    - 基于以上原因，React团队决定自行实现Fiber架构。