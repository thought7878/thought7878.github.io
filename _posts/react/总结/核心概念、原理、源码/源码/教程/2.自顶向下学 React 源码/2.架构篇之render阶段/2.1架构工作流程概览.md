本视频讲述了React首屏渲染的整体架构流程，包括调度器、协调器和渲染器三个核心模块的工作内容及执行顺序，并通过调用栈分析了创建根Fiber节点、协调阶段（render）、提交阶段（commit）的具体实现路径。

![[_posts/react/总结/核心概念、原理、源码/源码/教程/2.自顶向下学 React 源码/2.架构篇之render阶段/media/5c00c28694b3ab146cc553f7cf8ff9d6_MD5.webp]]

- 进入架构篇与工作流程概览 [00:15](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=15)
    
    - 开始讲解React源码的架构部分，首先对首屏渲染的整体工作流程进行概览。
- 测试项目调试与入口函数定位 [00:19](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=19)
    
    - 执行测试项目 `Young start`，使用调试工具进入 `perform` 面板记录刷新页面行为。
    - 定位首屏渲染入口函数，位于 `src/index.js` 中的 `render` 方法。
- 首屏渲染流程的三部分划分 [01:11](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=71)
    
    - 整个 `render` 调用栈分为三大部分，分别对应：
        - 调度器（Scheduler）
        - 协调器（Reconciler）
        - 渲染器（Renderer）
- 第一部分：创建 Fiber 根节点 [01:41](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=101)
    
    - 函数名显示该部分主要作用是创建根 Fiber 节点。
    - 首次执行 `ReactDOM.render` 时会创建整个应用的根节点 `fiber root node`。
    - 在调用栈中发现 `createHostRootFiber`方法，猜测其为创建根 Fiber 的方法。
    - 打断点查看传入参数 `tag` 为 `3`，确认其代表 `host root` 类型。
- 第二部分：事件监听与调度更新 [03:33](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=213)
    
    - 出现 `listenToReactEvent` 和 `listenToNativeEvent`，推测与初始化事件系统有关。
    - 后续调用 `scheduleUpdateOnFiber` 表示需要调度本次更新。
    - 更新成功后执行 `performSyncWorkOnRoot`，表示从根节点开始执行更新任务。
- 第三部分：协调器的执行过程 [04:22](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=262)
    
    - 协调器内部流程可类比递归，分为“递”阶段和“归”阶段。
    - “递”阶段调用 `beginWork` 方法。
    - “归”阶段调用 `completeWork` 方法。
    - 两次 `beginWork` 对应两次 `completeWork`，体现 Fiber 树的递归构建过程。
    - 整个 `renderRootSync` 方法的执行即为协调器工作的核心。
- 渲染器的执行入口与阶段划分 [05:18](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=318)
    
    - 渲染器工作的入口方法名为 `commitRoot`。
    - 工作流程分为三个子阶段：
        - `commitBeforeMutationEffects`：DOM操作前阶段
        - `commitMutationEffects`：DOM操作阶段
        - 提交完成后：DOM操作后阶段
    - 浏览器环境下，“mutation”特指 DOM 操作。
- 课程总结与下一节预告 [06:21](https://b.quark.cn/apps/5AZ7aRopS/routes/quark-video-ai-summary/pc?debug=0&fid=24a5c265c54f495bba51ddb53eeec646#?seek_t=381)
    
    - React 的整体工作流程并不复杂，后续章节将逐步深入讲解 JSX、Fiber 构建、协调机制等源码细节。
    - 下一节将重点讲解 JSX 这种数据结构，为后续源码学习打下基础。