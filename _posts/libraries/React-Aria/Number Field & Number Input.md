# useNumberFieldState

`react-stately` 是一个由 Adobe 开发的库，它为 UI 组件提供了可复用的状态管理和行为逻辑。`react-stately` 并*不直接处理渲染逻辑，而是提供状态管理功能*，可以被不同的 UI 框架和库（如 React, Vue, Angular 等）使用。

`useNumberFieldState` 是 `react-stately` 中的一个 Hook，**用于管理数字输入字段（Number Field）的状态**。这个 Hook 通常与 `NumberField` 组件一起使用，该组件可以是任何框架的实现，比如 `@react-aria/numberfield` 提供了基于 ARIA 的 NumberField 的行为。

## 为什么要使用 useNumberFieldState

- **简化开发:** 提供了开箱即用的数字输入功能，减少了开发者的工作量。
- **提高可访问性:** 确保数字输入框符合 WCAG 规范，提升用户体验。
- **增强可定制性:** 提供了丰富的选项，可以根据需求定制数字输入框的行为。

## `useNumberFieldState` 的主要功能包括：

1. **状态管理**：管理数值、最小值、最大值、步长等。
2. **验证**：确保输入的值在允许的范围内，并符合指定的格式。
3. **响应式更新**：当状态改变时触发更新。
4. **格式化:** 可以自定义数字的格式化方式，例如添加千分位分隔符、小数位数等。
5. **键盘导航:** 支持使用上下键调整数值。

### 使用示例：

```jsx
import { useNumberFieldState } from "@react-stately/numberfield";

function MyNumberField() {
  let state = useNumberFieldState({
    minValue: 0,
    maxValue: 100,
    defaultValue: 50,
  });

  // ... 接下来你可以使用 state 来控制 NumberField 的行为
}
```

在这个例子中，`useNumberFieldState` 创建了一个数字输入字段的状态，设置了最小值、最大值和默认值。然后你可以使用返回的状态对象来控制和响应数值的变化。

请注意，为了完整地实现一个可交互的数字输入框，你还需要使用来自 `@react-aria/numberfield` 的 `useNumberField` Hook 来生成必要的 ARIA 属性，以及一些 DOM 元素来渲染实际的界面。

## API

```ts
useNumberFieldState(props: NumberFieldStateOptions): NumberFieldState
```

### NumberFieldStateOptions

它定义了 `useNumberFieldState` Hook 的配置选项。*这些选项用于初始化数字输入字段的状态*，并控制其行为。

#### `NumberFieldStateOptions` 类型通常包含以下属性：

1. **`value`**: (`number | undefined`) 当前数值。如果未设置，则使用 `defaultValue` 或 `minValue`。
2. **`defaultValue`**: (`number | undefined`) 默认数值，当 `value` 未设置时使用。
3. **`minValue`**: (`number | undefined`) 数值的最小限制。
4. **`maxValue`**: (`number | undefined`) 数值的最大限制。
5. **`step`**: (`number | undefined`) 数值变化的步长。
6. **`isDisabled`**: (`boolean`) 是否禁用输入字段。
7. **`isRequired`**: (`boolean`) 是否是必填项。
8. **`isValid`**: (`boolean | undefined`) 是否有效。如果未设置，则会根据 `minValue` 和 `maxValue` 进行验证。
9. **`formatOptions`**: (`Intl.NumberFormatOptions | undefined`) 国际化格式化选项，用于显示和解析数值。[Intl.NumberFormatOptions文档](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat/NumberFormat)
10. **`parseOptions`**: (`Object | undefined`) 自定义解析选项，用于解析用户输入的字符串。
11. **`onChange`**: (`(value: number | undefined) => void`) 值变化时的回调函数。

#### 示例代码：

```jsx
import { useNumberFieldState } from "@react-stately/numberfield";

function MyNumberField() {
  const state = useNumberFieldState({
    minValue: 0,
    maxValue: 100,
    step: 1,
    defaultValue: 50,
    isDisabled: false,
    isRequired: true,
    formatOptions: {
      style: "decimal",
      minimumFractionDigits: 0,
      maximumFractionDigits: 0,
    },
  });

  // ... 使用 state 来控制 NumberField 的行为
}
```

在这个示例中，我们设置了 `minValue`、`maxValue` 和 `defaultValue`，并定义了一些其他属性，例如是否禁用、是否必填，以及如何格式化数值。

通过使用 `useNumberFieldState` 和相应的配置选项，你可以创建一个具有特定行为和格式的数字输入字段。这些配置选项使你能够根据需要定制输入字段的行为。



|                      |                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |           |                                                                                                                                                                                                                                                                                                                                             |
| -------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `locale`             | `[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)`                                                                                                                                                                                                                                                                                                                                                                                                                       | `'en-US'` | The locale that should be used for parsing.  <br>应该用于分析的区域设置。                                                                                                                                                                                                                                                                               |
| `formatOptions`      | `[Intl.NumberFormatOptions](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Intl/NumberFormat/NumberFormat)`                                                                                                                                                                                                                                                                                                                                                                       | —         | Formatting options for the value displayed in the number field. This also affects what characters are allowed to be typed by the user.  <br>选择数字字段中显示的值的选项。这也会影响允许用户键入的字符。                                                                                                                                                                  |
| `isDisabled`         | `[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)`                                                                                                                                                                                                                                                                                                                                                                                                                     | —         | Whether the input is disabled.  <br>输入是否被禁用。                                                                                                                                                                                                                                                                                                |
| `isReadOnly`         | `[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)`                                                                                                                                                                                                                                                                                                                                                                                                                     | —         | Whether the input can be selected but not changed by the user.  <br>输入是否可以被选择但不能被用户改变。                                                                                                                                                                                                                                                      |
| `isRequired`         | `[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)`                                                                                                                                                                                                                                                                                                                                                                                                                     | —         | Whether user input is required on the input before form submission.  <br>表单送出前，是否需要使用者输入。                                                                                                                                                                                                                                                   |
| `isInvalid`          | `[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)`                                                                                                                                                                                                                                                                                                                                                                                                                     | —         | Whether the input value is invalid.  <br>输入值是否无效。                                                                                                                                                                                                                                                                                           |
| `validationBehavior` | `'aria' \| 'native'`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | `'aria'`  | Whether to use native HTML form validation to prevent form submission when the value is missing or invalid, or mark the field as required or invalid via ARIA.  <br>是否使用本地HTML表单验证来防止值缺失或无效时提交表单，或者通过ARIA将字段标记为必填或无效。                                                                                                                       |
| `validate`           | `(value: [number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)) => [ValidationError](https://react-spectrum.adobe.com/react-stately/useNumberFieldState.html#/tmp/827df33ce4b0199e40d518d07d7acd9e/node_modules/@react-types/shared/src/inputs.d.ts:ValidationError) \| true \| [null](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/null) \| [undefined](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/undefined)` | —         | A function that returns an error message if a given value is invalid. Validation errors are displayed to the user when the form is submitted if `validationBehavior="native"`. For realtime validation, use the `isInvalid` prop instead.  <br>如果给定值无效，则返回错误消息的函数。如果`validationBehavior=“native”，`则在提交表单时向用户显示验证错误。对于实时验证，请使用`isInvalid`属性。 |
| `autoFocus`          | `[boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)`                                                                                                                                                                                                                                                                                                                                                                                                                     | —         | Whether the element should receive focus on render.  <br>元素是否应在呈现时接收焦点。                                                                                                                                                                                                                                                                     |
| `onFocus`            | `(e: [FocusEvent](https://developer.mozilla.org/docs/Web/API/FocusEvent)<Target>) => void`                                                                                                                                                                                                                                                                                                                                                                                                                          | —         | Handler that is called when the element receives focus.  <br>当元素获得焦点时调用的对象。                                                                                                                                                                                                                                                                 |
| `onBlur`             | `(e: [FocusEvent](https://developer.mozilla.org/docs/Web/API/FocusEvent)<Target>) => void`                                                                                                                                                                                                                                                                                                                                                                                                                          | —         | Handler that is called when the element loses focus.  <br>当元素失去焦点时调用的对象。                                                                                                                                                                                                                                                                    |
| `onFocusChange`      | `(isFocused: [boolean](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean)) => void`                                                                                                                                                                                                                                                                                                                                                                                                | —         | Handler that is called when the element's focus status changes.  <br>当元素的焦点状态更改时调用的对象。                                                                                                                                                                                                                                                      |
| `onKeyDown`          | `(e: [KeyboardEvent](https://react-spectrum.adobe.com/react-stately/useNumberFieldState.html#/tmp/827df33ce4b0199e40d518d07d7acd9e/node_modules/@react-types/shared/src/events.d.ts:KeyboardEvent)) => void`                                                                                                                                                                                                                                                                                                        | —         | Handler that is called when a key is pressed.  <br>当按下某个键时调用的对象。                                                                                                                                                                                                                                                                            |
| `onKeyUp`            | `(e: [KeyboardEvent](https://react-spectrum.adobe.com/react-stately/useNumberFieldState.html#/tmp/827df33ce4b0199e40d518d07d7acd9e/node_modules/@react-types/shared/src/events.d.ts:KeyboardEvent)) => void`                                                                                                                                                                                                                                                                                                        | —         | Handler that is called when a key is released.  <br>释放键时调用的对象。                                                                                                                                                                                                                                                                              |
| `placeholder`        | `[string](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String)`                                                                                                                                                                                                                                                                                                                                                                                                                       | —         | Temporary text that occupies the text input when it is empty.  <br>当文本输入为空时占用文本输入的临时文本。                                                                                                                                                                                                                                                     |
| `value`              | `[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)`                                                                                                                                                                                                                                                                                                                                                                                                                       | —         | The current value (controlled).  <br>当前值（受控）。                                                                                                                                                                                                                                                                                               |
| `defaultValue`       | `[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)`                                                                                                                                                                                                                                                                                                                                                                                                                       | —         | The default value (uncontrolled).  <br>默认值（不受控制）。                                                                                                                                                                                                                                                                                           |
| `onChange`           | `(value: T) => void`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | —         | Handler that is called when the value changes.  <br>值更改时调用的函数。                                                                                                                                                                                                                                                                              |
| `minValue`           | `[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)`                                                                                                                                                                                                                                                                                                                                                                                                                       | —         | The smallest value allowed for the input.  <br>输入允许的最小值。                                                                                                                                                                                                                                                                                    |
| `maxValue`           | `[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)`                                                                                                                                                                                                                                                                                                                                                                                                                       | —         | The largest value allowed for the input.  <br>输入允许的最大值。                                                                                                                                                                                                                                                                                     |
| `step`               | `[number](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number)`                                                                                                                                                                                                                                                                                                                                                                                                                       | —         | The amount that the input value changes with each increment or decrement "tick".  <br>输入值随每次增量或减量“滴答”而变化的量。                                                                                                                                                                                                                                 |
| `label`              | `[ReactNode](https://reactjs.org/docs/rendering-elements.html)`                                                                                                                                                                                                                                                                                                                                                                                                                                                     | —         | The content to display as the label.  <br>要显示为标签的内容。                                                                                                                                                                                                                                                                                        |
| `description`        | `[ReactNode](https://reactjs.org/docs/rendering-elements.html)`                                                                                                                                                                                                                                                                                                                                                                                                                                                     | —         | A description for the field. Provides a hint such as specific requirements for what to choose.  <br>字段的说明。提供提示，例如选择内容的具体要求。                                                                                                                                                                                                                 |
| `errorMessage`       | `[ReactNode](https://reactjs.org/docs/rendering-elements.html) \| (v: [ValidationResult](https://react-spectrum.adobe.com/react-stately/useNumberFieldState.html#/tmp/827df33ce4b0199e40d518d07d7acd9e/node_modules/@react-types/shared/src/inputs.d.ts:ValidationResult)) => [ReactNode](https://reactjs.org/docs/rendering-elements.html)`                                                                                                                                                                        | —         | An error message for the field.  <br>字段的错误消息。                                                                                                                                                                                                                                                                                               |