

视频讲述了如何**实现对index.html文件的自动失效、无效化**操作，具体如下：


- **手动失效操作的局限性**：[00:00]每次部署应用程序时，*手动创建失效操作繁琐*，尤其是当修改html文件（如因脚本标签内容哈希变化）时，需要确保提供最新的index.html文件，必须实现自动失效。
- **实现自动失效的方法**：[01:04]通过**添加自动化步骤**，*在GitHub工作流的container.yaml文件中，使用AWS CLI针对index.html文件自动创建失效*，该文件是唯一需要失效的文件。
- **配置自动失效的具体操作**：[01:42]在container.yaml文件中添加步骤，运行aws cloudfront create-invalidation命令，通过环境变量或GitHub仓库密钥设置--distribution-id，*明确指定需要失效的文件路径为/container/latest/index.html*。并确保复制环境部分且缩进对齐，同时为避免凭证暴露，将凭证放在需要的位置而非文件高处。
- **测试自动失效步骤**：[03:42]保存文件后，在github仓库添加新的aws分发密钥（值为云前控制台中的分发id），提交更新的工作流并推送到github，由于GitHub仅在容器目录有更改时重新部署，故需修改容器目录内容（如修改src文件夹下的app.js），再提交推送以触发重建过程，查看终端和GitHub操作标签页验证失效步骤。

```yaml

name: deploy-container

on:
  push:
    branches:
      - main
    paths:
      - 'packages/container/**'

defaults:
  run:
    working-directory: packages/container

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v2
      - run: npm install
      - run: npm run build

      - uses: shinyinc/action-aws-cli@v1.2
      - run: aws s3 sync dist s3://${{ secrets.AWS_S3_BUCKET_NAME }}/container/latest
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: REPLACE_WITH_YOUR_REGION
      # 配置自动失效 index.html
      - run: aws cloudfront create-invalidation --distribution-id ${{ secrets.AWS_DISTRIBUTION_ID }} --paths "/container/latest/index.html"
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: REPLACE_WITH_YOUR_REGION
```