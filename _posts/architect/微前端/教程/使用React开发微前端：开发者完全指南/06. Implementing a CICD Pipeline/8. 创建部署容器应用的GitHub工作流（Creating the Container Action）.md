参考：[[GitHub Actions-QW]]、[[配置]]

视频讲述了如何**创建用于部署容器应用的GitHub工作流**，具体如下：


```yml
# 为工作流命名
name: deploy-container

# 决定工作流运行时机
on:
  # 监听推送事件
  push:
    # 监听main分支的推送事件
    branches:
      - main
    # 仅在packages/container/（容器应用）内发生更改时运行
    paths:
      - "packages/container/**"

# default部分：设置工作目录为packages/container，这将设置执行环境为容器目录，所有将要运行的一系列命令，在容器目录内执行
defaults:
  run:
    working-directory: packages/container

jobs:
  build: # 创建名为build的job
    runs-on: ubuntu-latest # 指定在ubuntu最新版的虚拟机上运行

    steps:
      - uses: actions/checkout@v2 # 从项目检出代码
      - run: npm install # 运行npm install安装依赖
      - run: npm run build # 执行webpack构建生成dist目录

      - uses: shinyinc/action-aws-cli@v1.2 # 使用aws cli工具，将构建文件部署到亚马逊S3
      - run: aws s3 sync dist s3://${{ secrets.AWS_S3_BUCKET_NAME }}/container/latest
        env:
          AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
          AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          AWS_DEFAULT_REGION: ""
```

## 创建工作流的两种方式
[00:00]
一是*前往GitHub仓库的Actions标签，使用预设工作流*；二是*自己构建，可使用内置小型代码编辑器，也可直接**在项目中编写配置文件***。视频选择后者，因个人更喜欢自己的代码编辑器。
![[_posts/architect/微前端/教程/使用React开发微前端：开发者完全指南/06. Implementing a CICD Pipeline/media/6c0d50c3f00ae4d3ec79d0f7c401a59e_MD5.jpeg]]


## 创建工作流的目录和文件
[00:49]
在项目根目录新建`.github文件夹`，其内创建`workflows文件夹`，再在其中创建名为`container.yml的工作流文件`，GitHub会*自动识别该目录下的YAML文件*为需执行的工作流。


## 工作流配置的基本内容
[01:52]
使用`YAML语法`编写，需*注意缩进*。首先*为工作流命名*，如deploy-container；然后*添加`on属性`，决定工作流运行时机*，如*监听master分支的推送事件*，且*仅在容器应用内发生更改时运行*；接着*添加`default部分`*，*设置工作目录为packages/container，这将设置执行环境为容器目录，所有将要运行的一系列命令，在容器目录内执行*。


## 工作流的jobs和steps
[04:50]
*添加`jobs部分`，创建名为build的job，指定在ubuntu最新版的虚拟机上运行*。`steps部分`包括*从项目检出代码*，使用actions/Checkout@v2；*运行npm install安装依赖*；运行npm run build*执行webpack构建生成dist目录*；*使用aws cli工具将构建文件部署到亚马逊S3*，涉及相关配置和命令。


## 后续任务
[09:26]
需*配置aws并创建存储桶*以实际部署应用，后续视频将继续讲解。