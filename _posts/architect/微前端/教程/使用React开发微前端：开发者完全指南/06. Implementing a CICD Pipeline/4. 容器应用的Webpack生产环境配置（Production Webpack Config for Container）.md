

视频讲述了**容器应用的Webpack生产环境配置**过程及相关注意事项，具体如下：


- **开始设置容器应用的webpack生产环境配置**：[00:00]该配置与开发环境配置相似，但有一些细节需注意，将在webpack pro.js文件中添加大量配置，且生产环境会合并common和production文件。
- **引入相关函数和文件**：[00:45]首先引入webpack-merge的merge函数，以便合并配置；引入webpack lib容器模块联邦插件；获取同一目录的common配置webpack.com；从上层目录引入package.json文件，供webpack自动处理所有共享模块。
- **创建prodConfig变量并设置mode**：[01:32]prodConfig为对象，首先设置mode: 'production'，这会让webpack以生产模式运行，对构建的javascript文件进行优化，如压缩代码等，虽运行稍慢，但生成更符合生产环境的构建。
- **设置output**：[01:59]在output中设置filename，使用[name]和[contenthash]（小写h）及.js，每次生产构建时*生成的文件以此模板命名*，包含文件名和文件内容的哈希值，*主要解决缓存问题*。

![[_posts/architect/微前端/教程/使用React开发微前端：开发者完全指南/06. Implementing a CICD Pipeline/media/3085d783f4c0ccc1d555c1574b355a1a_MD5.jpeg]]

- **配置插件列表**：[02:48]需配置模块联邦插件，确保拥有其副本及生产环境特定设置，如远程入口文件的URL指向生产域名而非本地主机。设置容器名称（非必需但建议添加），配置远程源，远程名称需与容器项目中的导入语句匹配。
- **处理远程入口文件URL**：[04:52]创建domain变量，值为process.env，作为环境变量将在构建时通过CI/CD管道设置，以确定生产应用托管位置，从而获取正确远程入口URL。假设营销项目的远程入口文件位于域名下的marketing文件夹中。
- **设置共享依赖项**：[07:27]共享依赖项仍来自package.json的dependencies。
- **合并并导出配置**：[07:42]在文件末尾执行module.exports，合并并导出公共配置和生产配置。
- **处理index.html文件生成**：[08:04]容器应用需要为生产部署创建index.html文件，为确保开发和生产环境都能生成，将webpack.dev.js中的html-webpack-plugin的require语句和相关配置移到webpack.common.js。
- **在package.json添加脚本**：[09:37]添加build脚本，执行webpack --config webpack.prod.js，以便正确构建生产环境。
- **测试构建命令**：[10:21]在终端的容器目录中执行npm run build，检查是否有错误，成功构建后容器目录会生成dist文件夹，包含生产环境构建的所有输出，包括带内容哈希的主js文件、依赖文件和index.html等。
- **后续计划**：[11:35]将在营销项目中重复相同步骤，因已熟悉流程会更快。