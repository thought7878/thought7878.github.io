# 《实战（一）：怎么设计一个"画图"程序？》内容总结

这篇文章由七牛云许式伟撰写，通过一个"画图"程序的实例，*将前面讲解的桌面程序架构理论*应用到实际开发中，帮助读者*理解MVC架构*在实际项目中的应用。

## 选择"画图"程序的原因

- 画图程序比较常见，*需求不需要花费过多时间来陈述*
- 适合*展示桌面程序架构设计的核心思想*
- 可以清晰地*展示单机版和Web版应用的架构差异*

## 程序架构解析

### 整体架构框架
- **Model层**：承载业务逻辑的DOM（文档对象模型）
  - 多用户(Multi-User)的Model层（服务端）
  - 单租户的Session-based Model（浏览器端）
- **View层**：实际是ViewModel层（HTML+CSS+JavaScript）
  - *真正的View层已被浏览器实现*
  - ViewModel*只包含View层的数据和可被委托的事件*
- **Controller层**：由多个相互解耦的Controller构成
  - *Controller之间完全解耦，不应相互知道对方存在*
  - *View不应知道具体Controller的存在*

### 程序实现特点
- **裸写JavaScript代码**：不依赖任何第三方库
  - 消除不同人的喜好差异，避免因不熟悉库而难以理解
  - 强调"不要被框架绑架"，框架不应增加代码耦合
- **执行流程**：
  1. 创建canvas画布对象
  2. 加载DOM对象（未实例化）
  3. 加载View对象，实例化View和DOM对象
  4. View定义事件处理规则，接管画布事件处理
  5. 加载Controller，注册到View并将事件处理委托给Controller
  6. 加载和显示菜单，定义Controller的鼠标点击事件

## 架构设计的核心思想

### 概要设计关键问题
- 每个子系统负责什么事情？
- 它依赖哪些子系统？
- 能否减少对其他子系统的依赖？
- 接口是否自然体现业务关系？
- 接口是否足够稳定？

### MVC架构应用要点
1. **Model层接口设计**：
   - 接口要自然体现业务逻辑
   - 与底层技术解耦（如数据库选择）
   - 应该"做厚"，承载核心业务逻辑

2. **Model与GDI解耦**：
   - 为避免Model知道View实现细节，可让Model耦合GDI接口
   - "如果避免不了耦合，就耦合稳定的模块"（系统模块比业务模块更稳定）

3. **ViewModel的角色**：
   - ViewModel持有Model，并由Controller更新Model/ViewModel
   - ViewModel定义Controller的行为规则，但不关心具体实现
   - ViewModel协调Model和Controller，起到承上启下的作用

4. **Controller设计**：
   - Controller之间必须完全解耦
   - Controller可选择性接管ViewModel的事件
   - 可使用ViewModel作为Controller间通信的中介

## 实战价值

- **验证理论应用**：将前面讲解的MVC架构理论应用到实际项目中
- **展示单机与Web的差异**：虽然基于Web开发，但当前给出的画图程序本质上是单机版
- **强调架构思维**：不被具体技术框架束缚，关注稳定点与变化点的分离

## 核心洞见

- **架构设计本质**：是分解子系统的过程，MVC提供了一个基本框架
- **稳定点与变化点分离**：架构设计的核心原则，与前面章节强调的理念一致
- **Model层的重要性**：认真对待Model层设计，将其"做厚"，能极大提升系统的可维护性和跨平台能力
- **解耦的价值**：Controller之间的解耦、ViewModel与Controller的松耦合，是系统可扩展性的关键

文章最后强调，虽然这一讲基于Web开发，但当前实现的画图程序本质上是单机版的，为下一讲将要介绍的联网版本画图程序做了铺垫。通过这个实例，读者可以更直观地理解前面讲解的桌面程序架构设计原则，特别是MVC各层的职责划分和交互方式。