介绍软件**开发过程与架构的关系是怎样的**，**如何正确地实施架构**，以及**如何在过程中提升团队的能力**。

  
# 在本章中，将分析**项目的三个时期**的**四个层级架构**间的关系

## 三个时期的工作内容：
![](_posts/architect/_教程/前端架构：从入门到微前端/images/ch02/project-workflow.png)

### 技术准备期：开始与架构实施相关的一系列工作，如搭建脚手架、测试及部署等。 
### 业务回补期：填补第一个时期造成的业务进度落后的问题，以技术实践业务来证明技术的价值。 
### 成长优化期：持续地对项目的技术和业务进行优化，以实现开发及业务人员的诉求。 
 

# 2.1 技术负责人与架构 
## 技术负责人（Tech Leader）：是一个项目架构实施的保证。如果开发团队是房屋的建设团队，那么技术负责人便是带着施工队的队长
## 技术负责人日常要做的事情： 
### 适当地平衡业务的进度与技术方案。
### 解决重要、复杂的技术问题。 
### 帮助团队的其他成员成长。 
### 从全局考虑整个项目的技术和业务问题。 

## 作为一个技术负责人，软件架构，需包含的内容：
### （1）技术方案的设计。 
### （2）技术方案的落地。 
### （3）保证技术方案的实施。 
### （4）确保技术方案的上线。 
### （5）关注技术方案的后续维护。 

### 注意：架构方案的设计，或许是最不起眼的一个环节（因为有一定经验的程序员设计的应用架构可能不错）

因此，在整个系统中，**架构方案的设计只是其中的一个环节，或许是最不起眼的环节**。因为**有一定经验的程序员设计出来的应用架构和优秀的程序员设计出来的应用架构，相差也不是很远**。甚至，有可能因为他们的见多识广，反而能设计出更好的架构。**只是设计出来的架构，可能因为能力的问题而不能落地，或者无法维持到最后**。 

## 技术负责人保证架构成功实施的三要素：
### 第一，保证项目在开发过程中的质量
### 第二，提升人员的能力
### 第三，确保应用上线

### 注意：每一个要素都令人头疼，保证三要素的同时推进，需不断在三者之间做平衡
幸运的是，在项目的实施过程中，质量、能力和进度并不是同时展开的，而是按照一定的先后顺序展开的。

# 2.2 技术准备期：探索技术架构
这个阶段的业务与技术的优先级是，技术第一，业务第二。
## 技术准备期的三个关注点： 
### 架构设计，即设计系统的架构。 
### 概念验证，验证先前设计的架构是否可行。 
### 迭代0，搭建系统的基础设施。 

## 2.2.1 架构设计 
### 参考第1章：开始新的项目时，要做大量的技术准备工作——搜索相关的技术资料，评估相关的技术方案

## 2.2.2 概念验证：架构的原型证明 
### 概念验证（Proof of Concept，简称PoC）
#### 定义：从技术上证明架构设计的可行性的阶段

#### 概念验证是对某些想法的一个较短不完整的实现，以证明其可行性，示范其原理，**目的**是验证一些概念或理论

#### **如**，选择了微前端、GraphQL新技术，尝试在项目中使用。就需验证它，看它是否能真正地被用上？ 

#### **做法**：使用新技术写一个简单的“Hello，World!”，将设计的各个部分串联到一起，构建一个完整的、基础的系统
#### 做法例子：计划用微前端+React+Angular开发，第一步是将空白的React和Angular应用结合到一起。从概念上证明它是可行的，下一步才是将现有的应用进行整合

尝试新架构设计前，务必先在业余时间有所实践，再拿到项目中使用。笔者就曾经在项目上经历过这样的事件，我们花费了两三周的时间来证明四种不同的技术方案的优缺点。**由于架构未定，其他成员也不能编写相应的业务代码**，只能尝试练习相关的东西，搭建持续集成等，直到完成相应的架构证明。 
 
在这个概念阶段，我们并不会进行业务代码的编写，只给出简单的架构相关示例。

## 2.2.3 迭代 0：搭建完整环境 
完成概念验证之后，就开始了迭代0。 

### 迭代0（Sprint 0）/ I0（Iteration 0）：在所有迭代之前的准备工作
### 迭代0与概念验证的关系：项目不复杂，概念验证阶段会被列入迭代0的工作范围；项目复杂，概念验证会独立于迭代0。

### 迭代0要做的基本事项： 
#### 创建应用脚手架。 
#### 创建项目的代码库。 
#### 搭建持续集成、持续交付。 
#### 进行各种权限配置，如各种不同的环境账号准备、开发人员的账号配置等。 
#### 配置配套的工具，如代码审查、自动化原生应用上传等。 
#### 更细粒度的技术选型。 
#### 进行内部的技术培训：用于介绍系统的架构、开发注意事项等
当然，即使已经有了相应的培训，**还需要准备基础的架构方面的文档、必要的一些规范**。 
 
#### 进行部署的准备工作，尝试进行第一次测试环境的部署

### 这个阶段结束的标志是：项目成员可以进行正常的项目开发，并且此时的开发方式和未来没有太大的区别


## 2.2.4 示例项目代码：体现规范与原则 
在大部分项目中，经验丰富的开发人员往往只是少数，有些经验丰富的开发人员会分配到重要的项目上，成为新团队的技术负责人，或者某个团队的骨干。往往还存在一定数量的缺少编程经验的程序员，对于这些“年轻”的程序员来说，需要有人能指点其编写代码，以提升团队的平均技术水平，使之能按时完成任务。 

### 编写项目示例代码，**目的**是：
#### 为了规范代码：展现好的编程模式、范式，将它们融入项目中
#### 帮助其他成员了解代码：有了这样一个基本的雏形，哪怕是刚毕业的学生，也能照猫画虎地编写业务代码
### 例如，登录功能，涉及一系列内容：状态管理、网络请求、数据模式、表单提交、UI交互等。
**每个小部分，几乎都是代码级架构**。在日常编码中，**对于这些基本的东西更要花费精力**。稍有不慎，就会与我们最初设计的风格相去甚远。


# 2.3 业务回补期：应对第一次 Deadline（开发步入正轨）
## 架构师的关注点变成，应对第一次Deadline的时机：是当团队成员能正常地开发业务逻辑时

当团队成员能正常地开发业务逻辑时，我们的关注点就变成了：**应对第一次Deadline**。在这个阶段里，业务开发虽然已经进入正轨，但是可能存在一定的进度落后。于是在优先级上变成了业务第一、技术第二。 

这是一个价值证明的阶段，也是调配落后的进度与先进生产力的时期。毕竟欠下的债（业务）总是要还的。如果在上一个阶段中，我们花费了大量的时间在概念证明上，那么必须在这个阶段偿还这些时间。 

在项目开发的过程中，**人员能力不足也是大部分项目都会遇到的问题**。就好像带兵打仗，老兵并不会一直待着，总有走的时候。而随着团队的规模不断扩大，会不断添加新的成员。若是这些新成员的能力不提升，或者提升比较慢，**就会影响项目的进度**。 

此外，由于内部技术的问题已经解决了，内部的业务已经步入正轨，我们开始关注于第三方系统集成，并着手准备应用的测试、第一次上线。


## 2.3.1 追补业务 
### 当技术不再是问题时，关注点便在业务上
### **业务与技术的关系：*技术是实现业务价值的工具***
### **若进度落后**（如概念验证导致），可暂时后置部分技术需求（如降低测试覆盖率），优先保证核心业务按时交付

**先进的架构，并不一定会为业务带来价值；先进的技术，也并不一定会为业务带来价值**。这就是为什么每当我们采用新的架构和技术时，**总需要通过一系列的会议来讨论新的架构是否能够带来更多的价值**。新的架构和技术带来的往往是一些架构上的可能性，它节省的往往是开发时间。**而实施这些新的架构，也会花费一定的开发时间，因此需要适当地计算收益，*以实现业务的最大价值***。如此一来，利益相关者才会考虑架构的价值。在大多数时候，业务人员考虑的是业务价值，进度是他们考虑的第一因素。


## 2.3.2 测试：实践测试策略 
测试人员开始测试的时间：在敏捷项目里，是在项目进行一段时间后才开始的

在敏捷项目里，测试人员真正开始测试，是在项目进行一段时间后才开始的。一方面，前后端之间的联调可能没有完全准备好，无法进行完整的测试。另一方面，可测试的业务内容相对比较少，部分功能可能无法完整地串联起来。随后，便一直在项目中进行日常的功能测试。在上线前，才会进行一次完整的回归测试。 

对于瀑布型项目而言，一个项目的测试和其他项目的测试并没有太大区别。只是在新的项目中，往往也需要大量地准备、熟悉项目、编写测试案例等，才能进入测试的流程。因此，测试人员往往在上线前的几周里才开始进行大规模的测试。 

### 开始进行功能测试，建立测试流程。初期测试覆盖率可能较低，但应设定一个基线（如30%），为后续提升打下基础

### 设计架构时未考虑到的情况，可能在这个阶段出现。如： 
#### 没有进行集成第三方测试，无法验证业务的完整性。 
#### 没有准备好一个稳定的测试环境，以提供给测试人员进行测试。 
#### 没有接近真实的数据，以验证一些极端条件是否会出错。


## 2.3.3 上线准备 
### 准备与第三方系统联调，练习部署流程（尤其是服务端渲染或Docker等复杂场景）。
### 上线准备：小公司要购买相应的服务器，大公司要申请相应的资源、审批流程
### 与第三方系统的联合调试是一种挑战：特别是上线日期临近时，如果遇上Bug，就需反反复复地修改和测试

与此同时，需要根据部署架构练习相关的技术实践。若是计划使用服务端渲染，那么我们需要准备好与Node.js相关的线上调试环境，并让团队拥有基本的调错（debug）能力。若是计划使用Docker，那么也需要不断尝试练习与DevOps相关的技能——哪怕是公司内部拥有相关的DevOps，开发人员也需要拥有基本的能力，才能应对线上的问题。 


## 2.3.4 第一次部署：验证部署架构 
### 第一次部署都会比较痛苦：哪怕有了其他项目经验，一旦一段时间内没有经历过新应用的部署，就有可能出现问题，通常是一些配置问题（如，某个软件升级导致之前的配置出错）
### 应对这些情况的最好方式是：如果能提前尝试使用上线流程，那么就提前走上线流程

对于前端项目来说，部署并不是一个痛苦的事情。大部分应用只是单纯的静态文件，可以直接打包交给后端人员上线，也可以结合Docker进行自动化部署。若是带有服务端渲染的前端应用，部署会稍微麻烦一些，还需要配套对应的进程管理、服务监控等一系列的工具。 

不管怎样，在第一次上线之后，我们实现了从0到1的阶段。有了这一次的经验，往后基本不会出现太多的问题——但是仍有可能出现问题。


## 2.3.5 提升团队能力 
受团队能力影响，越是进度困难的时候，越需要提升团队的能力。它可以避免我们陷入一个误区，即我们因为能力不足而加班，却没有时间提升能力，又进一步导致加班。一旦团队里出现这样的问题，我们就不得不正视这个问题。尽管能力可以通过个人的练习得来，但是通过参与项目的方式来提升能力，则是一种更高速、有效的方式。 

提升团队能力的方式有很多，但是受限于业务进度，我们需要选择一种合适的方式，在时间有限的情况下发挥出更好的效果。在项目实施的过程中，相关能力的提升方式如图2-2所示。

![](architecture-in-team.jpg)

 
日常培训的过程如下： 
 （1）通过进入日常开发之前的培训、阅读文档等一系列的方式，来帮助他们培养基本的能力。 
 （2）进入开发后，则通过代码检视、代码规范及原则等一系列的方式，来帮助他们写出符合需求的代码。
 （3）在项目开发过程中，我们可能会通过结对编程的方式，来帮助他们更好地成长。 
 如图2-2所示，在这个阶段里，我们提升能力的目标是，让每个人在完成功能的同时，还要保证质量。


# 2.4 成长优化期：技术债务与演进（项目上线稳定运行了）

## 2.4.1 偿还技术债务 

## 2.4.2 优化开发体验 

## 2.4.3 带来技术挑战 

## 2.4.4 架构完善及演进

# 2.5 小结 
