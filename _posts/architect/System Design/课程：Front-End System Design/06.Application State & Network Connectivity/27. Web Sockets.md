
视频讲述了WebSocket的相关知识，包括其工作原理、优缺点、适用场景，还对比了其他数据传输方式（如服务器事件、长轮询、短轮询等），并针对不同应用场景给出技术选择建议，具体如下：

## WebSocket的定位与工作原理
[00:00]
WebSocket是服务器和客户端间快速传输数据的重复推送技术，支持客户端与服务器双向推送数据；其工作原理为客户端通过HTTP发送握手请求，服务器以升级请求响应，随后客户端可将协议升级为TCP，后续通信使用TCP而非HTTP（初始连接建立和协议升级依赖SDP）。


## WebSocket的问题与资源消耗
[00:58]
WebSocket在基础设施和工程层面维护复杂，且非常耗费资源；服务器最多可与客户端建立六万五千个TCP套接字连接，而每个TCP套接字需大量CPU资源维护，这要求在服务器基础设施上大量投资，其所需基础设施费用远超服务器事件方案，同时还会消耗较多电量，双向通信会快速耗尽设备电池。


## WebSocket的优点与适用场景
[02:10]
WebSocket的优点是在需要实时通信的场景中表现最佳，且支持无限连接数，若计划同时处理五百万连接，它是合适选择；其适用场景主要包括机器传感器数据实时收集、在线游戏、利用库存进行的微点差交易或需精确位置追踪的交易等。


## 非WebSocket的通信方案及适用场景
[02:55]
对于聊天应用，无需使用WebSocket，可通过服务器事件接收消息，用普通POST请求发送消息，该方案在代码和基础设施上更便宜、简单；桌面端获取购物订单可考虑长轮询或服务器事件，获取新消息可用短轮询或服务器事件；移动端获取购物订单和新消息，使用服务器事件可提升性能；服务器事件不适合处理图片、视频等大数据量媒体内容，更适用于文本内容；Notion类应用保存数据可直接用普通HTTP POST请求，无需WebSocket。


## 实时编辑场景的技术选择与挑战
[04:47]
实时编辑（如多人协作编辑）场景复杂，可利用服务器事件，但需优化服务器架构和数据结构以支持协作编辑，目前该领域甚至缺乏相关研究论文；从基础设施角度看，WebSocket维护难、额外开销大，不建议优先选择，建议用普通HTTP POST请求保存数据，通过服务器事件接收数据，且服务器事件性能接近WebSocket，能应对基础场景。


## WebSocket的状态保持问题与应对
[03:06]
WebSocket是状态保持的，一旦连接中断，存储在Socket中的所有数据会丢失；为解决此问题，需维护独立基础设施，将状态存储到数据库中，以便从断点恢复，这进一步增加了其复杂性，因此在选择WebSocket前需慎重考虑，因其对业务而言是重大投资。


---

## “WebSocket”课程文字稿

Evgenii explains that Web Sockets are one of the fastest ways to send data between the client and the server. They are bi-directional and will use TCP to send binary packets. The drawbacks of Web Sockets are the infrastructure cost and computing resources required to maintain constant TCP connections. The lesson concludes with a discussion of which networking strategy is best for the application's API.
叶夫根尼解释说，WebSocket是在客户端和服务器之间传输数据的最快方式之一。它们是双向的，并将使用TCP来发送二进制数据包。WebSocket的缺点是维护持续的TCP连接所需的基础设施成本和计算资源。本节课最后讨论了哪种网络策略最适合应用程序的API。

[00:00:00]  
>> Evgenii Ray: So, the WebSocket is the fastest way, how can we transfer the data between the server and the client? So, the WebSocket is the duplex push technologies, it means that the client can push the data and the server. And the way it works is that the client sends the handshake request through the HTTP/1 and the server sends the upgrade request, so response.>> 叶夫根尼·雷：那么，WebSocket是最快的方式，我们如何在服务器和客户端之间传输数据呢？WebSocket是双向推送技术，这意味着客户端和服务器都可以推送数据。它的工作方式是客户端通过HTTP/1发送握手请求，服务器则发送升级请求作为响应。

[00:00:27]  
So, it basically tells, okay client, you can upgrade your protocol to TCP. So, because the WebSockets used the HTTP connection just to establish the initial connection and upgrade its TCP. And the communication that will be done after the upgrade header will be using the TCP instead of the HTTP.所以，它基本上是告诉客户端，你可以将协议升级到TCP。因为WebSocket仅使用HTTP连接来建立初始连接，并对其TCP进行升级。而在升级头部之后进行的通信将使用TCP而非HTTP。

[00:00:53]  
So, the client can push the data and the server can respond, but what are the problems though with the WebSockets? The main issue with the WebSocket is that it's infrastructure wise, and engineering wise, it's very complex to maintain the WebSockets. It's very resource-consuming because the limit for the connection within their WebSocket can open 65,000 TCP socket connections with a server.所以，客户端可以推送数据，服务器也可以做出响应，但WebSocket存在哪些问题呢？WebSocket的主要问题在于，从基础设施和工程角度来看，维护WebSocket非常复杂。它还非常消耗资源，因为WebSocket的连接限制是一台服务器最多可打开65,000个TCP套接字连接。

[00:01:32]  
And if the TCP socket takes a lot of CPU resources to be maintained, and you would need to have a very good investment in your server infrastructure to support such load. And the amount of money that you need to put in the infrastructure will be incomparable to the server-side events because of the TCP sockets.而且如果TCP套接字需要占用大量CPU资源来维持，那么你就需要在服务器基础设施上投入巨资以支持这样的负载。并且，由于TCP套接字的存在，你在基础设施上的投入将与服务器端事件所需的投入不可同日而语。

[00:01:56]  
And it also drains energy and utilize CPU a lot, and it also used the duplex antenna, so it will really drain your battery pretty fast. The pros, though, for the WebSockets, if you need a real-time communication, this is the best way to go. And it's also, it has the unlimited number of connections, so if you're planning to have 500,000 connections in parallel, this is probably the way when you want to use the WebSockets.而且它还很消耗能源和CPU，并且它还使用了双工天线，所以会让你的电池耗电非常快。不过，对于WebSocket来说，它的优点是，如果你需要实时通信，这是最好的方式。而且，它支持无限数量的连接，所以如果你计划有50万个并行连接，WebSocket可能就是你要选择的方式。

[00:02:27]  
But the use case is basically when you work with the machine sensors, and you're building some code that will gather the machine sensors' data and you need this data in real-time. Also, the online gaming is also a good way to utilize the WebSockets, trading, where the precise timing is important, especially micro-scoping, or when you need to have precise location tracking.但基本的使用场景是，当你处理机器传感器时，你正在编写一些代码来收集机器传感器的数据，并且你需要这些实时数据。此外，在线游戏也是利用WebSocket的好方式，在交易领域，精确的时间安排很重要，特别是在微观层面，或者当你需要进行精确的位置跟踪时。

[00:02:52]  
So, on average, I would recommend if you built the chat application, you don't really need the WebSockets. You can receive the message from the server-side events and POST the message using the normal POST request, and it will be much cheaper and easier infrastructure in the code wise. Also, the WebSockets are stateful, once you lose the connection with the WebSockets, you will lose all the data that was stored within the socket.所以，一般来说，我建议如果你开发了聊天应用，其实并不真的需要WebSocket。你可以通过服务器发送事件接收消息，并使用常规的POST请求发送消息，这样在代码层面上，基础设施会便宜得多，也简单得多。此外，WebSocket是有状态的，一旦你与WebSocket的连接中断，存储在该套接字内的所有数据都会丢失。

[00:03:18]  
So, you need to maintain a separate infrastructure that will store the state in some database so you can restore it from the place you stop, that's why it's more complicated. And if you think that the WebSocket is good, think twice because it's a very big investment for the business in general.所以，你需要维护一个独立的基础设施，该设施会将状态存储在某个数据库中，这样你就可以从停止的地方恢复状态，这就是它更复杂的原因。而且如果你认为WebSocket很好，那可得再想想，因为总体来说，这对企业而言是一项非常大的投资。

[00:03:36]  
And let's get back to our shop administration app, what we would use for the endpoints. So, to get the shopping dollars for desktop, we could consider a long polling because long polling for desktop sounds fine. And there's always the server-side events, while for mobile, we will use the server-side events to provide better performance, the same applies to getting new messages.让我们回到我们的商店管理应用程序，看看我们会为这些端点使用什么。所以，为了获取桌面端的购物积分，我们可以考虑使用长轮询，因为长轮询在桌面端听起来是可行的。而且还有服务器发送事件这种方式，而对于移动端，我们将使用服务器发送事件以提供更好的性能，获取新消息时也是如此。

[00:04:03]  
So, we can get the new messages using the server-side events, and for desktop, we could use the short polling, or again, the server-side events. For sending the message, for both cases, I would just use a normal HTTP POST request. You don't really need the WebSocket connection to POST the data to the server.所以，我们可以使用服务器发送事件来获取新消息，对于桌面端，我们可以使用短轮询，或者同样使用服务器发送事件。在这两种情况下，发送消息时我都会使用普通的HTTP POST请求。你其实并不需要WebSocket连接来向服务器发送数据。

[00:04:23]  
>> Speaker 1: Would SSE work for media files, like images and videos, as well?>> 发言者1：服务器发送事件（SSE）也适用于图像和视频等媒体文件吗？  
>> Evgenii Ray: No, SSE is not good for the media content because the media content is by data. And you need to utilize the server-side events mostly for the text-based data, for the video content, I will utilize WebRTC instead.>> 叶夫根尼·雷：不，SSE并不适合媒体内容，因为媒体内容是基于数据的。而且，服务器发送事件（SSE）主要适用于文本类数据，对于视频内容，我会改用WebRTC。

[00:04:47]  
>> Speaker 1: What is the best protocol for handling real-time editors like Notion?>> 发言者1：处理像Notion这样的实时编辑器，最佳协议是什么？  
>> Evgenii Ray: You mean like saving the state in Notion? Okay, so when you work with a Notion, you don't really need to have the WebSocket connection to save the data, so you can basically do the normal POST request to save the data.>> 叶夫根尼·雷：你是说像在Notion中保存状态那样吗？好吧，当你使用Notion时，其实并不需要通过WebSocket连接来保存数据，基本上你可以用常规的POST请求来保存数据。

[00:05:08]  
>> Speaker 1: But what about real-time editing, like multiplayer?>> 发言者1：但是实时编辑呢，比如多人协作？  
>> Evgenii Ray: When it comes to real-time editing, you can utilize still, server-side events, but when it comes to collaborative editing, that is getting more complex because there are special data structures that store even the research papers, how to do the collaborative editing.>> 叶夫根尼·雷：在实时编辑方面，你可以利用静态的服务器端事件，但涉及到协同编辑时，情况就变得更为复杂了，因为存在一些特殊的数据结构，这些结构甚至存储了关于如何进行协同编辑的研究论文。

[00:05:32]  
So, we can speak about about this for a few hours. So basically, a protocol wise, server-side event will be good, but you will need to optimize your data structures to support the collaborative editing.所以，我们可以就这个话题聊上几个小时。基本上，从协议角度来说，服务器端事件会是不错的选择，但你需要优化数据结构以支持协同编辑。  
>> Speaker 1: Someone said WebSockets.>> 发言者1：有人提到了WebSocket。  
>> Evgenii Ray: [LAUGH] So, it depends on, infrastructure wise, WebSockets are terrible, it's really hard to maintain them.>> 叶夫根尼·雷：[笑] 所以，这要取决于基础设施，WebSocket 很糟糕，维护起来真的很难。

[00:05:59]  
And you also need to implement lots of overhead, how you're handling the data on a WebSockets. So, you need to have the thoughtful decision when you want to use it, I would utilize the normal HTTP POST request to say the data, and the server-side events to receive the data.而且你还需要实现大量的额外操作，比如如何在WebSocket上处理数据。所以，当你想要使用它时，需要做出深思熟虑的决定，我会使用常规的HTTP POST请求来发送数据，并使用服务器端事件来接收数据。

[00:06:15]  
If you try to compare the performance of server-side events, they are very close to the WebSockets, all WebSockets are really faster. I think for the basic cases, server-side event would handle that, even for Notion case, this would handle.如果你尝试比较服务器发送事件的性能，它们与WebSocket非常接近，但所有WebSocket确实更快。我认为对于基本情况，服务器发送事件可以处理，即使是Notion的情况，它也能处理。




