
视频讲述了Server-Sent Events（服务端发送事件）作为日志聚合替代方案的相关知识，包括其*技术基础、工作原理、优势、缺点及适用场景*等内容，具体如下：

## Server-Sent Events的技术定位与基础协议
[00:00]
它是一种**服务器推送技术**，可作为日志聚合替代方案，*基于HTTP/2协议*工作。

![[_posts/architect/System Design/课程：Front-End System Design/06.Application State & Network Connectivity/media/6c17ce25c4cfa44cc0a316a0d6d6cd53_MD5.jpeg]]

## Server-Sent Events的工作原理
[00:15]
与服务器建立连接时，*双向通信仅在初始握手过程中使用*，连接其余部分**主要是服务器向客户端推送数据，且未使用双向通信，仅采用接收模式**。其关键区别在于连接在协议层面实现，无需手动处理，能从上次中断处恢复。


## Server-Sent Events的扩展优势
[01:03]
从商业角度看*易于扩展，若多个服务器实例中一个宕机，可直接将请求转发到其他实例，因能从之前位置恢复，哪个实例响应无关紧要*。


## HTTP/2协议的核心优势及对Server-Sent Events的影响
[01:32]
HTTP/2核心优势是多路复用功能，允许通过单个TCP套接字同时打开200个请求，而HTTP/1获取五个资源需建立五个TCP连接，效率低。基于HTTP/2的Server-Sent Events通常比低流量方案快得多，不发送分块数据和不必要头部信息，仅接收与内容相关的数据。


## Server-Sent Events的其他优势
[02:22]
连接可“数学化处理”，从移动设备角度效率高，不发送额外数据，基础设施横向扩展更轻松，性能可与WebSocket媲美，处理大量文本数据流时非常高效，适用于桌面和移动网页应用。

## Server-Sent Events的缺点
[02:42]
无法将数据推送到服务器，且仅支持字符串数据，使用时需解析从服务器发送的负载。

## Server-Sent Events的适用与不适用场景
[03:18]
适用于处理大量文本数据流的场景；构建非常简单的桌面应用时应避免使用，此时使用长轮询即可，无需过度复杂化应用架构。


---

## “服务器发送事件”课程文字稿

Evgenii discusses server-sent events, which are one alternative to long polling. Server-sent events have automatic reconnection handling and are more battery-efficient. They are also a good alternative to Web Sockets and very effective for large text-data streams.
叶夫根尼（Evgenii）讨论了服务器发送事件，这是长轮询的一种替代方案。服务器发送事件具有自动重连处理功能，且更省电。它们也是WebSocket的理想替代方案，在处理大型文本数据流时非常高效。



[00:00:00]  
>> Eric: The first alternative that we could potentially use to log pooling is the Server-Sent Events. This is the server-push technology, so it's based on HTTP2. And the way it works is when you establish the connection with the server, the duplex communication is used only when you do the initial connection, just the initial three-way handshake.>> 埃里克：我们有可能用于日志池化的第一个替代方案是服务器发送事件（Server-Sent Events）。这是一种服务器推送技术，基于HTTP2。其工作方式是，当你与服务器建立连接时，双向通信仅在进行初始连接（即初始三次握手）时使用。

[00:00:28]  
But the rest of the connection is basically the server pushes the data to the client. So, in case of the Server-Sent Events, the duplex Santana is that used, we only use the receive only mode, and whether that drain the energy. Although, we still have an issue with the reconnection where we need to do the freeway handshake.但连接的其余部分基本上是服务器将数据推送到客户端。因此，在使用服务器发送事件（Server-Sent Events）的情况下，我们采用的是双工模式中的仅接收模式，这是否会消耗能量呢？不过，我们在重连方面仍然存在问题，需要进行快速握手。

[00:00:50]  
But the huge difference with the Server-Sent Events that the reconnection is implemented on protocol level. So you don't need to handle that on infrastructure wise, so you can always resume from the place where you started. And the huge benefit business-wise for using Server-Sent Events, it's very easy to scale.但与服务器发送事件相比，巨大的差异在于重连是在协议层面实现的。因此，你无需在基础设施层面处理这一点，这样你就总能从开始的地方恢复。从业务角度来看，使用服务器发送事件的巨大优势在于，它非常容易扩展。

[00:01:09]  
So for instance if we have multiple instances of the server and one instance is died, we can just forward the request to a separate instance. And because we can always resume from the previous place using the Server-Sent Events, so it doesn't matter for us which instance will respond.例如，如果我们有多个服务器实例，其中一个实例宕机了，我们可以直接将请求转发到另一个实例。而且，由于我们总是可以使用服务器发送事件从之前的位置恢复，所以哪个实例来响应对我们来说并不重要。

[00:01:31]  
So since the Server-Sent Events is HTTP2-based, it also utilizes the TCP socket differently. We gonna talk about HTTP2 protocol just in a few moments, but the huge benefit of HTTP2 it has the multiplexing feature. The multiplexing allows us to open 200 requests within one single TCP socket. So this means while in order to be one to fetch five resources, we have to open five TCP connection, which is much less efficient.由于服务器发送事件（Server-Sent Events）是基于HTTP2的，它对TCP套接字的使用方式也有所不同。我们稍后会讨论HTTP2协议，但其一大优势在于具备多路复用功能。多路复用允许我们在单个TCP套接字内发起200个请求。这意味着，要是我们想获取5个资源，原本需要打开5个TCP连接，这种方式的效率要低得多。

[00:02:09]  
So the Server-Sent Events is generally much faster than long polling because it also doesn't send any channel data. So we don't send any unnecessary headers and receive only the data that relates to the content. And the summary for that is there are definitely pros for Server-Sent Events because the connections can handled thematically, it's very better, efficient from the mobile device perspective.因此，服务器发送事件（Server-Sent Events）通常比长轮询快得多，因为它也不会发送任何通道数据。所以我们不会发送任何不必要的头部信息，只接收与内容相关的数据。总而言之，服务器发送事件无疑有其优势，因为连接可以按主题进行处理，而且从移动设备的角度来看，它更出色、更高效。

[00:02:33]  
And it doesn't send the overhead data and the horizontal scaling of your infrastructure is much easier when you use the Server-Sent Events. The cons though, you can't push the data to a server and only the string data is supported by detraining this. So you will need to parse the text payload that you send from the server.而且，使用服务器发送事件（Server-Sent Events）时，它不会发送额外开销数据，并且基础设施的水平扩展也会容易得多。不过缺点是，你无法向服务器推送数据，而且它只支持字符串数据。因此，你需要解析从服务器发送的文本负载。

[00:02:56]  
And when you need to use it, that's good for both desktop and mobile applications, and it also provides a very good performance. So the performance comparable to the web sockets that we're going to discuss on the next slide. And it's very good for streaming the large text data, if you have this case.而且当你需要使用它时，它对桌面和移动应用程序都很适用，并且还能提供非常好的性能。其性能堪比我们将在下一张幻灯片中讨论的网络套接字。如果你有这种情况，它对于流式传输大型文本数据非常有帮助。

[00:03:16]  
And the reason why you'd avoid this, is if you are building very simple desktop app, so then you'll be fine with long poll. You don't need to really overcomplicate the architecture of your app.而你会避免这种情况的原因是，如果你正在构建非常简单的桌面应用，那么长轮询对你来说就足够了。你确实不需要让应用的架构过于复杂。