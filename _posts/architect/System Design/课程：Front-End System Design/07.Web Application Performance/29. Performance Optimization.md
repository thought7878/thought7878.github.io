


---

## “性能优化”课程文字稿

Evgenii discusses the core web vital metrics that help developers identify where to apply performance optimizations. Metrics include Largest Contentful Paint, Interaction to Next Paint, and Cumulative Layout Shift. This lesson also includes performance differences between http/1.1, http/2, and http/3.
叶夫根尼（Evgenii）讨论了核心网络生命力指标，这些指标能帮助开发者确定在何处进行性能优化。这些指标包括最大内容绘制、下一次绘制交互和累积布局偏移。本节课还涵盖了HTTP/1.1、HTTP/2和HTTP/3之间的性能差异。


[00:00:00]  
>> Evgenii Ray: Now, let's move on to performance optimization section. So now we're gonna learn how to optimize our web assets to provide the best web by those metrics. And there are three main metrics that we need to track. So the first one is LCP, which is largest contentful paint.>> 叶夫根尼·雷：现在，我们进入性能优化部分。接下来我们将学习如何优化我们的网络资源，以通过这些指标提供最佳的网络体验。我们需要跟踪三个主要指标。第一个是LCP，即最大内容绘制。

[00:00:18]  
So it measures the loading performance of your app. And ideally, this metric should be less than 2.5 seconds, and even maybe under the two seconds. The next metric is IMP, which is interaction to the next pane ,it's basically when you update your data of the app, it may take some time to refresh the UI due to flow.所以它会衡量你的应用程序的加载性能。理想情况下，这个指标应该低于2.5秒，甚至可能低于2秒。下一个指标是IMP，即到下一个面板的交互，基本上是指当你更新应用程序的数据时，由于流程原因，刷新用户界面可能需要一些时间。

[00:00:43]  
So, ideally a reflow should take less than 200 milliseconds and next is a layout shifts. So generally layout shifts happens when some minor UI changes, so when you do some small animation or increase the size of some components. Then it impacts the visual stability because other elements may respect the size of the changed element and also adjust their size.因此，理想情况下，重排应该在200毫秒以内完成，接下来是布局偏移。通常，布局偏移发生在一些细微的用户界面变化时，比如进行一些小的动画效果或增大某些组件的尺寸。这会影响视觉稳定性，因为其他元素可能会根据变化元素的尺寸进行调整，进而改变自身的大小。

[00:01:08]  
So you need to make sure that the CLS is less than 0.1. All these metrics can be governed using the Lighthouse in the browser. So we are going to focus largely on the largest content paintful, because this is one of the metric that impacts the business in terms of the results.所以你需要确保累积布局偏移（CLS）小于0.1。所有这些指标都可以通过浏览器中的Lighthouse来管理。因此，我们将主要关注最大内容绘制，因为这是在结果方面影响业务的指标之一。

[00:01:30]  
So the less the LCP, the better results for the business. And we start with the network performance. So as we discussed before, for HTTP, we have three versions of protocol, one is http/1, http/2 and http/3. So HTTP1 goes into legacy, so now only 20% of the servers use the HTTP1 for most of the clients now and servers use the HTTP2.因此，最大内容绘制（LCP）的值越小，对业务越有利。我们从网络性能开始说起。正如我们之前讨论的，对于HTTP，我们有三个版本的协议，分别是http/1、http/2和http/3。http/1已经成为 legacy 协议，现在只有20%的服务器仍在为大多数客户端使用http/1，而大多数服务器都在使用http/2。

[00:01:59]  
And HTTP3 probably will become a new standard in next four or five years, let's hope for that. So the first and the easiest way to optimize the performance of your web app is actually to change the server. And the reason is the HTTP1 has problems with the network performance, because HTTP1 is very limited to the number of connection.而且HTTP3很可能会在未来四五年成为新的标准，我们期待这一天的到来。因此，优化你的网络应用性能的第一个也是最简单的方法实际上是更换服务器。原因是HTTP1存在网络性能问题，因为HTTP1对连接数量有很大限制。

[00:02:24]  
So initially, you can make only one request in parallel. So all your resources has to be loaded one by one. So if you have the front-end master website, so first we would load our HTML, then we'll load our CSs and the our GS. The browsers found the workaround, so they basically opened the new TCP connection and right now the limit is five TCP connections.所以最初，你只能并行发出一个请求。因此，所有资源都必须逐个加载。所以如果你有前端主网站，首先我们会加载HTML，然后加载CSS和JavaScript。浏览器找到了解决办法，它们基本上会打开新的TCP连接，现在的限制是五个TCP连接。

[00:02:56]  
So we could five resources in parallel. And if you have on your website hundreds of resources, then everything is getting queued, and your website loads slowly. And this is actually the reason why webpack was created. So, initially, the webpack was just merging all assets in a single bundle so it can be loaded in a single hoop.所以我们可以并行处理五个资源。如果你的网站上有数百个资源，那么所有资源都会进入队列，导致网站加载缓慢。而这实际上就是webpack创建的原因。最初，webpack只是将所有资源合并到一个包中，这样就可以一次性加载完成。

[00:03:19]  
But now it's becoming the anti-pattern, so now we actually want to split things because of HTTP2.但现在这正成为一种反模式，所以由于HTTP2，我们实际上希望将内容拆分。  
>> Evgenii Ray: So also the issue with HTTP1 is the data we have, because we are sending these headers all the time in non-compressed state. And the migration to HTTP2 is pretty easy infrastructure-wise because HTTP2 is backward compatible with HTT1.>> 叶夫根尼·雷：HTTP1的问题还在于我们所处理的数据，因为我们一直在以未压缩的状态发送这些头部信息。而从基础设施角度来看，向HTTP2迁移相当容易，因为HTTP2与HTTP1是向后兼容的。

[00:03:47]  
And if we think about the maintaining and the migration costs, that maintaining the HTTP1 server costs more in the long run. Because to optimize the performance of the web application using the HTTP1 server, you would need to introduce additional infrastructure. The way how can you load 20 resources in parallel under the HTTP1?而且如果我们考虑维护和迁移成本，从长远来看，维护HTTP1服务器的成本会更高。因为要优化使用HTTP1服务器的Web应用程序的性能，你需要引入额外的基础设施。那么，在HTTP1下如何并行加载20个资源呢？

[00:04:14]  
So you would need to create multiple domains for your assets. So, you'll have the images domain, then you will have your JavaScript domain and so on, because the limitation is five connection per domain. This is called domain charting. And before you had to use the domain charting to improve the web application performance.因此，你需要为你的资产创建多个域名。你会有图片域名，然后会有JavaScript域名等等，因为每个域名的连接数限制是五个。这被称为域名分片。以前，你必须使用域名分片来提高Web应用程序的性能。

[00:04:34]  
It's very expensive in terms of infrastructure. Also the thing, the benefits of HTTP2 is从基础设施角度来看，这成本非常高。另外，HTTP2的优势在于  
>> Evgenii Ray: How it's established the connection and remember the HTTP1 do the full thing, three way handshake so it has to do free network trips every time we do a new connection. But when it comes to HTTP2 or 3, there is a feature called multiplexing.>> 叶夫根尼·雷：连接是如何建立的？要知道，HTTP1需要完成完整的三次握手过程，所以每次建立新连接都得进行三次网络往返。但到了HTTP2或HTTP3，就有了一个叫做多路复用的特性。

[00:05:01]  
So, we establish one single TCP connection with a server. And within this connection, we could potentially have 200 parallel streams loading the data. This is achieved because the HTTP2 is the binary protocol. So, it transfers the binary data. So, we can split our channel into the multiple streams to transfer the byte data.因此，我们与服务器建立一个单一的TCP连接。在这个连接中，我们理论上可以有200个并行流加载数据。这之所以能够实现，是因为HTTP2是二进制协议。它传输的是二进制数据。因此，我们可以将信道分割成多个流来传输字节数据。

[00:05:29]  
Within one connection, we can load 200 resources in parallel. So, as you can see comparing to HTTP1, where its limitations just five and you had to maintain five TCP connection that would result a significant energy drain on the mobile devices. So, HTTP2 is much more efficient in this sense.在一个连接内，我们可以并行加载200个资源。因此，正如你所看到的，与HTTP1相比，HTTP1的限制仅为5个，而且你必须维持5个TCP连接，这会导致移动设备的能耗显著增加。所以，从这个角度来说，HTTP2的效率要高得多。

[00:05:48]  
So, you don't need to build the overhead on the server infrastructure to maintain multiple domains because now the HTTP2 server could served 200 responses. And I think for any website 200 resources will be pretty good number. I don't expect that any websites to actually reach the limit.所以，你不需要在服务器基础设施上增加额外开销来维护多个域名，因为现在HTTP2服务器可以返回200个响应。而且我认为对于任何网站来说，200个资源都是个相当不错的数量。我不认为有任何网站会真的达到这个限制。





