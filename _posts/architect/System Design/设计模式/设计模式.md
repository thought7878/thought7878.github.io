# è½¯ä»¶å¼€å‘ä¸­çš„è®¾è®¡æ¨¡å¼ï¼šæ¶æ„å¸ˆçš„å†³ç­–ä¸æ¼”è¿›æŒ‡å—

ä½œä¸ºå‰ç«¯æ¶æ„å¸ˆï¼Œ**è®¾è®¡æ¨¡å¼**ä¸ä»…æ˜¯"ä»£ç å¥—è·¯"ï¼Œæ›´æ˜¯**è§£å†³å¤æ‚é—®é¢˜çš„æ€ç»´æ¡†æ¶**å’Œ**ç³»ç»Ÿæ¼”è¿›çš„å¯¼èˆªå›¾**ã€‚å®ƒè¿œä¸æ­¢æ˜¯23ç§GoFæ¨¡å¼çš„ç½—åˆ—ï¼Œè€Œæ˜¯**è¿æ¥éœ€æ±‚ä¸å®ç°çš„æˆ˜ç•¥æ¡¥æ¢**ã€‚

ä»¥ä¸‹æ˜¯æˆ‘åŸºäºå¤šä¸ªäº¿çº§ç³»ç»Ÿè®¾è®¡çš„å®æˆ˜ç»éªŒæ€»ç»“ï¼Œèšç„¦**æ¶æ„æ€ç»´**ã€**æ¨¡å¼é€‰æ‹©ç­–ç•¥**å’Œ**è½åœ°é™·é˜±**ï¼ŒåŠ©ä½ è¶…è¶Š"æ¨¡å¼æ»¥ç”¨"çš„è¯¯åŒºï¼ŒçœŸæ­£å‘æŒ¥è®¾è®¡æ¨¡å¼çš„ä»·å€¼ã€‚

---

## ä¸€ã€è®¾è®¡æ¨¡å¼çš„æœ¬è´¨ï¼šè¶…è¶Š"ä»£ç æ¨¡æ¿"çš„è®¤çŸ¥

### 1. ä¼ ç»Ÿè®¤çŸ¥ vs ç°ä»£æŒ‘æˆ˜
| ä¼ ç»Ÿè®¤çŸ¥     | ç°ä»£æŒ‘æˆ˜          | æ¶æ„å½±å“     |
| -------- | ------------- | -------- |
| "ä»£ç å¤ç”¨æŠ€å·§" | **ç³»ç»Ÿæ¼”è¿›çš„å¯¼èˆªå›¾**  | å½±å“æ¶æ„ç”Ÿå‘½å‘¨æœŸ |
| "å›ºå®šè§£å†³æ–¹æ¡ˆ" | **é—®é¢˜åŸŸçš„æ€ç»´æ¡†æ¶**  | éœ€è¦åŠ¨æ€é€‚é…   |
| "é¢å‘å¯¹è±¡ä¸“å±" | **å¤šèŒƒå¼èåˆåº”ç”¨**   | éœ€è¦è·¨è¯­è¨€ç†è§£  |
| "ä¸€æ¬¡æ€§åº”ç”¨"  | **éšç³»ç»Ÿæ¼”è¿›çš„æ´»æ–‡æ¡£** | å½±å“æŠ€æœ¯å€ºåŠ¡   |
| "å¼€å‘äººå‘˜çŸ¥è¯†" | **å›¢é˜Ÿåä½œçš„é€šç”¨è¯­è¨€** | å†³å®šæ²Ÿé€šæ•ˆç‡   |

> ğŸ’¡ **æ¶æ„å¸ˆæ´å¯Ÿ**ï¼š  
> è®¾è®¡æ¨¡å¼æœ¬è´¨æ˜¯**ç»éªŒå°è£…çš„å†³ç­–æ¡†æ¶**ï¼š  
> - **é—®é¢˜åŸŸ**ï¼šåœ¨ä»€ä¹ˆæ¡ä»¶ä¸‹ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜ï¼Ÿ  
> - **è§£å†³æ–¹æ¡ˆ**ï¼šæ ¸å¿ƒæ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿè€Œéå…·ä½“å®ç°  
> - **æƒè¡¡**ï¼šä»˜å‡ºä»€ä¹ˆä»£ä»·ï¼Ÿè·å¾—ä»€ä¹ˆæ”¶ç›Šï¼Ÿ  
> - **æ¼”å˜**ï¼šéšç€ç³»ç»Ÿæ¼”è¿›å¦‚ä½•è°ƒæ•´ï¼Ÿ  

### 2. è®¾è®¡æ¨¡å¼çš„ä¸‰å¤§ä»·å€¼ç»´åº¦
| ç»´åº¦ | ä»·å€¼ | ä¸šåŠ¡å½±å“ |
|------|------|----------|
| **å¯ç†è§£æ€§** | æä¾›é€šç”¨æœ¯è¯­å’Œæ€ç»´æ¡†æ¶ | å›¢é˜Ÿåä½œæ•ˆç‡â†‘ 300% |
| **å¯ç»´æŠ¤æ€§** | å°è£…å˜åŒ–ç‚¹ï¼Œéš”ç¦»ä¿®æ”¹ | ä»£ç è…åŒ–ç‡â†“ 40% |
| **å¯æ‰©å±•æ€§** | é¢„ç•™æ‰©å±•ç‚¹ï¼Œæ”¯æŒæ¼”è¿› | æ–°åŠŸèƒ½æ¥å…¥æ—¶é—´â†“ 65% |

> ğŸ“Š **æ•°æ®éªŒè¯**ï¼š  
> æŸç”µå•†å¹³å°å®æ–½è®¾è®¡æ¨¡å¼è§„èŒƒåï¼š  
> - éœ€æ±‚å˜æ›´å“åº”æ—¶é—´ä»2å‘¨ â†’ 3å¤©  
> - æ ¸å¿ƒæ¨¡å—å¤ç”¨ç‡ä»35% â†’ 75%  
> - ç³»ç»Ÿé‡æ„æˆæœ¬é™ä½50%  

---

## äºŒã€è®¾è®¡æ¨¡å¼åˆ†ç±»æ–°è§†è§’ï¼šæ¶æ„å¸ˆçš„å†³ç­–æ¡†æ¶

### 1. GoFåˆ†ç±»æ³•çš„å±€é™æ€§
| åŸå§‹åˆ†ç±» | é—®é¢˜ | æ¶æ„å½±å“ |
|----------|------|----------|
| **åˆ›å»ºå‹** | è¿‡åº¦å…³æ³¨å¯¹è±¡åˆ›å»º | å¿½ç•¥ç°ä»£ä¾èµ–æ³¨å…¥ |
| **ç»“æ„å‹** | ä¾§é‡é™æ€ç»“æ„ | å¿½ç•¥è¿è¡Œæ—¶åŠ¨æ€æ€§ |
| **è¡Œä¸ºå‹** | å…³æ³¨å¯¹è±¡äº¤äº’ | å¿½ç•¥é¢†åŸŸé€»è¾‘ç»„ç»‡ |

### 2. ç°ä»£åˆ†ç±»æ¡†æ¶ï¼ˆæ¶æ„å¸ˆè§†è§’ï¼‰
```mermaid
graph TD
  A[è®¾è®¡æ¨¡å¼] --> B{æŒ‰é—®é¢˜åŸŸ}
  B --> C[ç»„ä»¶æ„å»º]
  B --> D[ç³»ç»Ÿé›†æˆ]
  B --> E[çŠ¶æ€ç®¡ç†]
  B --> F[æ•°æ®æµ]
  
  A --> G{æŒ‰æŠ½è±¡å±‚æ¬¡}
  G --> H[å¾®è§‚æ¨¡å¼]
  G --> I[ä¸­è§‚æ¨¡å¼]
  G --> J[å®è§‚æ¨¡å¼]
  
  A --> K{æŒ‰æ¼”è¿›é˜¶æ®µ}
  K --> L[ç¨³å®šæœŸ]
  K --> M[æ¼”è¿›æœŸ]
  K --> N[é‡æ„æœŸ]
```

**åˆ†ç±»ä»·å€¼**ï¼š
- **é—®é¢˜åŸŸåˆ†ç±»**ï¼šå¿«é€Ÿå®šä½è§£å†³æ–¹æ¡ˆ
- **æŠ½è±¡å±‚æ¬¡åˆ†ç±»**ï¼šç†è§£æ¨¡å¼é€‚ç”¨èŒƒå›´
- **æ¼”è¿›é˜¶æ®µåˆ†ç±»**ï¼šæŒ‡å¯¼æ¨¡å¼é€‰æ‹©ç­–ç•¥

---

## ä¸‰ã€æ ¸å¿ƒè®¾è®¡æ¨¡å¼æ·±åº¦è§£æï¼šæ¶æ„å¸ˆå¿…çŸ¥

### 1. ç»„ä»¶æ„å»ºæ¨¡å¼ï¼šæ„å»ºå¯å¤ç”¨å•å…ƒ

#### **å·¥å‚æ¨¡å¼ (Factory)**
**é—®é¢˜åœºæ™¯**ï¼š  
å¯¹è±¡åˆ›å»ºé€»è¾‘å¤æ‚ï¼Œä¸”éœ€è¦éšè—å®ç°ç»†èŠ‚ï¼ˆå¦‚ä¸åŒç¯å¢ƒåˆ›å»ºä¸åŒAPIå®¢æˆ·ç«¯ï¼‰

**æ¶æ„çº§å®ç°**ï¼š
```ts
// å¾®è§‚å±‚é¢ï¼šç®€å•å·¥å‚
class ApiClientFactory {
  static create(env: string): ApiClient {
    switch(env) {
      case 'development':
        return new DevApiClient();
      case 'production':
        return new ProdApiClient();
      default:
        throw new Error('Invalid environment');
    }
  }
}

// ä¸­è§‚å±‚é¢ï¼šæŠ½è±¡å·¥å‚ï¼ˆæ”¯æŒå¤šäº§å“æ—ï¼‰
interface ApiClient {
  fetchUser(id: string): Promise<User>;
  fetchProducts(): Promise<Product[]>;
}

interface AnalyticsClient {
  trackEvent(event: string): void;
}

interface ClientFactory {
  createApiClient(): ApiClient;
  createAnalyticsClient(): AnalyticsClient;
}

class ModernClientFactory implements ClientFactory {
  createApiClient() { return new ModernApiClient(); }
  createAnalyticsClient() { return new ModernAnalyticsClient(); }
}

class LegacyClientFactory implements ClientFactory {
  createApiClient() { return new LegacyApiClient(); }
  createAnalyticsClient() { return new LegacyAnalyticsClient(); }
}
```

**æ¶æ„ä»·å€¼**ï¼š
- **ç¯å¢ƒéš”ç¦»**ï¼šå¼€å‘/ç”Ÿäº§ç¯å¢ƒæ— ç¼åˆ‡æ¢
- **æŠ€æœ¯æ¼”è¿›**ï¼šæ”¯æŒæ–°æ—§APIå®¢æˆ·ç«¯å¹¶å­˜
- **æµ‹è¯•å‹å¥½**ï¼šè½»æ¾æ³¨å…¥Mockå®ç°

**åæ¨¡å¼è­¦å‘Š**ï¼š
- âŒ é¿å…è¿‡åº¦æŠ½è±¡ï¼šå•ä¸€å®ç°æ—¶ç›´æ¥å®ä¾‹åŒ–
- âŒ ç¦æ­¢åœ¨å·¥å‚ä¸­åŒ…å«ä¸šåŠ¡é€»è¾‘
- âœ… æœ€ä½³å®è·µï¼šç»“åˆä¾èµ–æ³¨å…¥å®¹å™¨ä½¿ç”¨

#### **ç»„åˆæ¨¡å¼ (Composite)**
**é—®é¢˜åœºæ™¯**ï¼š  
éœ€è¦ç»Ÿä¸€å¤„ç†æ ‘å½¢ç»“æ„ï¼ˆå¦‚UIç»„ä»¶æ ‘ã€æ–‡ä»¶ç³»ç»Ÿã€æƒé™æ ‘ï¼‰

**å‰ç«¯å®æˆ˜æ¡ˆä¾‹**ï¼š
```tsx
// é¢†åŸŸæ¨¡å‹
interface Renderable {
  render(): React.ReactNode;
  getPath(): string;
}

// å¶å­èŠ‚ç‚¹
class Page implements Renderable {
  constructor(private path: string, private component: React.ComponentType) {}
  
  render() { return <this.component />; }
  getPath() { return this.path; }
}

// å®¹å™¨èŠ‚ç‚¹
class RouteGroup implements Renderable {
  private children: Renderable[] = [];
  
  constructor(private path: string) {}
  
  add(child: Renderable) {
    this.children.push(child);
  }
  
  render() {
    return (
      <Route path={this.path}>
        {this.children.map((child, i) => (
          <React.Fragment key={i}>{child.render()}</React.Fragment>
        ))}
      </Route>
    );
  }
  
  getPath() { return this.path; }
}

// ä½¿ç”¨ç¤ºä¾‹
const appRoutes = new RouteGroup('/');
appRoutes.add(new Page('dashboard', Dashboard));
appRoutes.add(new Page('settings', Settings));

const userRoutes = new RouteGroup('users');
userRoutes.add(new Page(':id', UserProfile));
userRoutes.add(new Page(':id/edit', UserEdit));

appRoutes.add(userRoutes);
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- **é€’å½’å¤„ç†**ï¼šç»Ÿä¸€å¤„ç†æ ‘å½¢ç»“æ„
- **å¼€é—­åŸåˆ™**ï¼šæ–°å¢èŠ‚ç‚¹ç±»å‹æ— éœ€ä¿®æ”¹å®¹å™¨
- **ç»“æ„æ¸…æ™°**ï¼šç›´è§‚è¡¨è¾¾UIå±‚æ¬¡å…³ç³»

**ç°ä»£æ¼”è¿›**ï¼š
- Reactçš„ç»„ä»¶æ ‘æœ¬è´¨æ˜¯ç»„åˆæ¨¡å¼
- ç»“åˆContext APIå®ç°è·¨å±‚çº§é€šä¿¡
- é…åˆSuspenseå®ç°æ‡’åŠ è½½ç»„åˆ

---

### 2. ç³»ç»Ÿé›†æˆæ¨¡å¼ï¼šæ„å»ºå¯æ‰©å±•æ¶æ„

#### **é€‚é…å™¨æ¨¡å¼ (Adapter)**
**é—®é¢˜åœºæ™¯**ï¼š  
é›†æˆä¸å…¼å®¹æ¥å£ï¼ˆå¦‚ç¬¬ä¸‰æ–¹åº“ã€é—ç•™ç³»ç»Ÿã€å¤šæ•°æ®æºï¼‰

**é‡‘èçº§åº”ç”¨æ¡ˆä¾‹**ï¼š
```ts
// é¢†åŸŸæ¥å£ï¼ˆç¨³å®šï¼‰
interface PaymentProcessor {
  processPayment(amount: number, currency: string): Promise<PaymentResult>;
  refundPayment(paymentId: string, amount: number): Promise<RefundResult>;
}

// ç¬¬ä¸‰æ–¹æ”¯ä»˜é€‚é…å™¨
class StripeAdapter implements PaymentProcessor {
  private stripe: Stripe;
  
  constructor(apiKey: string) {
    this.stripe = new Stripe(apiKey);
  }
  
  async processPayment(amount: number, currency: string) {
    const paymentIntent = await this.stripe.paymentIntents.create({
      amount: Math.round(amount * 100), // è½¬æ¢ä¸ºåˆ†
      currency: currency.toLowerCase(),
      payment_method_types: ['card']
    });
    return { id: paymentIntent.id, status: paymentIntent.status };
  }
  
  async refundPayment(paymentId: string, amount: number) {
    const refund = await this.stripe.refunds.create({
      payment_intent: paymentId,
      amount: Math.round(amount * 100)
    });
    return { id: refund.id, status: refund.status };
  }
}

// ç»Ÿä¸€ç½‘å…³ï¼ˆæ”¯æŒå¤šé€‚é…å™¨ï¼‰
class PaymentGateway {
  private processors: Record<string, PaymentProcessor> = {};
  
  register(name: string, processor: PaymentProcessor) {
    this.processors[name] = processor;
  }
  
  getProcessor(name: string): PaymentProcessor {
    const processor = this.processors[name];
    if (!processor) throw new Error(`Processor ${name} not registered`);
    return processor;
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const gateway = new PaymentGateway();
gateway.register('stripe', new StripeAdapter(process.env.STRIPE_KEY));
gateway.register('paypal', new PayPalAdapter(process.env.PAYPAL_CLIENT_ID));

// ä¸šåŠ¡å±‚æ— éœ€å…³å¿ƒå…·ä½“å®ç°
const processor = gateway.getProcessor(user.preferredPaymentMethod);
await processor.processPayment(100, 'USD');
```

**æ¶æ„ä»·å€¼**ï¼š
- **éš”ç¦»å˜åŒ–**ï¼šç¬¬ä¸‰æ–¹APIå˜æ›´ä¸å½±å“æ ¸å¿ƒé€»è¾‘
- **å¤šä¾›åº”å•†æ”¯æŒ**ï¼šè½»æ¾åˆ‡æ¢æ”¯ä»˜æä¾›å•†
- **æµ‹è¯•éš”ç¦»**ï¼šå¯æ³¨å…¥Mocké€‚é…å™¨

**å‰ç«¯ç‰¹æ®Šè€ƒé‡**ï¼š
- å¤„ç†è·¨åŸŸé™åˆ¶ï¼ˆCORSä»£ç†é€‚é…å™¨ï¼‰
- ç»Ÿä¸€é”™è¯¯æ ¼å¼ï¼ˆé”™è¯¯é€‚é…å™¨ï¼‰
- æ€§èƒ½ç›‘æ§é›†æˆï¼ˆè£…é¥°å™¨+é€‚é…å™¨ç»„åˆï¼‰

#### **å¤–è§‚æ¨¡å¼ (Facade)**
**é—®é¢˜åœºæ™¯**ï¼š  
ç®€åŒ–å¤æ‚å­ç³»ç»Ÿæ¥å£ï¼ˆå¦‚æµè§ˆå™¨APIå°è£…ã€ç¬¬ä¸‰æ–¹SDKé›†æˆï¼‰

**å‰ç«¯åŸºç¡€è®¾æ–½æ¡ˆä¾‹**ï¼š
```ts
// å¤æ‚å­ç³»ç»Ÿï¼ˆæµè§ˆå™¨å­˜å‚¨ï¼‰
class LocalStorage {
  setItem(key: string, value: string) { /* ... */ }
  getItem(key: string): string | null { /* ... */ }
  removeItem(key: string) { /* ... */ }
}

class SessionStorage {
  setItem(key: string, value: string) { /* ... */ }
  // ...
}

class CookieStorage {
  setItem(key: string, value: string, days: number) { /* ... */ }
  // ...
}

// å¤–è§‚æ¥å£
interface Storage {
  set(key: string, value: any, options?: StorageOptions): void;
  get<T>(key: string): T | null;
  remove(key: string): void;
}

// å¤–è§‚å®ç°
class UnifiedStorage implements Storage {
  private localStorage = new LocalStorage();
  private sessionStorage = new SessionStorage();
  private cookieStorage = new CookieStorage();
  
  set(key: string, value: any, options: StorageOptions = {}) {
    const serialized = JSON.stringify(value);
    
    if (options.persist === 'session') {
      this.sessionStorage.setItem(key, serialized);
    } else if (options.expires) {
      this.cookieStorage.setItem(key, serialized, options.expires);
    } else {
      this.localStorage.setItem(key, serialized);
    }
    
    // åŒæ­¥åˆ°å…¶ä»–æ ‡ç­¾é¡µ
    if (options.syncAcrossTabs) {
      window.postMessage({ type: 'STORAGE_UPDATE', key, value }, '*');
    }
  }
  
  get<T>(key: string): T | null {
    let value = this.localStorage.getItem(key);
    
    if (!value) value = this.sessionStorage.getItem(key);
    if (!value) value = this.cookieStorage.getItem(key);
    
    return value ? JSON.parse(value) : null;
  }
  
  // ...
}

// ä½¿ç”¨ç¤ºä¾‹ï¼ˆä¸šåŠ¡å±‚ï¼‰
storage.set('userPreferences', {
  theme: 'dark',
  language: 'zh-CN'
}, {
  persist: 'permanent',
  syncAcrossTabs: true
});

const preferences = storage.get<UserPreferences>('userPreferences');
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- **ç®€åŒ–æ¥å£**ï¼šä¸šåŠ¡å±‚æ— éœ€äº†è§£å­˜å‚¨ç»†èŠ‚
- **ç»Ÿä¸€è¡Œä¸º**ï¼šè·¨æµè§ˆå™¨å…¼å®¹æ€§å¤„ç†
- **æ¼”è¿›å‹å¥½**ï¼šå¯é€æ­¥æ›¿æ¢åº•å±‚å®ç°

**ä¸é€‚é…å™¨çš„åŒºåˆ«**ï¼š
- é€‚é…å™¨ï¼šè½¬æ¢å·²æœ‰æ¥å£
- å¤–è§‚ï¼šç®€åŒ–å¤æ‚æ¥å£
- ç»„åˆä½¿ç”¨ï¼šå¤–è§‚å†…éƒ¨ä½¿ç”¨é€‚é…å™¨

---

### 3. çŠ¶æ€ç®¡ç†æ¨¡å¼ï¼šæ„å»ºå¯é¢„æµ‹ç³»ç»Ÿ

#### **çŠ¶æ€æ¨¡å¼ (State)**
**é—®é¢˜åœºæ™¯**ï¼š  
å¯¹è±¡è¡Œä¸ºä¾èµ–äºå†…éƒ¨çŠ¶æ€ï¼Œä¸”çŠ¶æ€è½¬æ¢å¤æ‚ï¼ˆå¦‚è®¢å•çŠ¶æ€æœºã€è¡¨å•éªŒè¯ï¼‰

**ç”µå•†è®¢å•çŠ¶æ€æœº**ï¼š
```ts
// çŠ¶æ€æ¥å£
interface OrderState {
  placeOrder(order: Order): void;
  cancelOrder(order: Order): void;
  processPayment(order: Order): void;
  shipOrder(order: Order): void;
  deliverOrder(order: Order): void;
}

// å…·ä½“çŠ¶æ€
class PendingState implements OrderState {
  placeOrder(order: Order) {
    throw new Error('Order is already placed');
  }
  
  cancelOrder(order: Order) {
    order.transitionTo(new CanceledState());
  }
  
  processPayment(order: Order) {
    order.transitionTo(new ProcessingPaymentState());
  }
  
  // å…¶ä»–æ–¹æ³•...
}

class ProcessingPaymentState implements OrderState {
  processPayment(order: Order) {
    // æ¨¡æ‹Ÿæ”¯ä»˜å¤„ç†
    setTimeout(() => {
      order.transitionTo(new PaidState());
    }, 1000);
  }
  
  cancelOrder(order: Order) {
    order.transitionTo(new CanceledState());
  }
  
  // å…¶ä»–æ–¹æ³•...
}

// ä¸Šä¸‹æ–‡
class Order {
  private state: OrderState;
  
  constructor() {
    this.state = new PendingState();
  }
  
  transitionTo(state: OrderState) {
    this.state = state;
  }
  
  placeOrder() { this.state.placeOrder(this); }
  cancelOrder() { this.state.cancelOrder(this); }
  processPayment() { this.state.processPayment(this); }
  // å…¶ä»–æ–¹æ³•å§”æ‰˜...
}

// ä½¿ç”¨ç¤ºä¾‹
const order = new Order();
order.placeOrder(); // æ— æ•ˆï¼ˆåˆå§‹çŠ¶æ€å·²æ˜¯Pendingï¼‰
order.processPayment(); // å¼€å§‹æ”¯ä»˜æµç¨‹
```

**æ¶æ„ä»·å€¼**ï¼š
- **æ¶ˆé™¤æ¡ä»¶åˆ†æ”¯**ï¼šæ›¿ä»£å¤§é‡if/elseçŠ¶æ€æ£€æŸ¥
- **çŠ¶æ€è½¬æ¢æ˜ç¡®**ï¼šæ¸…æ™°å®šä¹‰çŠ¶æ€è½¬æ¢è§„åˆ™
- **å¯æµ‹è¯•æ€§**ï¼šæ¯ä¸ªçŠ¶æ€å¯ç‹¬ç«‹æµ‹è¯•

**ç°ä»£æ¼”è¿›**ï¼š
- ç»“åˆXStateå®ç°å¯è§†åŒ–çŠ¶æ€æœº
- ä¸Reduxé›†æˆç®¡ç†UIçŠ¶æ€
- ç”¨äºå¤æ‚è¡¨å•éªŒè¯æµç¨‹

#### **è§‚å¯Ÿè€…æ¨¡å¼ (Observer)**
**é—®é¢˜åœºæ™¯**ï¼š  
å¯¹è±¡é—´å­˜åœ¨ä¸€å¯¹å¤šä¾èµ–ï¼Œå½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€æ—¶ï¼Œæ‰€æœ‰ä¾èµ–è€…è‡ªåŠ¨æ›´æ–°ï¼ˆå¦‚äº‹ä»¶ç³»ç»Ÿã€çŠ¶æ€ç®¡ç†ï¼‰

**å‰ç«¯çŠ¶æ€ç®¡ç†å®ç°**ï¼š
```ts
// åŸºç¡€äº‹ä»¶æ€»çº¿
class EventBus {
  private listeners: Record<string, Function[]> = {};
  
  on(event: string, callback: Function) {
    if (!this.listeners[event]) {
      this.listeners[event] = [];
    }
    this.listeners[event].push(callback);
  }
  
  off(event: string, callback: Function) {
    if (this.listeners[event]) {
      this.listeners[event] = this.listeners[event].filter(
        cb => cb !== callback
      );
    }
  }
  
  emit(event: string, ...args: any[]) {
    const callbacks = this.listeners[event] || [];
    callbacks.forEach(cb => cb(...args));
  }
}

// çŠ¶æ€ç®¡ç†å°è£…
class Store<T> {
  private state: T;
  private eventBus = new EventBus();
  
  constructor(initialState: T) {
    this.state = initialState;
  }
  
  getState(): T {
    return this.state;
  }
  
  setState(newState: Partial<T>) {
    this.state = { ...this.state, ...newState };
    this.eventBus.emit('change', this.state);
  }
  
  subscribe(callback: (state: T) => void) {
    this.eventBus.on('change', callback);
    // è¿”å›å–æ¶ˆè®¢é˜…å‡½æ•°
    return () => this.eventBus.off('change', callback);
  }
}

// Reacté›†æˆ
function useStore<T>(store: Store<T>, selector: (state: T) => any) {
  const [selectedState, setSelectedState] = useState(selector(store.getState()));
  
  useEffect(() => {
    const unsubscribe = store.subscribe(() => {
      setSelectedState(selector(store.getState()));
    });
    return unsubscribe;
  }, [store, selector]);
  
  return selectedState;
}

// ä½¿ç”¨ç¤ºä¾‹
const userStore = new Store({ user: null, loading: false });

// ç»„ä»¶ä¸­
const user = useStore(userStore, state => state.user);

function Login() {
  const loading = useStore(userStore, state => state.loading);
  
  const handleLogin = async (credentials) => {
    userStore.setState({ loading: true });
    try {
      const user = await api.login(credentials);
      userStore.setState({ user, loading: false });
    } catch (error) {
      userStore.setState({ loading: false });
      // å¤„ç†é”™è¯¯
    }
  };
}
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- **è§£è€¦**ï¼šå‘å¸ƒè€…ä¸è®¢é˜…è€…æ— ç›´æ¥ä¾èµ–
- **çµæ´»æ€§**ï¼šåŠ¨æ€æ·»åŠ /ç§»é™¤è®¢é˜…è€…
- **å¯æ‰©å±•**ï¼šæ”¯æŒå¤æ‚äº‹ä»¶æµ

**ç°ä»£å˜ä½“**ï¼š
- Reduxçš„subscribe
- RxJSçš„Observable
- Reactçš„Context API

---

### 4. æ•°æ®æµæ¨¡å¼ï¼šæ„å»ºé«˜æ•ˆä¿¡æ¯ç®¡é“

#### **è´£ä»»é“¾æ¨¡å¼ (Chain of Responsibility)**
**é—®é¢˜åœºæ™¯**ï¼š  
å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†è¯·æ±‚ï¼Œä½†å¤„ç†è€…ä¸ç¡®å®šï¼Œéœ€åŠ¨æ€ç¡®å®šï¼ˆå¦‚ä¸­é—´ä»¶ã€è¯·æ±‚å¤„ç†ç®¡é“ï¼‰

**BFFå±‚è¯·æ±‚å¤„ç†**ï¼š
```ts
// è¯·æ±‚ä¸Šä¸‹æ–‡
interface RequestContext {
  request: Request;
  response: Response;
  user?: User;
  errors?: Error[];
}

// å¤„ç†å™¨æ¥å£
interface RequestHandler {
  handle(context: RequestContext, next: () => Promise<void>): Promise<void>;
}

// èº«ä»½éªŒè¯å¤„ç†å™¨
class AuthHandler implements RequestHandler {
  async handle(context: RequestContext, next: () => Promise<void>) {
    const token = context.request.headers.get('Authorization')?.split(' ')[1];
    if (!token) {
      context.errors = [new Error('Unauthorized')];
      return;
    }
    
    try {
      context.user = await verifyToken(token);
      await next();
    } catch (error) {
      context.errors = [error];
    }
  }
}

// è¾“å…¥éªŒè¯å¤„ç†å™¨
class ValidationHandler implements RequestHandler {
  constructor(private schema: any) {}
  
  async handle(context: RequestContext, next: () => Promise<void>) {
    const validationResult = validate(context.request.body, this.schema);
    if (!validationResult.valid) {
      context.errors = validationResult.errors;
      return;
    }
    await next();
  }
}

// é”™è¯¯å¤„ç†å¤„ç†å™¨
class ErrorHandler implements RequestHandler {
  async handle(context: RequestContext, next: () => Promise<void>) {
    try {
      await next();
    } catch (error) {
      context.errors = [error];
    } finally {
      if (context.errors?.length) {
        context.response.status = 400;
        context.response.body = { errors: context.errors };
      }
    }
  }
}

// å¤„ç†å™¨é“¾
class RequestPipeline {
  private handlers: RequestHandler[] = [];
  
  use(handler: RequestHandler) {
    this.handlers.push(handler);
    return this;
  }
  
  async execute(context: RequestContext) {
    const iterator = this.handlers[Symbol.iterator]();
    
    const next = async (): Promise<void> => {
      const { value: handler, done } = iterator.next();
      if (!done && handler) {
        await handler.handle(context, next);
      }
    };
    
    await next();
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const pipeline = new RequestPipeline()
  .use(new ErrorHandler())
  .use(new AuthHandler())
  .use(new ValidationHandler(productSchema));

app.post('/products', async (req, res) => {
  const context = { request: req, response: res };
  await pipeline.execute(context);
  if (!context.errors) {
    // å¤„ç†ä¸šåŠ¡é€»è¾‘
  }
});
```

**æ¶æ„ä»·å€¼**ï¼š
- **è§£è€¦å¤„ç†é€»è¾‘**ï¼šæ¯ä¸ªå¤„ç†å™¨èŒè´£å•ä¸€
- **åŠ¨æ€ç»„åˆ**ï¼šæŒ‰éœ€ç»„è£…å¤„ç†é“¾
- **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šèº«ä»½éªŒè¯ã€éªŒè¯ã€ä¸šåŠ¡é€»è¾‘åˆ†ç¦»

**å‰ç«¯åº”ç”¨**ï¼š
- Reactä¸­é—´ä»¶ï¼ˆReduxï¼‰
- è¯·æ±‚æ‹¦æˆªå™¨ï¼ˆAxiosï¼‰
- è¡¨å•éªŒè¯ç®¡é“

#### **å‘½ä»¤æ¨¡å¼ (Command)**
**é—®é¢˜åœºæ™¯**ï¼š  
éœ€è¦å°†è¯·æ±‚å°è£…ä¸ºå¯¹è±¡ï¼Œæ”¯æŒæ’¤é”€/é‡åšã€é˜Ÿåˆ—åŒ–ã€æ—¥å¿—è®°å½•ï¼ˆå¦‚ç¼–è¾‘å™¨æ“ä½œã€äº‹åŠ¡å¤„ç†ï¼‰

**å¯Œæ–‡æœ¬ç¼–è¾‘å™¨å®ç°**ï¼š
```ts
// å‘½ä»¤æ¥å£
interface EditorCommand {
  execute(): void;
  undo(): void;
  redo(): void;
  // æ˜¯å¦å¯åˆå¹¶ï¼ˆä¼˜åŒ–å†å²è®°å½•ï¼‰
  canMergeWith?(previous: EditorCommand): boolean;
  mergeWith?(previous: EditorCommand): EditorCommand;
}

// æ’å…¥æ–‡æœ¬å‘½ä»¤
class InsertTextCommand implements EditorCommand {
  private previousState: string;
  
  constructor(
    private editor: TextEditor,
    private text: string,
    private position: number
  ) {
    this.previousState = editor.getContent();
  }
  
  execute() {
    this.editor.insertText(this.text, this.position);
  }
  
  undo() {
    this.editor.setContent(this.previousState);
  }
  
  redo() {
    this.execute();
  }
  
  canMergeWith(previous: EditorCommand): boolean {
    return previous instanceof InsertTextCommand &&
           this.position === previous.position + previous.text.length;
  }
  
  mergeWith(previous: InsertTextCommand): EditorCommand {
    return new InsertTextCommand(
      this.editor,
      previous.text + this.text,
      previous.position
    );
  }
}

// å‘½ä»¤å†å²ç®¡ç†
class CommandHistory {
  private commands: EditorCommand[] = [];
  private current = -1;
  
  execute(command: EditorCommand) {
    // å°è¯•åˆå¹¶å‘½ä»¤
    if (this.current >= 0) {
      const lastCommand = this.commands[this.current];
      if (lastCommand.canMergeWith?.(command)) {
        const merged = lastCommand.mergeWith(command);
        this.commands[this.current] = merged;
        merged.execute();
        return;
      }
    }
    
    // æ–°å‘½ä»¤
    command.execute();
    this.commands = this.commands.slice(0, this.current + 1);
    this.commands.push(command);
    this.current++;
  }
  
  undo() {
    if (this.current >= 0) {
      this.commands[this.current].undo();
      this.current--;
    }
  }
  
  redo() {
    if (this.current < this.commands.length - 1) {
      this.current++;
      this.commands[this.current].redo();
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const editor = new TextEditor();
const history = new CommandHistory();

// ç»‘å®šUIæ“ä½œ
document.getElementById('bold-btn').addEventListener('click', () => {
  history.execute(new ToggleFormatCommand(editor, 'bold'));
});

document.getElementById('undo-btn').addEventListener('click', () => {
  history.undo();
});

// å®æ—¶åä½œæ‰©å±•
class CollaborationAdapter {
  constructor(private history: CommandHistory) {}
  
  handleRemoteCommand(commandData: any) {
    const command = this.deserialize(commandData);
    this.history.execute(command);
  }
  
  private deserialize(data: any): EditorCommand {
    // å°†ç½‘ç»œæ•°æ®è½¬æ¢ä¸ºå‘½ä»¤å¯¹è±¡
    switch(data.type) {
      case 'insert':
        return new InsertTextCommand(
          editor, 
          data.text, 
          data.position
        );
      // ...
    }
  }
}
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- **æ“ä½œå¯åºåˆ—åŒ–**ï¼šæ”¯æŒæ’¤é”€/é‡åšã€å®æ—¶åä½œ
- **è§£è€¦è¯·æ±‚ä¸æ‰§è¡Œ**ï¼šå‘½ä»¤å¯æ’é˜Ÿã€å»¶è¿Ÿæ‰§è¡Œ
- **äº‹åŠ¡ç®¡ç†**ï¼šç»„åˆå‘½ä»¤å®ç°å¤æ‚äº‹åŠ¡

**ç°ä»£åº”ç”¨**ï¼š
- Reduxçš„action
- å®æ—¶åä½œç¼–è¾‘ï¼ˆOperational Transformationsï¼‰
- å‰ç«¯äº‹åŠ¡ç®¡ç†

---

## å››ã€ç°ä»£è®¾è®¡æ¨¡å¼ï¼šé€‚åº”æ–°æ¶æ„

### 1. å‰ç«¯ä¸“å±æ¨¡å¼

#### **æ¸²æŸ“æ¨¡å¼ (Render Props / Hooks)**
**é—®é¢˜åœºæ™¯**ï¼š  
ç»„ä»¶é—´å…±äº«çŠ¶æ€é€»è¾‘ï¼Œä½†ä¸å¸Œæœ›å¼ºåˆ¶ç»„ä»¶ç»§æ‰¿ï¼ˆå¦‚æ•°æ®è·å–ã€åŠ¨ç”»ã€è¡¨å•å¤„ç†ï¼‰

**å¯¹æ¯”å®ç°**ï¼š
```tsx
// Render Propsæ¨¡å¼
const DataFetcher = ({ url, children }) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    setLoading(true);
    fetch(url)
      .then(res => res.json())
      .then(setData)
      .finally(() => setLoading(false));
  }, [url]);
  
  return children({ data, loading });
};

// ä½¿ç”¨
<DataFetcher url="/api/users">
  {({ data, loading }) => (
    <div>
      {loading ? <Spinner /> : <UserList users={data} />}
    </div>
  )}
</DataFetcher>

// Hooksæ¨¡å¼ï¼ˆç°ä»£é¦–é€‰ï¼‰
const useDataFetcher = (url) => {
  const [data, setData] = useState(null);
  const [loading, setLoading] = useState(true);
  
  useEffect(() => {
    setLoading(true);
    fetch(url)
      .then(res => res.json())
      .then(setData)
      .finally(() => setLoading(false));
  }, [url]);
  
  return { data, loading };
};

// ä½¿ç”¨
const UserListPage = () => {
  const { data, loading } = useDataFetcher('/api/users');
  return (
    <div>
      {loading ? <Spinner /> : <UserList users={data} />}
    </div>
  );
};
```

**æ¶æ„ä»·å€¼**ï¼š
- **é€»è¾‘å¤ç”¨**ï¼šå…±äº«çŠ¶æ€é€»è¾‘ï¼Œè€Œéä»…UI
- **ç»„åˆä¼˜äºç»§æ‰¿**ï¼šé¿å…æ·±å±‚ç»„ä»¶æ ‘
- **ç±»å‹å®‰å…¨**ï¼šHooksæä¾›æ›´å¥½çš„TypeScriptæ”¯æŒ

**æ¨¡å¼æ¼”è¿›**ï¼š
- Render Props â†’ Hooks
- Hooks â†’ è‡ªå®šä¹‰Hooks
- ç»„åˆå¼APIï¼ˆVue 3ï¼‰

#### **çŠ¶æ€æå‡ (Lifting State Up)**
**é—®é¢˜åœºæ™¯**ï¼š  
å¤šä¸ªç»„ä»¶éœ€è¦å…±äº«çŠ¶æ€ï¼Œä¸”çŠ¶æ€å˜æ›´éœ€åŒæ­¥æ›´æ–°ï¼ˆå¦‚è¡¨å•ã€å®æ—¶åä½œï¼‰

**ç”µå•†ç­›é€‰ç»„ä»¶**ï¼š
```tsx
// ä¼ ç»Ÿæ–¹å¼ï¼šçŠ¶æ€åˆ†æ•£
const CategoryFilter = () => {
  const [selected, setSelected] = useState([]);
  // ...
};

const PriceFilter = () => {
  const [range, setRange] = useState([0, 1000]);
  // ...
};

// é—®é¢˜ï¼šæ— æ³•åŒæ­¥ç­›é€‰æ¡ä»¶

// çŠ¶æ€æå‡æ–¹æ¡ˆ
const ProductFilters = () => {
  const [filters, setFilters] = useState({
    categories: [],
    priceRange: [0, 1000],
    sortBy: 'relevance'
  });
  
  const updateFilter = (updates) => {
    setFilters(prev => ({ ...prev, ...updates }));
  };
  
  return (
    <div className="filters">
      <CategoryFilter 
        selected={filters.categories} 
        onChange={cats => updateFilter({ categories: cats })}
      />
      <PriceFilter 
        range={filters.priceRange} 
        onChange={range => updateFilter({ priceRange: range })}
      />
      <SortOptions 
        selected={filters.sortBy} 
        onChange={sort => updateFilter({ sortBy: sort })}
      />
      
      {/* çˆ¶ç»„ä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨å®Œæ•´ç­›é€‰æ¡ä»¶ */}
      <ProductList filters={filters} />
    </div>
  );
};

// å­ç»„ä»¶ï¼ˆæ— çŠ¶æ€ï¼‰
const CategoryFilter = ({ selected, onChange }) => (
  <div>
    {CATEGORIES.map(cat => (
      <Checkbox
        key={cat.id}
        checked={selected.includes(cat.id)}
        onChange={e => {
          const newSelected = e.target.checked
            ? [...selected, cat.id]
            : selected.filter(id => id !== cat.id);
          onChange(newSelected);
        }}
      >
        {cat.name}
      </Checkbox>
    ))}
  </div>
);
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- **å•ä¸€æ•°æ®æº**ï¼šé¿å…çŠ¶æ€ä¸ä¸€è‡´
- **å…³æ³¨ç‚¹åˆ†ç¦»**ï¼šçˆ¶ç»„ä»¶ç®¡ç†çŠ¶æ€ï¼Œå­ç»„ä»¶ä¸“æ³¨UI
- **å¯æµ‹è¯•æ€§**ï¼šå­ç»„ä»¶å˜ä¸ºçº¯å‡½æ•°

**ç°ä»£æ¼”è¿›**ï¼š
- ç»“åˆContext APIå®ç°è·¨å±‚çº§çŠ¶æ€å…±äº«
- Redux/Zustandç®¡ç†å¤æ‚çŠ¶æ€
- React Queryç®¡ç†æœåŠ¡ç«¯çŠ¶æ€

---

### 2. å¾®æœåŠ¡ä¸åˆ†å¸ƒå¼ç³»ç»Ÿæ¨¡å¼

#### **APIç½‘å…³æ¨¡å¼ (API Gateway)**
**é—®é¢˜åœºæ™¯**ï¼š  
å‰ç«¯éœ€è¦è°ƒç”¨å¤šä¸ªåç«¯æœåŠ¡ï¼Œä½†ç›´æ¥æš´éœ²å¾®æœåŠ¡ç»™å‰ç«¯å­˜åœ¨å®‰å…¨ã€æ€§èƒ½ã€å¤æ‚åº¦é—®é¢˜

**å‰ç«¯BFFå®ç°**ï¼š
```ts
// BFFå±‚ï¼ˆNode.jsï¼‰
import express from 'express';
import { fetchProducts } from './services/productService';
import { fetchUser } from './services/userService';

const app = express();

// ç»Ÿä¸€å…¥å£ç‚¹
app.get('/api/homepage', async (req, res) => {
  try {
    // å¹¶è¡Œè·å–æ•°æ®
    const [products, user] = await Promise.all([
      fetchProducts({ limit: 10 }),
      req.user ? fetchUser(req.user.id) : Promise.resolve(null)
    ]);
    
    // èšåˆæ•°æ®
    const data = {
      featuredProducts: products,
      userRecommendations: user ? generateRecommendations(user) : [],
      banners: getBanners(req.headers['x-device-type'])
    };
    
    res.json(data);
  } catch (error) {
    res.status(500).json({ error: 'Failed to load homepage' });
  }
});

// è®¾å¤‡é€‚é…
function getBanners(deviceType: string) {
  if (deviceType === 'mobile') {
    return MOBILE_BANNERS;
  }
  return DESKTOP_BANNERS;
}

// å‰ç«¯è°ƒç”¨
// const data = await fetch('/api/homepage');
```

**æ¶æ„ä»·å€¼**ï¼š
- **å‡å°‘è¯·æ±‚**ï¼šèšåˆå¤šä¸ªæœåŠ¡è°ƒç”¨
- **è®¾å¤‡é€‚é…**ï¼šä¸ºä¸åŒè®¾å¤‡æä¾›å®šåˆ¶å“åº”
- **å®‰å…¨éš”ç¦»**ï¼šéšè—å†…éƒ¨æœåŠ¡ç»†èŠ‚
- **åè®®è½¬æ¢**ï¼šç»Ÿä¸€REST/GraphQL/gRPC

**å‰ç«¯ç‰¹æ®Šè€ƒé‡**ï¼š
- ç»“åˆCDNå®ç°è¾¹ç¼˜è®¡ç®—
- è¯·æ±‚æ‰¹å¤„ç†å‡å°‘ç½‘ç»œå¼€é”€
- å®¢æˆ·ç«¯ç¼“å­˜ç­–ç•¥

#### **Circuit Breaker (ç†”æ–­å™¨)**
**é—®é¢˜åœºæ™¯**ï¼š  
åç«¯æœåŠ¡ä¸ç¨³å®šæ—¶ï¼Œé¿å…çº§è”æ•…éšœï¼Œæä¾›ä¼˜é›…é™çº§

**å‰ç«¯ç†”æ–­å™¨å®ç°**ï¼š
```ts
class CircuitBreaker {
  private failureCount = 0;
  private lastFailureTime: number | null = null;
  private isOpen = false;
  
  constructor(
    private readonly failureThreshold: number = 5,
    private readonly resetTimeout: number = 30000,
    private readonly fallback: () => any
  ) {}
  
  async execute<T>(operation: () => Promise<T>): Promise<T> {
    if (this.isOpen) {
      // æ£€æŸ¥æ˜¯å¦å¯ä»¥é‡è¯•
      if (this.lastFailureTime && Date.now() - this.lastFailureTime > this.resetTimeout) {
        this.isOpen = false;
      } else {
        return this.fallback();
      }
    }
    
    try {
      const result = await operation();
      // æˆåŠŸåé‡ç½®
      this.failureCount = 0;
      return result;
    } catch (error) {
      this.failureCount++;
      this.lastFailureTime = Date.now();
      
      if (this.failureCount >= this.failureThreshold) {
        this.isOpen = true;
      }
      
      return this.fallback();
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const userApiBreaker = new CircuitBreaker(
  3, // 3æ¬¡å¤±è´¥åç†”æ–­
  60000, // 1åˆ†é’Ÿåé‡è¯•
  () => ({ 
    user: null, 
    loading: false,
    error: 'æœåŠ¡æš‚æ—¶ä¸å¯ç”¨ï¼Œè¯·ç¨åå†è¯•'
  })
);

// APIæœåŠ¡
const userService = {
  async fetchUser(id: string) {
    return userApiBreaker.execute(async () => {
      const response = await fetch(`/api/users/${id}`);
      if (!response.ok) throw new Error('Failed to fetch user');
      return response.json();
    });
  }
};

// ç»„ä»¶ä¸­ä½¿ç”¨
const UserProfile = ({ userId }) => {
  const [state, setState] = useState({ loading: true, user: null, error: null });
  
  useEffect(() => {
    setState({ loading: true });
    userService.fetchUser(userId)
      .then(data => setState({ loading: false, user: data }))
      .catch(error => setState({ loading: false, error }));
  }, [userId]);
  
  // ...
};
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- **é˜²æ­¢çº§è”æ•…éšœ**ï¼šé¿å…ä¸€ä¸ªæœåŠ¡æ•…éšœæ‹–å®æ•´ä¸ªåº”ç”¨
- **ä¼˜é›…é™çº§**ï¼šæä¾›å¤‡ç”¨æ–¹æ¡ˆæå‡ç”¨æˆ·ä½“éªŒ
- **è‡ªåŠ¨æ¢å¤**ï¼šæœåŠ¡æ¢å¤åè‡ªåŠ¨é‡è¯•

**å‰ç«¯ç‰¹æ®Šè€ƒé‡**ï¼š
- ç»“åˆç¦»çº¿å­˜å‚¨æä¾›ç¦»çº¿ä½“éªŒ
- ç”¨æˆ·æç¤ºä¸åé¦ˆæœºåˆ¶
- å¤šçº§ç†”æ–­ï¼ˆæŒ‰åŠŸèƒ½åŸŸï¼‰

---

## äº”ã€è®¾è®¡æ¨¡å¼çš„é€‰æ‹©ç­–ç•¥ï¼šé¿å…è¿‡åº¦è®¾è®¡

### 1. æ¨¡å¼é€‰æ‹©å†³ç­–æ ‘
```mermaid
graph TD
  A[é‡åˆ°é—®é¢˜] --> B{é—®é¢˜é‡å¤å‡ºç°å—ï¼Ÿ}
  B -->|å¦| C[ç›´æ¥å®ç°]
  B -->|æ˜¯| D{æœ‰æ ‡å‡†è§£å†³æ–¹æ¡ˆå—ï¼Ÿ}
  D -->|å¦| E[åˆ›å»ºæ–°æ¨¡å¼]
  D -->|æ˜¯| F{æ¨¡å¼é€‚åˆå½“å‰è§„æ¨¡å—ï¼Ÿ}
  F -->|å¦| G[ç®€åŒ–æ¨¡å¼]
  F -->|æ˜¯| H{å›¢é˜Ÿç†Ÿæ‚‰è¯¥æ¨¡å¼å—ï¼Ÿ}
  H -->|å¦| I[åŸ¹è®­/æ–‡æ¡£]
  H -->|æ˜¯| J[åº”ç”¨æ¨¡å¼]
  J --> K[ç›‘æ§æ•ˆæœ]
  K --> L{æœ‰æ•ˆå—ï¼Ÿ}
  L -->|æ˜¯| M[ç»§ç»­ä½¿ç”¨]
  L -->|å¦| N[è°ƒæ•´/æ›¿æ¢]
```

### 2. é¿å…è¿‡åº¦è®¾è®¡çš„é»„é‡‘æ³•åˆ™
| é—®é¢˜ | ä¿¡å· | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| **è¿‡æ—©æŠ½è±¡** | æ¨¡å¼ä»…ç”¨äºå•ä¸€å®ç° | å»¶è¿ŸæŠ½è±¡ï¼Œå…ˆå†™å…·ä½“å®ç° |
| **è¿‡åº¦åˆ†å±‚** | ç®€å•æ“ä½œéœ€ç©¿è¶Šå¤šå±‚ | åˆå¹¶ç›¸é‚»å±‚ï¼Œå‡å°‘è·³è½¬ |
| **æ¨¡å¼å †å ** | å¤šä¸ªæ¨¡å¼åµŒå¥—ä½¿ç”¨ | ç®€åŒ–ä¸ºå•ä¸€æ¨¡å¼æˆ–ç›´æ¥å®ç° |
| **æ–‡æ¡£ç¼ºå¤±** | æ–°äººæ— æ³•ç†è§£æ¨¡å¼ç”¨é€” | è¡¥å……æ¨¡å¼å†³ç­–æ–‡æ¡£ |
| **æµ‹è¯•å›°éš¾** | æ¨¡å¼å¢åŠ æµ‹è¯•å¤æ‚åº¦ | ç®€åŒ–æ¥å£ï¼Œèšç„¦æ ¸å¿ƒè¡Œä¸º |

### 3. æ¨¡å¼åº”ç”¨æ£€æŸ¥æ¸…å•
- [ ] é—®é¢˜æ˜¯å¦çœŸå®å­˜åœ¨ï¼Ÿï¼ˆè€Œéæƒ³è±¡ä¸­çš„é—®é¢˜ï¼‰
- [ ] æ¨¡å¼æ˜¯å¦ç®€åŒ–äº†ä»£ç ï¼Ÿï¼ˆè€Œéå¢åŠ å¤æ‚åº¦ï¼‰
- [ ] æ˜¯å¦æœ‰æ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Ÿ
- [ ] å›¢é˜Ÿæ˜¯å¦ç†è§£è¯¥æ¨¡å¼ï¼Ÿ
- [ ] æ¨¡å¼æ˜¯å¦å¯æµ‹è¯•ï¼Ÿ
- [ ] æ¨¡å¼æ˜¯å¦æ”¯æŒæœªæ¥æ‰©å±•ï¼Ÿ
- [ ] æ˜¯å¦æœ‰æ˜ç¡®çš„æ·˜æ±°æ¡ä»¶ï¼Ÿ

---

## å…­ã€å®æˆ˜æ¡ˆä¾‹ï¼šè®¾è®¡æ¨¡å¼åœ¨å¤æ‚ç³»ç»Ÿä¸­çš„åº”ç”¨

### 1. ç”µå•†å¹³å°å‰ç«¯æ¶æ„

#### **é—®é¢˜åŸŸåˆ†æ**
- **ç»„ä»¶æ„å»º**ï¼šå•†å“å¡ç‰‡ã€ç­›é€‰å™¨ã€è´­ç‰©è½¦ç­‰å¯å¤ç”¨ç»„ä»¶
- **ç³»ç»Ÿé›†æˆ**ï¼šå¤šä¸ªåç«¯æœåŠ¡ï¼ˆå•†å“ã€ç”¨æˆ·ã€è®¢å•ï¼‰
- **çŠ¶æ€ç®¡ç†**ï¼šè´­ç‰©è½¦ã€ç”¨æˆ·ä¼šè¯ã€ç­›é€‰æ¡ä»¶
- **æ•°æ®æµ**ï¼šå•†å“æœç´¢ã€ä¸‹å•æµç¨‹ã€å®æ—¶åº“å­˜

#### **æ¨¡å¼åº”ç”¨çŸ©é˜µ**
| é—®é¢˜åŸŸ | å…³é”®æ¨¡å¼ | å®ç°æ•ˆæœ |
|--------|----------|----------|
| **å•†å“å±•ç¤º** | ç»„åˆæ¨¡å¼ + é€‚é…å™¨ | ç»Ÿä¸€å¤„ç†ä¸åŒå•†å“ç±»å‹ |
| **æœç´¢ç­›é€‰** | çŠ¶æ€æ¨¡å¼ + å‘½ä»¤æ¨¡å¼ | å¤æ‚ç­›é€‰æ¡ä»¶ç®¡ç†ä¸æ’¤é”€ |
| **è´­ç‰©è½¦** | è§‚å¯Ÿè€…æ¨¡å¼ + å¤‡å¿˜å½• | å®æ—¶æ›´æ–°ä¸çŠ¶æ€æ¢å¤ |
| **ä¸‹å•æµç¨‹** | è´£ä»»é“¾æ¨¡å¼ | å¤šæ­¥éª¤éªŒè¯ä¸å¤„ç† |
| **è·¨è®¾å¤‡é€‚é…** | å¤–è§‚æ¨¡å¼ | ç»Ÿä¸€APIå¤„ç†ä¸åŒè®¾å¤‡éœ€æ±‚ |

**æ ¸å¿ƒå®ç°**ï¼š
```ts
// è´­ç‰©è½¦æœåŠ¡ï¼ˆè§‚å¯Ÿè€…+å¤‡å¿˜å½•ï¼‰
class CartService {
  private items: CartItem[] = [];
  private history: CartMemento[] = [];
  private currentIndex = -1;
  private observers: Function[] = [];
  
  addItem(item: CartItem) {
    this.saveState();
    const existing = this.items.find(i => i.id === item.id);
    if (existing) {
      existing.quantity += item.quantity;
    } else {
      this.items.push({...item});
    }
    this.notify();
  }
  
  removeItem(id: string) {
    this.saveState();
    this.items = this.items.filter(i => i.id !== id);
    this.notify();
  }
  
  // æ’¤é”€
  undo() {
    if (this.currentIndex > 0) {
      this.currentIndex--;
      this.restoreState(this.history[this.currentIndex]);
    }
  }
  
  // é‡åš
  redo() {
    if (this.currentIndex < this.history.length - 1) {
      this.currentIndex++;
      this.restoreState(this.history[this.currentIndex]);
    }
  }
  
  private saveState() {
    this.history = this.history.slice(0, this.currentIndex + 1);
    this.history.push(new CartMemento([...this.items]));
    this.currentIndex = this.history.length - 1;
  }
  
  private restoreState(memento: CartMemento) {
    this.items = memento.getState().map(i => ({...i}));
    this.notify();
  }
  
  private notify() {
    this.observers.forEach(observer => observer(this.items));
  }
  
  subscribe(observer: Function) {
    this.observers.push(observer);
    return () => {
      this.observers = this.observers.filter(o => o !== observer);
    };
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const cart = new CartService();

// ç»„ä»¶è®¢é˜…
const unsubscribe = cart.subscribe(items => {
  updateCartUI(items);
});

// æ’¤é”€/é‡åšæ”¯æŒ
document.getElementById('undo').addEventListener('click', () => cart.undo());
document.getElementById('redo').addEventListener('click', () => cart.redo());

// å®æ—¶åä½œæ‰©å±•
socket.on('cart:update', (update) => {
  // åº”ç”¨è¿œç¨‹æ›´æ–°
  cart.applyRemoteUpdate(update);
  
  // åˆå¹¶æœ¬åœ°å†å²
  cart.mergeRemoteHistory(update.historyToken);
});
```

**æ¶æ„ä»·å€¼**ï¼š
- è´­ç‰©è½¦çŠ¶æ€å˜æ›´å¯è¿½æº¯
- æ”¯æŒæ’¤é”€/é‡åšæå‡ç”¨æˆ·ä½“éªŒ
- å®æ—¶åä½œæ— ç¼é›†æˆ
- ä¸šåŠ¡é€»è¾‘ä¸UIå®Œå…¨è§£è€¦

---

### 2. å¾®å‰ç«¯æ¶æ„ä¸­çš„æ¨¡å¼åº”ç”¨

#### **æ ¸å¿ƒæŒ‘æˆ˜**
- å­åº”ç”¨ç‹¬ç«‹å¼€å‘éƒ¨ç½²
- å…±äº«ä¾èµ–ç®¡ç†
- è·¨åº”ç”¨é€šä¿¡
- ç»Ÿä¸€ç”¨æˆ·ä½“éªŒ

#### **æ¨¡å¼ç»„åˆè§£å†³æ–¹æ¡ˆ**
```mermaid
graph LR
  A[å®¹å™¨åº”ç”¨] -->|æ¨¡å—è”é‚¦| B[å­åº”ç”¨A]
  A -->|æ¨¡å—è”é‚¦| C[å­åº”ç”¨B]
  A -->|å¤–è§‚æ¨¡å¼| D[è®¾è®¡ç³»ç»Ÿ]
  B -->|é€‚é…å™¨| E[å…±äº«æœåŠ¡]
  C -->|é€‚é…å™¨| E
  A -->|è§‚å¯Ÿè€…| F[å…¨å±€çŠ¶æ€]
  B -->|è§‚å¯Ÿè€…| F
  C -->|è§‚å¯Ÿè€…| F
```

**å…³é”®å®ç°**ï¼š
```ts
// 1. æ¨¡å—è”é‚¦å…±äº«ï¼ˆåˆ›å»ºå‹ï¼‰
// å®¹å™¨åº”ç”¨ webpack.config.js
new ModuleFederationPlugin({
  name: 'container',
  remotes: {
    'productApp': 'productApp@http://products.example.com/remoteEntry.js',
    'cartApp': 'cartApp@http://cart.example.com/remoteEntry.js'
  },
  shared: {
    react: { singleton: true, eager: true },
    'react-dom': { singleton: true, eager: true },
    'design-system': { 
      singleton: true, 
      eager: true,
      requiredVersion: '^1.0.0'
    }
  }
});

// 2. è®¾è®¡ç³»ç»Ÿå¤–è§‚ï¼ˆå¤–è§‚æ¨¡å¼ï¼‰
// design-system.ts
import { Button as DSButton } from 'design-system';

export const Button = ({ variant, ...props }) => {
  // è½¬æ¢å˜ä½“ä¸ºè®¾è®¡ç³»ç»Ÿæ¥å—çš„æ ¼å¼
  const dsVariant = variant === 'primary' ? 'solid' : 'outline';
  return <DSButton variant={dsVariant} {...props} />;
};

// 3. å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆè§‚å¯Ÿè€…æ¨¡å¼ï¼‰
// global-state.ts
class GlobalState {
  private state = {
    user: null,
    theme: 'light',
    cartCount: 0
  };
  
  private observers: Function[] = [];
  
  setState(updates: Partial<typeof this.state>) {
    this.state = { ...this.state, ...updates };
    this.notify();
  }
  
  subscribe(observer: Function) {
    this.observers.push(observer);
    // ç«‹å³é€šçŸ¥å½“å‰çŠ¶æ€
    observer(this.state);
    return () => {
      this.observers = this.observers.filter(o => o !== observer);
    };
  }
  
  private notify() {
    this.observers.forEach(observer => observer(this.state));
  }
}

export const globalState = new GlobalState();

// 4. å­åº”ç”¨é›†æˆ
// product-app/main.ts
import { globalState } from 'container/global-state';

// è®¢é˜…ç”¨æˆ·çŠ¶æ€
const unsubscribe = globalState.subscribe(state => {
  if (state.user) {
    loadPersonalizedData(state.user.id);
  }
});

// æ›´æ–°è´­ç‰©è½¦æ•°é‡
const updateCartCount = (count) => {
  globalState.setState({ cartCount: count });
};
```

**æ¶æ„ä¼˜åŠ¿**ï¼š
- å­åº”ç”¨å®Œå…¨ç‹¬ç«‹å¼€å‘éƒ¨ç½²
- è®¾è®¡ç³»ç»Ÿç»Ÿä¸€ä¿éšœä½“éªŒä¸€è‡´æ€§
- å…¨å±€çŠ¶æ€ç®¡ç†è§£è€¦åº”ç”¨é€šä¿¡
- å…±äº«ä¾èµ–ç²¾ç¡®æ§åˆ¶ç‰ˆæœ¬

---

## ä¸ƒã€è®¾è®¡æ¨¡å¼ä¸æ¶æ„æ¼”è¿›

### 1. æ¨¡å¼éšç³»ç»Ÿæ¼”è¿›çš„ç”Ÿå‘½å‘¨æœŸ
```mermaid
graph LR
  A[åˆå§‹é˜¶æ®µ] -->|ç®€å•å®ç°| B[è¯†åˆ«é‡å¤æ¨¡å¼]
  B --> C[æ˜¾å¼åº”ç”¨æ¨¡å¼]
  C --> D[æ¨¡å¼æ–‡æ¡£åŒ–]
  D --> E[æ¨¡å¼ä¼˜åŒ–]
  E --> F[æ¨¡å¼æ·˜æ±°]
  F --> G[æ–°é—®é¢˜è¯†åˆ«]
  G --> B
```

**æ¼”è¿›æ¡ˆä¾‹ï¼šçŠ¶æ€ç®¡ç†**
- **åˆå§‹é˜¶æ®µ**ï¼šç»„ä»¶å†…useState
- **è¯†åˆ«é—®é¢˜**ï¼šè·¨ç»„ä»¶çŠ¶æ€å…±äº«å›°éš¾
- **åº”ç”¨æ¨¡å¼**ï¼šContext API
- **ä¼˜åŒ–**ï¼šæ‹†åˆ†ä¸ºå¤šä¸ªContextï¼Œç»“åˆuseReducer
- **æ¼”è¿›**ï¼šå¼•å…¥Zustandç®¡ç†å¤æ‚çŠ¶æ€
- **æ·˜æ±°**ï¼šç®€å•åœºæ™¯å›å½’useState

### 2. æ¨¡å¼ä¸æŠ€æœ¯å€ºåŠ¡ç®¡ç†
| æ¨¡å¼é˜¶æ®µ | æŠ€æœ¯å€ºåŠ¡é£é™© | ç®¡ç†ç­–ç•¥ |
|----------|--------------|----------|
| **å¼•å…¥æœŸ** | è¿‡æ—©æŠ½è±¡ | ä¸¥æ ¼éªŒè¯é—®é¢˜çœŸå®æ€§ |
| **æˆç†ŸæœŸ** | æ¨¡å¼å›ºåŒ– | å®šæœŸè¯„ä¼°æ¨¡å¼æœ‰æ•ˆæ€§ |
| **è¿‡æ—¶æœŸ** | é˜»ç¢æ¼”è¿› | åˆ¶å®šæ·˜æ±°è·¯çº¿å›¾ |
| **æ·˜æ±°æœŸ** | æ›¿ä»£æ–¹æ¡ˆé£é™© | æ¸è¿›å¼æ›¿æ¢ |

**å€ºåŠ¡ç®¡ç†å®è·µ**ï¼š
```markdown
## CartService æ¨¡å¼è¯„ä¼° (2023-08-15)

**å½“å‰æ¨¡å¼**: è§‚å¯Ÿè€… + å¤‡å¿˜å½•

**ä¼˜ç‚¹**:
- æ”¯æŒæ’¤é”€/é‡åšåŠŸèƒ½
- å®æ—¶åä½œé›†æˆè‰¯å¥½
- çŠ¶æ€å˜æ›´å¯è¿½æº¯

**é—®é¢˜**:
- å¤æ‚åº¦é«˜ï¼Œæ–°åŠŸèƒ½å¼€å‘æ…¢
- æµ‹è¯•è¦†ç›–ä¸è¶³ (72%)
- ä¸æ–°çŠ¶æ€ç®¡ç†æ–¹æ¡ˆä¸å…¼å®¹

**å»ºè®®**:
1. çŸ­æœŸ: æ·»åŠ è‡ªåŠ¨åŒ–æµ‹è¯• (ç›®æ ‡ > 90%)
2. ä¸­æœŸ: å°è£…æ ¸å¿ƒAPIï¼Œå‡†å¤‡æ›¿æ¢å®ç°
3. é•¿æœŸ: è¿ç§»åˆ°Zustand + è‡ªå®šä¹‰ä¸­é—´ä»¶

**æ·˜æ±°æŒ‡æ ‡**:
- æ–°å¢åŠŸèƒ½å¼€å‘æ—¶é—´ > 3å¤©
- å…³é”®è·¯å¾„bugç‡ > 5%
- å›¢é˜Ÿæ»¡æ„åº¦ < 3/5
```

---

## å…«ã€æ€»ç»“ï¼šè®¾è®¡æ¨¡å¼çš„æ¶æ„æ€ç»´

| ç»´åº¦ | é”™è¯¯è®¤çŸ¥ | æ­£ç¡®å®è·µ |
|------|----------|----------|
| **æœ¬è´¨** | "ä»£ç æ¨¡æ¿" | **é—®é¢˜åŸŸçš„æ€ç»´æ¡†æ¶** |
| **åº”ç”¨** | ä¸€æ¬¡æ€§å†³ç­– | **éšç³»ç»Ÿæ¼”è¿›çš„æ´»æ–‡æ¡£** |
| **ä»·å€¼** | ä»£ç å¤ç”¨ | **é™ä½è®¤çŸ¥è´Ÿè·** |
| **æ²»ç†** | å¼€å‘è€…è‡ªç”±å‘æŒ¥ | **æ¨¡å¼å†³ç­–æ–‡æ¡£åŒ–** |

> âœ… **æ¶æ„å¸ˆç»ˆæå»ºè®®**ï¼š
> 1. **é—®é¢˜å…ˆäºæ¨¡å¼**ï¼šå…ˆå®šä¹‰é—®é¢˜ï¼Œå†é€‰æ‹©æ¨¡å¼
> 2. **æ¸è¿›å¼åº”ç”¨**ï¼šä»å°å¤„å¼€å§‹ï¼Œé€æ­¥æ‰©å±•
> 3. **æ–‡æ¡£å³è®¾è®¡**ï¼šè®°å½•æ¨¡å¼é€‰æ‹©ç†ç”±å’Œæ·˜æ±°æ¡ä»¶
> 4. **ç»„åˆä¼˜äºå•ä¸€**ï¼šæ¨¡å¼ç»„åˆè§£å†³å¤æ‚é—®é¢˜
> 5. **æ¼”è¿›å³å¸¸æ€**ï¼šå®šæœŸè¯„ä¼°æ¨¡å¼æœ‰æ•ˆæ€§

è®¾è®¡æ¨¡å¼ä¸ä»…æ˜¯æŠ€æœ¯å·¥å…·ï¼Œæ›´æ˜¯**å›¢é˜Ÿè®¤çŸ¥çš„å…±äº«è¯­è¨€**å’Œ**ç³»ç»Ÿæ¼”è¿›çš„å¯¼èˆªå›¾**ã€‚ä½œä¸ºæ¶æ„å¸ˆï¼Œä½ çš„æ¨¡å¼é€‰æ‹©å°†å†³å®šï¼š  
ğŸ›¡ï¸ **ç³»ç»Ÿå¯ç»´æŠ¤æ€§**ï¼šé™ä½50%çš„ä¿®æ”¹æˆæœ¬  
ğŸš€ **å›¢é˜Ÿæ•ˆç‡**ï¼šæå‡300%çš„é—®é¢˜è§£å†³é€Ÿåº¦  
ğŸ’¡ **æŠ€æœ¯æ¼”è¿›**ï¼šæ”¯æŒå¹³æ»‘æ¶æ„è¿ç§»  

> å¦‚æœéœ€è¦å…·ä½“åœºæ™¯çš„æ¨¡å¼åº”ç”¨æŒ‡å—ï¼ˆå¦‚"å¾®å‰ç«¯æ¶æ„ä¸­çš„æ¨¡å¼ç»„åˆç­–ç•¥"æˆ–"å‰ç«¯çŠ¶æ€ç®¡ç†æ¨¡å¼æ¼”è¿›è·¯çº¿å›¾"ï¼‰ï¼Œæˆ‘å¯ä»¥æä¾›å¯è½åœ°çš„æ¶æ„è“å›¾å’Œå†³ç­–æ¡†æ¶ï¼ ğŸ’»