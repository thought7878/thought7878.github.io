

# 前端页面

## 简介

*部署前端页面有多种方法*，你可以选择最适合你项目需求和你自己技术背景的方式。以下是一些**常见的部署方式：**

1. **FTP上传：** 这是*最传统*的方式，将你的前端文件（HTML，CSS，JavaScript等）上传到你的web服务器。大多数的web主机提供FTP访问，这也是*小型项目的快速部署*方式。
2. **使用Git：** 如果你的服务器支持Git，你可以设置一个Git仓库，并使用 `git push` 命令部署你的前端页面。这种方式方便版本控制，也支持多人协作。
3. **使用SSH：** 可以通过SSH*将你的文件推送到你的服务器*，这个过程可以通过脚本自动化。
4. **使用云服务：** 像AWS S3，Google Cloud Storage，Azure Storage等服务可以*托管静态网站*，通常它们提供了很好的性能和安全性。
5. **使用专门的前端部署服务：** 服务如*Netlify，Vercel*等，这些平台通常*提供一站式服务*，包括*版本控制，持续集成，HTTPS和CDN*等。
6. **使用CDN服务：** 这些服务可以*将你的站点部署到全球的服务器上，加速访问速度*。例如，Cloudflare，Akamai等。
7. **容器化部署：** 使用如*Docker*等工具，*将前端应用容器化*，然后在Kubernetes等容器编排平台进行部署。

以上的部署方式有的适合小型项目，有的适合大型项目，有的需要更多的技术知识，选择哪一种方式取决于你的具体需求。

## 部署方式比较

| 技术                                   | 优点                    | 缺点                  | 出现时间                                     | 适合场景                     | 不适合场景                         |
| ------------------------------------ | --------------------- | ------------------- | ---------------------------------------- | ------------------------ | ----------------------------- |
| Nginx                                | 轻量级，高性能，可作为反向代理和负载均衡器 | 需要手动配置和管理           | 2004年                                    | 任何需要静态页面服务的项目            | 需要动态服务器端渲染的项目                 |
| PM2 Serve                            | 可以使用PM2来管理静态服务进程      | 不包含反向代理或负载均衡器       | PM2:2014年                                | 需要简单的静态文件服务              | 需要复杂的HTTP请求处理或负载均衡的项目         |
| Docker                               | 容器化，跨平台               | 需要手动管理容器和镜像，比其他选项复杂 | 2013年                                    | 任何需要跨平台部署或以统一方式部署多种服务的项目 | 小规模或简单的项目，因为Docker可能引入不必要的复杂性 |
| GitHub Pages                         | 免费，支持自定义域名，集成GitHub   | 功能有限，仅支持静态内容        | 2008年                                    | 简单的个人、项目或组织页面            | 复杂的、需要后端的应用                   |
| Netlify/Vercel                       | 提供自动部署，函数即服务等         | 免费版有一些限制            | Netlify:2014年, Vercel:2015年              | 静态网站和Jamstack应用          | 大规模、复杂的后端应用                   |
| 云存储服务 (AWS S3, Google Cloud Storage) | 简单，可扩展，集成CDN          | 需要配置权限和CDN          | AWS S3:2006年, Google Cloud Storage:2010年 | 静态网站，或需要大规模存储的应用         | 需要后端逻辑的应用                     |

同样，你应该根据你的具体需求来选择最适合的部署方法。例如，如果你的网站很简单，GitHub Pages可能就足够了。如果你需要一些后端逻辑，但不想管理服务器，那么Netlify或Vercel可能是一个好选择。如果你需要完全的控制和可扩展性，Docker或云存储服务可能更合适。


## Nginx

配置Nginx来为前端页面提供服务通常需要以下步骤：

**步骤1：上传代码**

首先，你需要将你的前端代码*上传到服务器上的某个目录*，比如 `**/var/www/mywebsite**`。

**步骤2：创建Nginx配置文件**

Nginx的配置文件通常位于 `**/etc/nginx/**` 目录下，具体路径可能会因服务器的不同而略有不同。在该目录下，你通常会找到一个叫做 `**sites-available**` 的目录。在这个目录下，你可以为每个网站创建一个配置文件。例如，你可以创建一个新的配置文件，命名为 `**mywebsite**`：

```
sudo nano /etc/nginx/sites-available/mywebsite
```

**步骤3：编辑Nginx配置文件**

在新建的配置文件中，你可以输入以下内容来*配置你的前端页面：*

```
server {
    listen 80;
    server_name your_domain_or_IP;

    location / {
        root /var/www/mywebsite;
        index index.html;
        try_files $uri $uri/ =404;
    }
}
```

其中 `**your_domain_or_IP**` 应该替换为*你的域名或者IP地址*，`**/var/www/mywebsite**` 应该替换为*你的代码所在的目录*。此配置意味着*Nginx将监听80端口*，并为所有指向你的域名或IP地址的请求提供服务。*默认文档为index.html*，如果请求的文件不存在，Nginx将返回404状态码。

**步骤4：启用网站**

创建并编辑完配置文件后，你需要创建一个到 `**sites-enabled**` 目录的符号链接来启用你的网站：

```
sudo ln -s /etc/nginx/sites-available/mywebsite /etc/nginx/sites-enabled/
```

**步骤5：检查配置文件**

在重启Nginx之前，你应该检查你的配置文件有没有语法错误：

```
sudo nginx -t
```

如果没有错误，你会看到类似这样的输出：

```
nginx: configuration file /etc/nginx/nginx.conf test is successful
```

**步骤6：重启Nginx**

最后，你需要重启Nginx来使你的配置生效：

```
sudo service nginx restart
```

现在你的前端页面应该可以通过你的域名或IP地址访问了。注意，如果你的服务器有防火墙，你可能需要配置防火墙来允许HTTP和HTTPS流量。

**更完整的 Nginx 配置**

首先，你需要为你的域名获取一个SSL证书，你可以使用Let's Encrypt提供的免费证书。

配置文件可能如下：

```
server {
    listen 80;
    server_name your_domain_or_IP;
    return 301 https://$host$request_uri;
}

server {
    listen 443 ssl;

    server_name your_domain_or_IP;

    ssl_certificate /etc/letsencrypt/live/your_domain_or_IP/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your_domain_or_IP/privkey.pem;

    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";

    location / {
        root /var/www/mywebsite;
        index index.html;
        try_files $uri $uri/ =404;
    }

    location ~* \\.(jpg|jpeg|png|gif|ico|css|js|pdf)$ {
        expires 30d;
    }

    gzip on;
    gzip_vary on;
    gzip_min_length 10240;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml;
    gzip_disable "MSIE [1-6]\\.";
}
```

以下是这个配置的一些解释：

- 第一个 `**server**` 块监听80端口，也就是HTTP的默认端口，然后把所有的请求重定向到HTTPS。
- 第二个 `**server**` 块监听443端口，也就是HTTPS的默认端口。
- `**ssl_certificate**` 和 `**ssl_certificate_key**` 指向你的SSL证书和私钥的位置。
- `**ssl_protocols**` 和 `**ssl_ciphers**` 定义了你服务器支持的SSL协议和加密套件。
- `**location /**` 块定义了你的网站的根目录和默认文件，以及如何处理不存在的路径。
- `**location ~* \\.(jpg|jpeg|png|gif|ico|css|js|pdf)$**` 块定义了对于静态文件如图片，CSS文件，JavaScript文件等，客户端应该缓存30天。
- `**gzip**` 相关的行启用了gzip压缩，并定义了哪些类型的文件应该被压缩。

这只是一个基本的配置样例，你可以根据你的需求进行修改。有许多其他的选项可以配置，例如负载均衡，反向代理，HTTP/2支持等。你可以查看Nginx的文档来了解更多信息。

### 负载均衡

使用 Nginx 来做负载均衡的实现非常直接。以下是一个简单的示例来说明如何配置 Nginx 来实现对多个服务器的负载均衡。

假设你有两个或更多的应用服务器实例，它们分别托管在不同的 IP 地址或主机名下**。你可以在 Nginx 配置文件中设置一个 upstream 模块，然后在 server 模块中将请求反向代理到这个 upstream。**

首先，你需要在你的 Nginx 配置文件（一般位于 /etc/nginx/nginx.conf 或 /etc/nginx/conf.d/ 目录下的某个文件）中定义一个 **upstream**。例如：

```
http {
    upstream myapp {
        server app1.example.com;
        server app2.example.com;
    }
    ...
}
```

在这个例子中，myapp 是你定义的 upstream 的名字，[**app1.example.com**](https://sspai.com/link?target=http%3A%2F%2Fapp1.example.com%2F) 和 [**app2.example.com**](https://sspai.com/link?target=http%3A%2F%2Fapp2.example.com%2F) 是你的应用服务器的地址。

然后，在 server 模块中，你可以将来自客户端的请求代理到这个 upstream：

```
server {
    listen 80;

    location / {
        proxy_pass <http://myapp>;
    }
}
```

在这个例子中，所有来自客户端的 HTTP 请求（即 :80 端口的请求）都会被 Nginx 转发到定义的 upstream（即 myapp）。Nginx 默认使用**轮询（round-robin）**算法将请求分配给 upstream 中的服务器，你也可以配置其他的负载均衡算法，如**最少连接（least_conn）**或 **IP 哈希（ip_hash**）。

这样，Nginx 就会把请求均衡地转发到你的各个应用服务器实例上，实现负载均衡。注意这个配置对于前端静态页面来说可能不太必要，因为静态页面通常不会对服务器产生太大负载，但对于动态应用来说是非常有用的。

## Docker

使用 Docker 来部署前端应用是一种很好的方式，因为它可以将你的应用及其依赖项打包到一个独立、可移植的容器中，可以在任何安装了 Docker 的环境中运行。

以下是使用 Docker 部署一个基本的静态前端页面的步骤：

**步骤1：创建 Dockerfile**

在你的项目根目录中，创建一个名为"**Dockerfile**"的文件。这个文件是用来定义你的 Docker 镜像的，可以看作是一个自动化的脚本。以下是一个简单的 Dockerfile 示例，其中使用了官方的 Nginx 镜像来部署静态页面：

```
# 使用官方的 Nginx 镜像
FROM nginx:latest

# 删除 Nginx 默认的静态资源
RUN rm -rf /usr/share/nginx/html/*

# 将你的静态资源复制到 Nginx 的静态资源目录下
COPY ./dist /usr/share/nginx/html

# 暴露 80 端口
EXPOSE 80

# 启动 Nginx
CMD ["nginx", "-g", "daemon off;"]
```

**步骤2：构建 Docker 镜像**

在项目根目录下，你可以使用 `**docker build**` 命令来根据 Dockerfile 构建 Docker 镜像：

```
docker build -t my-frontend-app .
```

其中，`**-t my-frontend-app**` 参数用于给你的 Docker 镜像命名，`**.**` 指定了 Dockerfile 所在的位置（在这里，它在当前目录下）。

**步骤3：运行 Docker 容器**

你现在可以使用 `**docker run**` 命令来运行你刚刚构建的 Docker 镜像：

```
docker run -p 80:80 -d my-frontend-app
```

- `**p 80:80**` 参数指定了将容器的 80 端口映射到宿主机的 80 端口，`**d**` 参数指定了以后台模式运行容器。

现在你应该可以在你的浏览器中通过访问 `**http://localhost**` 来查看你的前端页面了。

如果你的前端应用更复杂，或者需要与后端服务进行交互，你可能需要进行更复杂的配置，比如使用 **Docker Compose** 来管理多个服务，或者使用环境变量来配置你的应用。

### 负载均衡

如果你的前端应用使用 Docker 部署，有多种方式可以实现负载均衡。以下是一些常见的方法：

**1. 使用 Docker Swarm：**

Docker Swarm 是 Docker 的原生集群管理和编排工具。在 Swarm 集群中，你可以创建一个服务，然后指定服务的副本数量。Swarm 会自动在集群的节点间分配这些副本，实现负载均衡。

以下是一个简单的 Docker Swarm 服务创建命令：

```
docker service create --name my-frontend-app --publish 80:80 --replicas 3 my-frontend-app
```

在这个命令中，`**--name my-frontend-app**` 指定了服务的名称，`**--publish 80:80**` 指定了将容器的 80 端口映射到宿主机的 80 端口，`**--replicas 3**` 指定了创建 3 个副本，`**my-frontend-app**` 是你的 Docker 镜像的名称。

**2. 使用 Kubernetes：**

Kubernetes 是一个更强大的容器编排平台，它也支持负载均衡。在 Kubernetes 中，你可以创建一个 Deployment 和一个 Service，Kubernetes 会自动为你的应用提供负载均衡。

以下是一个简单的 Kubernetes Deployment 和 Service 的定义：

```
apiVersion: apps/v1
kind: Deployment
metadata:
  name: my-frontend-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: my-frontend-app
  template:
    metadata:
      labels:
        app: my-frontend-app
    spec:
      containers:
      - name: my-frontend-app
        image: my-frontend-app
        ports:
        - containerPort: 80

---

apiVersion: v1
kind: Service
metadata:
  name: my-frontend-app
spec:
  type: LoadBalancer
  ports:
  - port: 80
  selector:
    app: my-frontend-app
```

在这个定义中，Deployment 创建了 3 个前端应用的副本，Service 为这些副本提供了一个负载均衡器。

**3. 使用云服务提供商的负载均衡器：**

如果你的应用部署在云环境（如 AWS, Google Cloud, Azure 等），你可以使用云服务提供商的负载均衡服务。这些负载均衡服务通常提供了更强大的功能，比如自动扩缩容，健康检查，SSL 终结等。

以上都是实现 Docker 负载均衡的一些方式，你可以根据你的具体需求和环境选择最合适的方式。

## PM2

PM2 主要用于管理和维护 Node.js 应用，但是你也可以使用 PM2 来运行一个静态服务器，用来部署你的前端页面。这可以通过使用像 `**http-server**` 这样的简单的静态文件服务器来完成。

以下是使用 PM2 部署前端页面的步骤：

1. **安装 http-server**

首先，你需要在你的项目中安装 `**http-server**`。你可以使用 `**npm**` 来安装它：

```
npm install http-server --save
```

1. **创建 PM2 配置文件**

接下来，你需要创建一个 PM2 的配置文件，例如 `**ecosystem.config.js**`。在这个文件中，你需要指定 `**http-server**` 的路径和你的前端页面的路径：

```
javascriptCopy code
module.exports = {
  apps: [
    {
      name: 'frontend',
      script: 'node_modules/http-server/bin/http-server',
      args: './dist -p 8080', // 这里的 ./dist 是你的前端页面的路径，-p 8080 是你要监听的端口
      instances: 'max',
      exec_mode: 'cluster',
      watch: true, // 如果你希望在文件改变时自动重启服务器，可以设置 watch 为 true
      env: {
        NODE_ENV: 'production',
      },
    },
  ],
};
```

1. **使用 PM2 启动你的前端页面**

现在，你可以使用 PM2 来启动你的前端页面了：

```
pm2 start ecosystem.config.js
```

通过以上步骤，你就可以使用 PM2 和 `**http-server**` 来部署你的前端页面了。这种方式的好处是你可以利用 PM2 提供的特性，例如应用的自动重启和负载均衡。但需要注意的是，`**http-server**` 是一个非常简单的静态文件服务器，如果你需要更复杂的功能（例如 SSL、反向代理等），你可能需要考虑使用更强大的服务器软件，例如 Nginx 或 Express.js。


# 参考

[前端页面部署方式的全面解析与比较 - Notion](https://www.notion.so/b5f26e096a1e4e02945d0df6998f2c57)

[前端页面部署方式的全面解析与比较 - 少数派](https://sspai.com/post/81564)

[从 0 到 1，手把手教你部署自己的线上项目](https://www.bilibili.com/video/BV15D42137dF/?share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862)
