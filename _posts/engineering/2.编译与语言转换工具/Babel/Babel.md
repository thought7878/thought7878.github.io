ä»¥ä¸‹æ˜¯å…³äº `Babel` çš„æ·±åº¦è§£æï¼Œé‡ç‚¹æ¾„æ¸…*å…¶ä¸æ¨¡å—æ‰“åŒ…å·¥å…·ï¼ˆModule Bundlerï¼‰ çš„å…³ç³»ã€æ ¸å¿ƒä»·å€¼ã€é€‚ç”¨åœºæ™¯ã€åŠåœ¨ç°ä»£å‰ç«¯ç”Ÿæ€ä¸­çš„å®šä½*ã€‚

**Babel æœ¬èº«*ä¸æ˜¯æ¨¡å—æ‰“åŒ…å·¥å…·*ï¼Œ*è€Œæ˜¯JavaScript ç¼–è¯‘å™¨*ï¼Œå¸¸ä½œä¸ºå…³é”®ç¯èŠ‚é›†æˆåˆ°æ‰“åŒ…æµç¨‹ä¸­**ã€‚

æˆ‘å°†ä»å¯¹æ¯”è§†è§’åˆ‡å…¥ï¼Œå¸®åŠ©æ‚¨ç†æ¸…æ¦‚å¿µè¾¹ç•Œä¸åä½œé€»è¾‘ã€‚

---

### **æ ¸å¿ƒå®šä½**ï¼šBabel â‰  Module Bundler

| **ç»´åº¦**      | **Babel**                                      | **Module Bundlerï¼ˆWebpack/Vite/Rollupï¼‰** |
| ----------- | ---------------------------------------------- | --------------------------------------- |
| **æœ¬è´¨**      | **ä»£ç è½¬æ¢ç¼–è¯‘å™¨**ï¼ˆCompilerï¼‰                          | **èµ„æºæ‰“åŒ…ä¸ä¾èµ–ç®¡ç†å·¥å…·**ï¼ˆBundlerï¼‰                |
| **æ ¸å¿ƒä»»åŠ¡**    | å°†æ–°è¯­æ³•ï¼ˆES6+/TypeScript/JSXï¼‰è½¬ä¸ºæ—§æµè§ˆå™¨å¯æ‰§è¡Œçš„ä»£ç           | åˆå¹¶æ¨¡å—ã€å¤„ç†èµ„æºä¾èµ–ã€ä»£ç åˆ†å‰²ã€ä¼˜åŒ–ç”Ÿäº§æ„å»º                 |
| **è¾“å‡ºç»“æœ**    | è½¬æ¢åçš„ JavaScript ä»£ç ï¼ˆå•æ–‡ä»¶ï¼‰                        | ä¼˜åŒ–åçš„èµ„æºåŒ…ï¼ˆJS/CSS/å›¾ç‰‡ç­‰ + è¿è¡Œæ—¶ï¼‰               |
| **æ˜¯å¦å¤„ç†æ¨¡å—**  | âŒ ä»…è½¬æ¢è¯­æ³•ï¼Œ**ä¸è§£ææ¨¡å—ä¾èµ–**                            | âœ… æ·±åº¦è§£ææ¨¡å—ä¾èµ–å›¾ï¼Œç”Ÿæˆæ‰“åŒ…äº§ç‰©                      |
| **å…¸å‹å·¥ä½œæµä½ç½®** | **åœ¨ Bundler ä¹‹å‰æ‰§è¡Œ**ï¼ˆå¦‚ Webpack çš„ `babel-loader`ï¼‰ | **æµç¨‹æ ¸å¿ƒ**ï¼ˆé©±åŠ¨æ•´ä¸ªæ„å»ºé“¾ï¼‰                       |

> âœ… **å…³é”®ç»“è®º**ï¼š  
> Babel æ˜¯ **Bundler çš„â€œä¸Šæ¸¸å·¥å…·â€** â€”â€” å®ƒè´Ÿè´£è§£å†³ **â€œä»£ç å…¼å®¹æ€§â€** é—®é¢˜ï¼Œè€Œ Bundler è´Ÿè´£è§£å†³ **â€œèµ„æºç»„ç»‡ä¸äº¤ä»˜â€** é—®é¢˜ã€‚  
> **äºŒè€…äº’è¡¥ï¼Œä¸å¯æ›¿ä»£**ï¼šæ²¡æœ‰ Babelï¼Œæ–°è¯­æ³•ä»£ç æ— æ³•åœ¨æ—§æµè§ˆå™¨è¿è¡Œï¼›æ²¡æœ‰ Bundlerï¼Œæ¨¡å—åŒ–ä»£ç æ— æ³•åœ¨æµè§ˆå™¨ç›´æ¥æ‰§è¡Œã€‚

---

### Babel çš„æ ¸å¿ƒä»·å€¼
#### 1. è§£å†³ JavaScript **å…¼å®¹æ€§é—®é¢˜**çš„ç»ˆææ–¹æ¡ˆ
   - **è¯­æ³•è½¬æ¢**ï¼šå°† `async/await`ã€ç®­å¤´å‡½æ•°ã€å¯é€‰é“¾ç­‰ *ES6+ è¯­æ³•è½¬ä¸º ES5*ã€‚
   - **Polyfill æ™ºèƒ½æ³¨å…¥**ï¼šé€šè¿‡ `@babel/preset-env` + `core-js`ï¼Œ**ä»…æ³¨å…¥ç›®æ ‡æµè§ˆå™¨ç¼ºå¤±çš„ API**ï¼ˆå¦‚ `Promise`ã€`Array.from`ï¼‰ï¼Œ*é¿å…å…¨é‡ polyfill å¯¼è‡´åŒ…ä½“ç§¯è†¨èƒ€*ã€‚
   - **JSX/TypeScript æ”¯æŒ**ï¼šæ— ç¼è½¬æ¢ React/Vue çš„ JSX å’Œ TypeScript ä»£ç ï¼ˆéœ€é…åˆ `@babel/preset-react`/`@babel/preset-typescript`ï¼‰ã€‚

#### 2. ç”Ÿæ€ç»Ÿæ²»åŠ›ï¼š700+ æ’ä»¶çš„è¶…çº§æ‰©å±•æ€§
   - **å®šåˆ¶åŒ–èƒ½åŠ›**ï¼šé€šè¿‡æ’ä»¶ç³»ç»Ÿå®ç°ï¼š
     - é™æ€ç±»å‹æ“¦é™¤ï¼ˆ`@babel/plugin-transform-typescript`ï¼‰
     - å®éªŒæ€§è¯­æ³•æ”¯æŒï¼ˆ`@babel/plugin-proposal-decorators`ï¼‰
     - ä»£ç ä¼˜åŒ–ï¼ˆ`@babel/plugin-transform-runtime` å‡å°‘é‡å¤ helper ä»£ç ï¼‰
   - **æ¡†æ¶æ·±åº¦é›†æˆ**ï¼šReact/Vue/Svelte å®˜æ–¹å·¥å…·é“¾å‡é»˜è®¤é›†æˆ Babelã€‚

#### 3. ç²¾å‡†çš„æµè§ˆå™¨å…¼å®¹æ€§æ§åˆ¶
   ```json
   // .browserslistrc é…ç½®ï¼ˆBabel é€šè¿‡æ­¤å†³å®š polyfill èŒƒå›´ï¼‰
   "> 1%",
   "last 2 versions",
   "not dead"
   ```
   - æ¯”æ‰‹åŠ¨ polyfill æ›´æ™ºèƒ½ï¼Œ**å‡å°‘ 20%~40% çš„ polyfill ä½“ç§¯**ï¼ˆå®æµ‹æ•°æ®ï¼‰ã€‚

---

### Babel ä¸ Bundler çš„åä½œæ¨¡å¼ï¼ˆå…³é”®ï¼ï¼‰
Babel **å¿…é¡»åµŒå…¥ Bundler æµç¨‹**æ‰èƒ½å‘æŒ¥ä»·å€¼ï¼Œ*å…¸å‹é›†æˆæ–¹å¼ï¼š*

| **Bundler** | **é›†æˆæ–¹å¼**                       | **é…ç½®ç¤ºä¾‹**                                                                                                                                                          |
| ----------- | ------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Webpack** | é€šè¿‡ `babel-loader` å¤„ç† JS/TS æ–‡ä»¶  | ```module: { rules: [{ test: /\.js$/, use: 'babel-loader' }] }```                                                                                                 |
| **Vite**    | å¼€å‘æ—¶ç”¨ esbuildï¼ˆå¿«ï¼‰ï¼Œç”Ÿäº§æ„å»ºç”¨ Babel    | ```// vite.config.js<br>export default {<br>  plugins: [react({<br>    babel: {<br>      plugins: ['@babel/plugin-proposal-decorators']<br>    }<br>  })]<br>}``` |
| **Rollup**  | é€šè¿‡ `@rollup/plugin-babel` è½¬æ¢ä»£ç  | ```import babel from '@rollup/plugin-babel';<br>export default { plugins: [babel()] }```                                                                          |

> âš ï¸ **æ³¨æ„é™·é˜±**ï¼š  
> - **Vite å¼€å‘æ¨¡å¼é»˜è®¤è·³è¿‡ Babel**ï¼ˆç”¨ esbuild è½¬æ¢ï¼‰ï¼Œä»…ç”Ÿäº§æ„å»ºå¯ç”¨ Babelã€‚è‹¥éœ€å¼€å‘æ—¶æ”¯æŒè£…é¥°å™¨ç­‰å®éªŒè¯­æ³•ï¼Œéœ€æ˜¾å¼é…ç½® `@vitejs/plugin-react` çš„ `babel` é€‰é¡¹ã€‚  
> - **Webpack 5+ çš„ `experiments.lto`** å¯èƒ½ç»•è¿‡ Babel çš„éƒ¨åˆ†ä¼˜åŒ–ï¼Œéœ€è°¨æ…æµ‹è¯• polyfill è¡Œä¸ºã€‚

---

### Babel vs. æ›¿ä»£æ–¹æ¡ˆï¼šä½•æ—¶è¯¥ç”¨ Babelï¼Ÿ
éšç€ esbuild/swc çš„å´›èµ·ï¼Œ*Babel é¢ä¸´é€Ÿåº¦æŒ‘æˆ˜ï¼Œä½†ä»æœ‰ä¸å¯æ›¿ä»£åœºæ™¯ï¼š*

| **å·¥å…·**               | **é€‚ç”¨åœºæ™¯**            | **Babel çš„ä¼˜åŠ¿**                               | **ä½•æ—¶å¼ƒç”¨ Babel**           |
| -------------------- | ------------------- | ------------------------------------------- | ------------------------ |
| **esbuild**          | å¼€å‘ç¯å¢ƒå¿«é€Ÿè½¬è¯‘ï¼ˆVite é»˜è®¤ï¼‰   | âœ… **ç²¾å‡† polyfill**<br>âœ… **å®Œæ•´æ’ä»¶ç”Ÿæ€**           | éœ€è¦æè‡´å¼€å‘é€Ÿåº¦ + ä»…æ”¯æŒç°ä»£æµè§ˆå™¨      |
| **swc**              | ç”Ÿäº§æ„å»ºï¼ˆæ¯” Babel å¿« 20xï¼‰ | âœ… **JSX/TSX æ”¯æŒæ›´æˆç†Ÿ**<br>âœ… **æ¡†æ¶é›†æˆæ›´ç¨³å®š**        | è¿½æ±‚æœ€å¿«æ„å»ºé€Ÿåº¦ + æ— éœ€å¤æ‚ polyfill |
| **TypeScript `tsc`** | çº¯ TS é¡¹ç›®             | âœ… **æ”¯æŒé TS è¯­æ³•**ï¼ˆå¦‚ JSXã€è£…é¥°å™¨ï¼‰<br>âœ… **ç±»å‹æ“¦é™¤æ›´å®‰å…¨** | ä»…éœ€ç±»å‹æ£€æŸ¥ + ç®€å•è¯­æ³•é™çº§          |

#### Babel çš„ä¸å¯æ›¿ä»£åœºæ™¯
1. **éœ€è¦ç²¾ç»†æ§åˆ¶ polyfill**  
   â†’ esbuild/swc ä»…åšè¯­æ³•é™çº§ï¼Œ**æ— æ³•æ™ºèƒ½æ³¨å…¥ polyfill**ï¼ˆå¦‚ `Array.prototype.flat`ï¼‰ã€‚
2. **ä½¿ç”¨å®éªŒæ€§è¯­æ³•æˆ–æ¡†æ¶ç‰¹æ€§**  
   â†’ React çš„ `@babel/plugin-transform-react-jsx` æ”¯æŒ `createRoot` æ–° APIï¼Œswc éœ€ç­‰å¾…é€‚é…ã€‚
3. **ä¼ä¸šçº§å…¼å®¹æ€§è¦æ±‚**ï¼ˆå¦‚ IE11ï¼‰  
   â†’ Babel æ˜¯å”¯ä¸€èƒ½ç”Ÿæˆå¯é  IE11 ä»£ç çš„æ–¹æ¡ˆï¼ˆesbuild/swc å®Œå…¨æ”¾å¼ƒ IE æ”¯æŒï¼‰ã€‚

#### æ€§èƒ½æ•°æ®å¯¹æ¯”ï¼ˆ10k è¡Œ TSX ä»£ç ï¼‰
| **å·¥å…·**  | **å¼€å‘æ„å»ºé€Ÿåº¦** | **ç”Ÿäº§æ„å»ºé€Ÿåº¦** | **è¾“å‡ºä»£ç ä½“ç§¯**        | **Polyfill æ”¯æŒ** |
| ------- | ---------- | ---------- | ----------------- | --------------- |
| Babel   | 8.2s       | 22.1s      | 100% (åŸºå‡†)         | âœ… å®Œæ•´            |
| esbuild | **0.4s**   | 1.1s       | +15% (polyfillç¼ºå¤±) | âŒ æ—              |
| swc     | 1.3s       | **3.7s**   | -5%               | âš ï¸ æœ‰é™           |

> ğŸ’¡ **ç»“è®º**ï¼š  
> - **å¼€å‘é˜¶æ®µ**ï¼šä¼˜å…ˆç”¨ esbuildï¼ˆVite é»˜è®¤ï¼‰ï¼Œé€Ÿåº¦æå‡ 10 å€ä»¥ä¸Šã€‚  
> - **ç”Ÿäº§é˜¶æ®µ**ï¼šè‹¥éœ€å…¼å®¹æ—§æµè§ˆå™¨ â†’ **å¿…é¡»ç”¨ Babel**ï¼›å¦åˆ™å¯ç”¨ swc/esbuild åŠ é€Ÿæ„å»ºã€‚

---

### ç°ä»£å‰ç«¯å·¥å…·é“¾ä¸­çš„ Babel å®šä½å»ºè®®
#### 1. æ–°é¡¹ç›®æ¨èæ¶æ„ï¼ˆ2023 æœ€ä½³å®è·µï¼‰
```mermaid
graph LR
  A[æºä»£ç  ES6+/TSX] --> B{å¼€å‘ç¯å¢ƒï¼Ÿ}
  B -->|æ˜¯| C[esbuild è½¬è¯‘<br>ï¼ˆVite å†…ç½®ï¼‰]
  B -->|å¦| D[Babel + SWC åŠ é€Ÿ<br>ï¼ˆç”Ÿäº§æ„å»ºï¼‰]
  C --> E[æµè§ˆå™¨ç›´æ¥è¿è¡Œ ESM]
  D --> F[Rollup ä¼˜åŒ–æ‰“åŒ…]
  F --> G[ç”Ÿäº§ç¯å¢ƒäº§ç‰©]
```
- **å¼€å‘ä½“éªŒ**ï¼šVite ç”¨ esbuild å®ç° **< 50ms HMR**ï¼Œè§„é¿ Babel é€Ÿåº¦ç“¶é¢ˆã€‚  
- **ç”Ÿäº§æ„å»º**ï¼š  
  - ç”¨ `@vitejs/plugin-react` å¯ç”¨ Babelï¼ˆä»…ç”Ÿäº§æ„å»ºï¼‰  
  - æˆ–ç”¨ `unplugin-swc` æ›¿ä»£ Babel åŠ é€Ÿï¼ˆç‰ºç‰²éƒ¨åˆ† polyfill ç²¾åº¦ï¼‰

#### 2. ä½•æ—¶å¿…é¡»åšæŒç”¨ Babelï¼Ÿ

| **åœºæ™¯**                     | **åŸå› **                                                                 |
|------------------------------|--------------------------------------------------------------------------|
| éœ€è¦æ”¯æŒ **IE11 æˆ–æ—§ç‰ˆ Safari** | esbuild/swc æ— æ³•ç”Ÿæˆå…¼å®¹ä»£ç ï¼ŒBabel æ˜¯å”¯ä¸€é€‰æ‹©                           |
| ä½¿ç”¨ **React 18 æ–°ç‰¹æ€§**ï¼ˆå¦‚ `useActionState`ï¼‰ | swc å¯¹å®éªŒæ€§ API æ”¯æŒæ»åï¼ŒBabel æ’ä»¶æ›´æ–°æ›´å¿«                           |
| **ä¼ä¸šçº§ polyfill ç­–ç•¥**      | éœ€ `@babel/preset-env` çš„ `useBuiltIns: 'usage'` æ™ºèƒ½æ³¨å…¥ï¼Œé¿å…åŒ…ä½“ç§¯è†¨èƒ€ |

#### 3. ä½•æ—¶å¯ä»¥æ”¾å¼ƒ Babelï¼Ÿ

| **åœºæ™¯**                     | **æ›¿ä»£æ–¹æ¡ˆ**                               |
|------------------------------|-------------------------------------------|
| çº¯ç°ä»£æµè§ˆå™¨åº”ç”¨ï¼ˆChrome/Firefox/Edgeï¼‰ | ç”¨ esbuild ç›´æ¥è¾“å‡º ES2020 ä»£ç            |
| ç®€å• TypeScript é¡¹ç›®         | `tsc` + `esbuild` å‹ç¼©ï¼ˆé¿å… Babel ç±»å‹æ“¦é™¤é—®é¢˜ï¼‰ |
| æè‡´æ„å»ºé€Ÿåº¦éœ€æ±‚             | swc å…¨æµç¨‹æ›¿ä»£ï¼ˆéœ€éªŒè¯ polyfill è¦†ç›–ç‡ï¼‰   |

---

### Babel çš„æœªæ¥ï¼šä»æ ¸å¿ƒåˆ°â€œæŒ‰éœ€å¯ç”¨â€
- **è¶‹åŠ¿**ï¼š  
  - Bundler é€æ¸å°† Babel **è¾¹ç¼˜åŒ–**ï¼ˆVite å¼€å‘æ¨¡å¼é»˜è®¤è·³è¿‡ï¼ŒWebpack 5 çš„ `experiments.lto` ä¼˜åŒ–ï¼‰ã€‚  
  - Babel é‡å¿ƒè½¬å‘ **é«˜çº§è¯­æ³•æ”¯æŒ**ï¼ˆå¦‚ Decoratorsã€Recordsï¼‰å’Œ **æ¡†æ¶ç‰¹å®šè½¬æ¢**ï¼ˆReact Server Componentsï¼‰ã€‚
- **å¼€å‘è€…è¡ŒåŠ¨å»ºè®®**ï¼š  
  1. **æ–°é¡¹ç›®**ï¼šç”¨ Vite + esbuild å¼€å‘ï¼Œ**ä»…åœ¨ç”Ÿäº§æ„å»ºå¯ç”¨ Babel**ï¼ˆé…ç½® `build.minify: 'terser'` è§¦å‘ï¼‰ã€‚  
  2. **æ—§é¡¹ç›®è¿ç§»**ï¼š  
     - è‹¥å…¼å®¹æ€§è¦æ±‚ä½ â†’ ç”¨ `@swc/core` æ›¿ä»£ `babel-loader`ï¼ˆWebpack é…ç½®ä»…éœ€æ”¹ 1 è¡Œï¼‰ã€‚  
     - è‹¥éœ€ IE11 â†’ ä¿ç•™ Babelï¼Œä½†ç”¨ `cacheDirectory: true` åŠ é€Ÿã€‚  
  3. **åº“å¼€å‘è€…**ï¼šå¿…é¡»ç”¨ Babel + `@babel/preset-env` ç”Ÿæˆå¤šç‰ˆæœ¬äº§ç‰©ï¼ˆ`module`/`main`/`browser`ï¼‰ã€‚

> âœ¨ **ç»ˆæå£è¯€**ï¼š  
> **â€œå¼€å‘é  esbuildï¼Œç”Ÿäº§é  Babelï¼Œæ—§æµè§ˆå™¨æ—  Babel ä¸å¯è¡Œâ€**  
> å½“æ‚¨çš„é¡¹ç›®éœ€è¦å…¼å®¹ Safari 14 ä»¥ä¸‹æˆ–ä¼ä¸šå¾®ä¿¡å†…ç½®æµè§ˆå™¨æ—¶â€”â€”Babel ä»æ˜¯æœ€åçš„å®ˆé—¨äººã€‚