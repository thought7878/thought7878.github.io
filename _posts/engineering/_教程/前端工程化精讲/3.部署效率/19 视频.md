【前端工程化精讲】 https://www.bilibili.com/video/BV1mL411d76B/?p=20&share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862

视频讲述了部署流程中前端依赖安装效率优化的相关内容，具体如下：
- **课程引入与回顾**：[00:00]先回顾上节课内容，提及选择ci/cd工具的依据，包括*付费与否、云服务或自运维、对接上下游系统便捷性*等，随后引入本节课关于前端依赖安装效率优化的主题。
- **前端部署流程及优化点**：[00:44]说明前端项目部署流程包含*代码获取、依赖安装、执行构建、产物打包*等阶段，之前已讨论构建阶段优化，本节课聚焦安装阶段。
- **五种前端依赖安装方式**：[01:26]介绍了npm（node.js自带，使用广泛，测试用默认命令npm store）、yarn（facebook 2016年发布，依赖版本稳定性和安装效率较npm 5之前版本更优，测试用默认命令）、yarn with PnP（yarn 1.12版本后支持pnp功能，用软连接提升效率，测试用对应命令）、yarn v2（今年初发布，默认用优化后的pnp，需通过命令升级且安装在项目内部，测试用对应命令）、pnpm（2017年发布，支持确定性安装，*用硬连接和符号连接*，磁盘存储效率高，测试用pmpm store命令）。
- **依赖安装基本流程**：[04:20]分为解析依赖关系阶段（分析各依赖包关系及版本信息）、下载阶段（下载依赖包）、链接阶段（处理依赖目录和缓存的连接，npm在此阶段还有相关处理操作）。
- **执行时间与日志获取方法**：[05:19]npm和y的输出日志默认含执行时间，pnpm可通过系统time命令获取；获取详细日志的方式不同，npm加verbs，y和pnpm加fbs，y v2加--jason，pnpm加--reporter nd jason。
- **环境状态的五个分析维度**：[06:53]包括纯净环境（无log文件、历史安装目录和本地缓存）、log环境（有log文件，无缓存和历史安装目录）、缓存环境（有log文件和本地缓存，无历史安装目录）、无缓存的重复安装（有log文件和历史安装目录，无本地缓存）、有缓存环境（有log文件、历史安装目录和本地缓存），并说明测试时统一用淘宝镜像、基于mac设备和20兆网速。
- **不同环境对安装效率的影响**：[08:51]纯净环境中npm效率最快，y v2最慢，差异可能与网络并发数、依赖分析算法等有关；log环境下各工具安装时间缩短，主要优化依赖解析阶段；缓存环境下各安装方式耗时明显下降，主要优化下载阶段，y效率提升最明显；无缓存的重复安装环境中，存在安装目录对链接阶段有优化作用，y v1不带pnp版本表现最好，pnp模式性能较差；有缓存、log文件和安装目录的理想环境下，各工具耗时趋近于零，npm效率相对较低。
- **效率总结与工具选择**：[17:25]*效率最高的三个条件*是存在lock文件、本地缓存、安装记录；*综合来看pnpm最稳定高效*，现实中部署环境若支持相关留存，yarn v2版本是较好选择，仅lock文件存在时npm更优，无安装目录时yarn v1的pnp模式优于普通模式，yarn v2支持单个项目清除缓存不影响全局是其优势，选择工具还需考虑对构建过程的影响。
- **课程总结与后续预告**：[21:49]总结本节课讨论的依赖安装效率问题，强调不同安装方式和环境的影响，提出思考题，并预告下节课将讨论部署系统中构件提交的方案。