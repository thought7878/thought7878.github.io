Code Splitting With Webpack

视频讲述了如何*使用 Webpack 进行代码分割以优化网站加载速度*，通过模态框（modal）代码的按需加载为例展开讲解，具体如下：

## 介绍代码分割的目标

[00:00]
明确代码分割的核心目标是让网站访客下载尽可能少的数据，从而实现更快的加载速度，以模态框的 JavaScript 代码为例，说明非立即需要的代码无需在用户首次访问时就下载。

## 移除模态框代码的初始导入

[01:41]
指导在`app.js`文件中，删除导入模态框类以及创建模态框实例的代码，此时浏览器刷新后模态框功能将失效，为后续按需加载做准备。

## 设置模态框代码的按需加载逻辑

[02:34]
在`app.js`中，为带有`open modal`类的按钮添加点击事件监听器，点击时通过`import`方法动态加载模态框代码文件，该方法返回 Promise，需通过`then`处理加载成功逻辑、`catch`处理加载失败逻辑（如在控制台打印错误信息）。

## 处理模态框实例的作用域与重复加载问题

[05:55]
在全局作用域定义`modal`变量以保存模态框实例，避免实例仅在`then`函数作用域内可用；添加`if`判断，若`modal`为`undefined`（未加载过模态框代码）则执行加载逻辑，否则直接调用`open the modal`方法，防止重复加载。

## 优化模态框实例创建后的打开时机

[08:58]
在`if`块中创建模态框实例后，使用`setTimeout`设置 20 毫秒延迟，再调用`open the modal`方法，给浏览器时间创建对象、注入 HTML 到 DOM，确保模态框能正常打开。

## 修改模态框文件代码

[09:35]
在模态框文件中，删除构造函数中选择`open modal`按钮的代码、`events`方法中监听打开模态框点击事件的代码，以及`open the modal`方法中的`e`参数和`prevent default`语句，因为这些功能已在`app.js`中处理。

## 验证代码分割效果

[10:32]
通过浏览器开发者工具的“Network” tab 验证，首次刷新页面时不加载模态框代码，点击打开模态框按钮后，浏览器才会下载模态框相关的 JavaScript 文件（默认名为`zero dash bundled js`）及所需 SVG 图标。

## 自定义分割代码的文件名

[12:44]
在`app.js`的`import`方法路径前添加注释`/* webpackChunkName: "modal" */`，重启 Webpack 任务（执行`npm run dev`），之后动态加载的模态框代码文件将以自定义名称“modal”命名。

## 补充类实例存储与模块交互知识

[14:32]
说明若后续需访问类实例或调用其方法，需将类实例存储到变量中，反之则无需存储；对于复杂项目中模块间的交互，推荐使用`event emitter`包，使模块无需相互导入即可通过主 JavaScript 文件传递事件实现交互。

## 预告下节课内容

[16:58]
预告下节课将学习图片懒加载（Lazy Loading Images），为网站上线做进一步准备。
