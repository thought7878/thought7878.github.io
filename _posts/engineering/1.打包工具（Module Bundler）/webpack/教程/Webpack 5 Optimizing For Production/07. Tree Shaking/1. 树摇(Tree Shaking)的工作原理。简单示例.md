How Tree Shaking Works. Simple Example

【Webpack 5 Optimizing For Production_07. Tree Shaking】 https://www.bilibili.com/video/BV16zeMztE3C/?share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862

视频讲述了 Webpack 中*Tree Shaking 特性的概念、作用、适用场景*，并*通过实际项目示例演示其工作过程及启用方式*，具体如下：

## Tree Shaking 概念与作用

[00:00]
`Tree Shaking` 在 JavaScript 世界中指**代码消除**，Webpack 可借此从生产包中**移除未使用的代码，显著减少文件大小**；
*其收益因代码库而异，若有大量未使用的外部或内部库导入代码，能大幅改善生成包大小*，若不使用外部库且从头构建一切，则无明显收益。

## 创建演示项目

[00:47]
新建文件夹作为项目目录，生成 package.json 并使用默认设置；创建 conversation.js 文件，内有两个分别返回“你好”“你好吗”字符串的函数；创建 index.js 文件，仅导入 conversation.js 中的一个函数并调用打印到控制台。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/07. Tree Shaking/media/cf974f03d84a2a38c4a03ee73bf5552f_MD5.jpeg]]

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/07. Tree Shaking/media/738404b96abf7b6f53547e3e13a1ae41_MD5.jpeg]]

## 安装 Webpack 相关依赖

[02:23]
安装 webpack 和 webpack-cli 两个 npm 包，其中 webpack-cli 用于从命令行运行 webpack，且将这两个包作为开发依赖保存到 package.json。

## 开发模式下 Tree Shaking 效果

[03:26]
在 webpack 配置文件中暂时使用开发模式，运行 webpack 后生成的*打包文件未进行优化，仍保留未导入使用的函数*；
添加确定每个模块已使用导出的选项后，**Webpack 会标记未使用的导出，但未移除**。

没配置tree shaking：
![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/07. Tree Shaking/media/8a2070d1f13ede65886c019781d1f8de_MD5.jpeg]]

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/07. Tree Shaking/media/b42404b8be6fc8bc70825f36f0ee45e7_MD5.jpeg]]

配置tree shaking：
![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/07. Tree Shaking/media/df8f63c30eba768166ae90653fee474c_MD5.jpeg]]

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/07. Tree Shaking/media/6c339d3c1c98e9b639293e5b6fefa99c_MD5.jpeg]]

## 生产模式下 Tree Shaking 效果

[04:46]
将 webpack 配置中的模式改为生产，再次运行 webpack，**生成的包简洁，仅保留被导入使用的函数，因 Webpack 在生产模式下默认启用 Tree Shaking**。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/07. Tree Shaking/media/069f9df7ac7296ffd4b8e5f6924a599d_MD5.jpeg]]

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/07. Tree Shaking/media/0dc4285c3795e43854b7fe64989313b0_MD5.jpeg]]