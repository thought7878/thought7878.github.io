Extracting Generated CSS Into a Separate Bundle


视频讲述了*在Webpack 5中如何将生成的CSS提取到单独的bundle中*，以**优化生产环境下应用性能**的相关内容，具体如下：

## 开发与生产环境CSS打包差异及问题
[00:00]
开发和生产配置中对重要CSS文件使用相同规则，**`开发阶段`样式含在style标签、通过JavaScript运行时动态添加到DOM没问题；但 *`生产环境`将所有代码打包成单个bundle.js会导致文件庞大，加载时间长*，尤其对移动端慢速网络用户不友好**。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/a72538def39cfcd402158c36b275e1a7_MD5.jpeg]]

## 拆分CSS与JavaScript代码的优势
[01:06]
**优化应用性能的最佳实践之一**是`代码拆分`，Webpack在此方面表现出色，**先从将CSS与JavaScript分离开始，提取CSS到单独文件，与JavaScript包同时生成**，优势一是**每个包体积显著减小，下载更快**；二是**可并行加载多个文件，提升用户体验**。

## 调整Webpack配置以分离CSS
[02:03]
将现有CSS规则从通用配置文件移到开发配置文件，生产配置先粘贴相同规则再调整，需使用`mini-css-extract-plugin`插件，在文件顶部导入该插件，在Webpack配置中新增plugins数组并添加该插件，可指定生成CSS文件的名称，文件生成在output.path选项指定目录内，还可*根据入口点数量和需求设置文件名*，也能*在名称中添加内容哈希并指定哈希长度*。
可在JavaScript包名称中使用相同替换，将通用配置中的文件名定义移到开发和生产配置，且两者定义不同。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/7dcc9e8a0665f3a2cd6e0b3408c67e95_MD5.jpeg]]

## 替换加载器与安装插件
[05:31]
**为将CSS提取到单独文件**，*需用mini-css-extract-plugin提供的加载器替换style-loader*。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/a9bb858e9912551878ee034f72e08869_MD5.jpeg]]

## 验证文件生成与样式效果
[06:05]
运行Webpack后，磁盘目录会生成两个含内容哈希的动态名称文件（默认入口点生成的文件名为Main），需更新HTML文件中对生成包的引用，在浏览器打开HTML页面可看到样式正常工作，且样式不再在style标签内，而是在外部文件中。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/4e611a4471a6a198e830fdb094b22a4d_MD5.jpeg]]


## 代码修改对文件名的影响及后续处理
[08:11]
修改代码（如在JavaScript文件添加console.log语句）后，清理磁盘文件夹并运行Webpack构建，*JavaScript文件名因内容改变而变化*（内容哈希更改），CSS文件名因内容未变而不变，*无需每次修改代码都手动更新文件引用，Webpack会处理*，具体方式将在后续视频讲解。