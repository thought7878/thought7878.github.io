Another Way Of Removing Old Bundles

视频讲述了在 Webpack 中清理旧打包文件的两种方法，_重点介绍了`clean-webpack-plugin`插件的使用_，以解决`output.clean`选项在开发模式下的问题，具体如下：

## `output.clean`选项在开发模式的问题

[00:00]
此前视频介绍的`output.clean`选项在生产模式清理文件夹效果良好，但**在开发模式运行应用时存在问题**，修改 JavaScript 和 CSS 代码后，Webpack 不会删除磁盘文件夹中现有文件，反而不断生成新文件，导致文件冗余，**这是 Webpack 开发服务器和`output.clean`选项的已知 bug，未来会修复**。

## 介绍`clean-webpack-plugin`插件及安装

[03:05]
推荐使用`clean-webpack-plugin`插件清理文件，该插件在生产模式和 Webpack 开发服务器运行的开发模式下均有效，还可清理磁盘文件夹外的文件；
需前往终端安装该插件，之后进入通用 Webpack 配置，将插件添加到`plugins`数组，并在文件顶部导入该插件，同时注释掉`output.clean`选项（二者功能相同）。

## 验证`clean-webpack-plugin`插件效果

[04:31]
运行 Webpack 开发服务器并修改代码，可看到 Webpack 移除磁盘文件夹中先前生成的文件，修改 CSS 文件（如调整字体粗细）、JavaScript 代码（如添加或移除`console.log`语句）后，Webpack 会用含不同内容哈希的新文件替换旧文件，保持文件夹整洁。

## `clean-webpack-plugin`插件清理多文件夹配置

[05:55]
该插件可**清理多个文件夹**，需使用`cleanOneBeforeBuildPatterns`选项，该选项*在生成新文件前移除旧文件，可指定多个文件模式*，默认基于 Webpack 输出路径文件夹（如 dist 文件夹），移除其中所有文件及子文件夹；
若要删除输出路径外的文件，需指定文件模式的绝对路径，配置后运行 Webpack 开发服务器，可验证构建文件夹被清空。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/7f129f362516620c3b29ebc7187079a9_MD5.jpeg]]

## 总结两种清理方法及选择建议

[08:23]
`CleanWebpackPlugin`在生产和开发模式均表现良好，`output.clean`选项目前在与 Webpack 服务器配合使用时存在问题（暂时未修复），可根据需求选择；
视频作者因主要处理生产配置，选择重新使用`output.clean`选项，移除`clean-webpack-plugin`并卸载该插件，同时删除不再使用的 build 文件夹。
