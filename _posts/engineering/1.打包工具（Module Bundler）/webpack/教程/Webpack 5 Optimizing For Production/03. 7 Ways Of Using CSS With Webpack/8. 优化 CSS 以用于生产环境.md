Optimizing Your CSS For Production

视频讲述了在 Webpack 构建过程中*如何优化生产环境下生成的 CSS*，具体如下：

## CSS 优化需求、Webpack 默认问题

[00:00]
之前视频讨论了 CSS 模块与 Webpack 配置，*本期聚焦优化 Webpack 生成的 CSS*；
默认情况下，Webpack 生产模式会合并 JS 文件，但 **CSS 文件未压缩且保留注释代码，而生产环境需精简 CSS**，理想状态下还需多轮优化。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/f787fe6e9f93150511158da7b6fe22fd_MD5.jpeg]]

## CSS Nano 优化工具 

[01:22]
`CSS Nano` **可压缩 CSS 内容、缩短部分 CSS 属性值（如将颜色值替换为更简短名称）、移除重复 CSS 属性等**；

```css
/* 输入：normalize selectors */
h1::before, h1:before {
    /* reduce shorthand even further */
    margin: 10px 20px 10px 20px;
    /* reduce color values */
    color: #ff0000;
    /* remove duplicated properties */
    font-weight: 400;
    font-weight: 400;
    /* reduce position values */
    background-position: bottom right;
    /* normalize wrapping quotes */
    quotes: '«' "»";
    /* reduce gradient parameters */
    background: linear-gradient(to bottom, #ffe500 0%, #ffe500 50%, #121 50%, #121 100%);
    /* replace initial values */
    min-width: initial;
}
/* correct invalid placement */
@charset "utf-8";

/*输出/优化后的：*/
@charset "utf-8";h1:before{margin:10px 20px;color:red;font-weight:400;background-position:100% 100%;quotes:"«" "»";background:linear-gradient(180deg,#ffe500,#ffe500 50%,#121 0,#121);min-width:0}
```

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/2ddc32e143978f376c56c79459ef1a4a_MD5.jpeg]]

通过在代码库添加重复 CSS 属性并构建，确认 Webpack 默认不移除重复属性。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/b86bd42df91924919cc20c57f5500c36_MD5.jpeg]]

### CssMinimizerWebpackPlugin 插件及使用准备

[02:34]
`CssMinimizerWebpackPlugin` 插件*能处理所有 CSS 文件并应用多项优化，默认内部使用 CSS Nano，也可自定义 CSS 优化器*，本课程选用 CSS Nano；
需先安装该插件，且仅在生产模式运行 CSS 优化，故需转到生产配置。

### 插件配置步骤

[03:02]
在生产配置文件顶部导入插件，创建优化部分，在该部分*指定要压缩生成的文件及使用的压缩器*（压缩器为数组，可添加多个，此处先添加刚安装的插件）；
可传递**自定义选项**，选项会*直接传给 CSS Nano*，此处使用默认预设并设置从 CSS 代码中移除注释，完整选项可查看官方插件页面。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/f403a8ec66b1be894c63c7779d61859e_MD5.jpeg]]

### 验证 CSS 优化效果

[04:53]
运行 Webpack 后，生成的 CSS 已被压缩，且插件去除了重复属性、删除了注释代码。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/f1079a6558745c74086c80c01cdfc0e2_MD5.jpeg]]

## 解决 JS 文件未压缩问题

[05:29]
发现*优化 CSS 后 JS 文件未压缩*，**原因**是 *Webpack 生产模式默认压缩器数组含负责压缩 JS 的 tensor 插件，而本次配置覆盖了压缩器选项，仅保留 CSS Minimizer插件*；
在 Webpack 5 中，使用“...”语法可保留现有压缩器并添加新压缩器，再次运行 Webpack 后，JS 和 CSS 均被压缩。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/03. 7 Ways Of Using CSS With Webpack/media/79ad8a6c228851de8e0c10c78bb180ad_MD5.jpeg]]

## 总结本次学习内容

[07:08]
学习了 Webpack 中的压缩器选项，掌握了在构建过程中优化生成 CSS 的方法。
