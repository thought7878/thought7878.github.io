
视频围绕 Webpack 5 环境下 *JavaScript 模块的动态导入与懒加载*展开，结合待办事项应用案例讲解相关*技术原理、实现步骤及优化效果*，具体如下：

## 为什么需要动态导入与懒加载？

[00:00]
前期视频讨论*静态导入的代码拆分策略*，本视频聚焦**动态导入 JavaScript 模块**；

应用生成的 JS 包中，**jQuery 和 Bootstrap 是较大包，且并非所有包需立即加载**，*如* Bootstrap 仅在用户删除待办事项时才需要，若用户不执行删除操作，无需加载该包，**可减少浏览器下载量、提升网站速度**。

## 验证 Bootstrap 非即时必要性

[02:11]
通过实验，从代码中*移除 Bootstrap 及其相关使用代码后，待办事项应用仍能正常加载列表、添加新项目和标记项目完成，仅删除项目功能失效*。**证明无需在应用初始加载时就加载 Bootstrap，仅在用户需要删除项目时加载即可**。

## Webpack 实现动态导入与懒加载

[03:01]
Webpack 原生支持动态导入，无需在文件顶部导入 Bootstrap，而是*在删除待办事项的事件处理程序内部导入，使该导入在调用事件处理程序时执行*，并将依赖 Bootstrap 的代码放入新代码块；
对另一处使用 Bootstrap 的地方也采用相同处理方式，此技术即为懒加载，*它需先将代码拆分为多个包，再在应用需要时加载部分包，可加快初始加载速度、节省网络流量*。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/08. Applying Code Splitting and Lazy Loading/media/02859d1fe0edaddcfbd6056f92b8fda1_MD5.jpeg]]

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/08. Applying Code Splitting and Lazy Loading/media/8d641a90dca5b479d13aedb24aee109e_MD5.jpeg]]

## Webpack 配置懒加载

[04:52]pei
进入 Webpack 配置调整代码拆分相关设置，
其中`“chunks”属性`**指示待优化的代码块**，值为“all”时*定义的规则适用于所有代码块，对所有类型的 chunk 都进行分割*，还可设为“initial”（*仅应用启动时加载的代码块*）和“async”（*应用加载后异步加载的代码块，如动态导入的代码*）；

*定义适用于异步代码块的新缓存组，提取 node_modules 文件夹中异步加载的模块，处理原有的缓存组重叠问题，移除部分缓存组并为剩余缓存组指定优先级*（默认优先级为 0，需覆盖时设大于 0 的数字），确保 jquery 和 lodash 生成独立包。

参考：[[SplitChunks-DS]]

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/08. Applying Code Splitting and Lazy Loading/media/349231b734540659805ec1ae8268a9b4_MD5.jpeg]]

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/08. Applying Code Splitting and Lazy Loading/media/0745755e9394a8926f38cc32405cc9aa_MD5.jpeg]]


## 优化异步包命名

[08:09]
动态导入生成的*包含 Bootstrap 代码的捆绑包无描述性名称*，可在动态导入位置为 Webpack 提供提示，*指定 Webpack 捆绑块名称（如“bootstrap”）*，并*在 Webpack 配置中定义生成块名称时使用该名称*，**改善异步块命名**。

![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/08. Applying Code Splitting and Lazy Loading/media/d35ecd12bfe19463b557f56e56c74c3d_MD5.jpeg]]

async的name函数
![[_posts/engineering/1.打包工具（Module Bundler）/webpack/教程/Webpack 5 Optimizing For Production/08. Applying Code Splitting and Lazy Loading/media/349231b734540659805ec1ae8268a9b4_MD5.jpeg]]


## 验证懒加载效果

[09:35]
为生产环境构建应用后，打开浏览器并查看网络标签，初始加载时浏览器下载 5 份 JS 文件（共约 380 千字节），无 Bootstrap 相关文件；添加新待办事项时网络标签无变化，点击删除待办事项时，浏览器才发送请求下载包含 Bootstrap 的 JS 文件（约 80 千字节），总下载量变为 460 千字节，证明初始加载减少 80 千字节下载量，实现性能提升。
