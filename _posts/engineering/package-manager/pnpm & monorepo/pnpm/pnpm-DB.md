pnpm 是一个快速、节省磁盘空间的包管理器，以下从其核心特性、工作原理、命令使用、配置管理等方面详细总结知识点：

### 1. 核心特性

- **高效的依赖管理**
  - **硬链接与内容寻址存储**：pnpm 使用硬链接和内容寻址存储（CAS）机制，将所有项目依赖包存储在一个全局仓库中，项目中实际引用的是指向全局仓库的硬链接。这大大减少了磁盘空间的占用，多个项目可以共享相同版本的依赖包，而无需重复下载。
  - **幽灵依赖避免**：在 npm 和 yarn 的早期版本中，项目可能会意外使用到未在`package.json`中声明的依赖（幽灵依赖）。pnpm 通过严格的依赖管理策略，确保项目只能访问在`package.json`中明确声明的依赖，提高了项目的稳定性和可维护性。
- **快速安装速度**
  - **并行安装**：pnpm 在安装依赖时，会并行地下载和链接依赖包，充分利用多核 CPU 的性能，显著加快安装速度。
  - **缓存复用**：pnpm 会缓存下载的包，当再次安装相同版本的依赖时，直接从缓存中获取，无需重新下载。

### 2. 工作原理

- **全局仓库**：pnpm 维护一个全局的存储位置，用于存放所有已安装的包。这个全局仓库采用内容寻址存储，每个包及其版本都有唯一的存储路径，基于其内容的哈希值。例如，当安装`lodash@4.17.21`时，它会被存储在全局仓库中一个基于其内容哈希确定的目录下。
- **项目依赖链接**：在项目中，pnpm 通过硬链接将项目所需的依赖从全局仓库链接到项目的`node_modules`目录。硬链接使得项目可以直接使用全局仓库中的包文件，而无需在项目目录中重复存储，节省空间并加快访问速度。

### 3. 常用命令

- **安装命令**
  - **pnpm install**：安装项目所有依赖，会读取`package.json`文件，根据其中的`dependencies`和`devDependencies`字段安装相应的包。
  - **pnpm add \<package - name\>**：添加指定包到项目依赖中，默认添加到`dependencies`，若要添加到`devDependencies`，可使用`pnpm add -D \<package - name\>`；添加到`peerDependencies`则使用`pnpm add -P \<package - name\>`。
  - **pnpm add \<package - name\>@\<version\>**：安装指定版本的包，如`pnpm add react@18.2.0`。
- **更新命令**
  - **pnpm update**：更新项目所有依赖到最新版本，会根据`package.json`中的版本范围进行更新。
  - **pnpm update \<package - name\>**：更新指定包到最新版本，遵循版本范围规则。
- **移除命令**
  - **pnpm remove \<package - name\>**：从项目依赖中移除指定包，同时会自动清理相关的链接和不再使用的依赖。
- **运行脚本命令**
  - **pnpm run \<script - name\>**：运行`package.json`中`scripts`字段定义的脚本，例如`pnpm run build`会执行`scripts.build`对应的脚本命令。

### 4. 配置管理

- **配置文件**：pnpm 使用`.npmrc`文件进行配置，该文件可以放在项目根目录或用户主目录下。例如，在项目根目录的`.npmrc`文件中，可以配置 registry 地址来指定从特定的镜像源下载包：

```
registry = https://registry.npm.taobao.org
```

- **常用配置项**
  - **store - directory**：指定全局仓库的存储位置，默认是`~/.pnpm - store`。
  - **shamefully - hoist**：默认情况下，pnpm 不会提升依赖到项目根目录的`node_modules`。通过设置`shamefully - hoist = true`，可以开启类似 npm 和 yarn 的依赖提升行为，但这可能会导致幽灵依赖问题，不建议在大多数情况下使用。

### 5. 与其他包管理器的比较

- **与 npm 对比**：npm 在安装依赖时会将每个包完整地复制到项目的`node_modules`目录，导致磁盘空间占用较大，且安装速度较慢。而 pnpm 通过硬链接和全局仓库机制，节省空间且安装速度更快，同时能有效避免幽灵依赖。
- **与 yarn 对比**：yarn 同样提供了快速的安装速度和缓存机制，但在依赖提升策略上，yarn 可能会引入幽灵依赖。pnpm 在依赖管理的严格性上更胜一筹，同时在磁盘空间利用方面表现更优。

### 6. 在项目中的应用

- **项目初始化**：在新项目中，可以使用`pnpm init`来初始化`package.json`文件，按照提示逐步填写项目信息。
- **团队协作**：pnpm 的依赖管理方式确保团队成员在安装依赖时具有一致的环境，减少因依赖版本不一致导致的问题。在团队协作中，建议将`.npmrc`文件提交到版本控制系统，以保证项目配置的一致性。
