## pnpm è¯¦è§£ï¼šå¿«é€Ÿã€é«˜æ•ˆã€èŠ‚çœç£ç›˜ç©ºé—´çš„åŒ…ç®¡ç†å·¥å…·

pnpm (Performant npm) æ˜¯æ–°ä¸€ä»£ Node.js åŒ…ç®¡ç†å™¨ï¼Œä»¥å…¶**èŠ‚çœç£ç›˜ç©ºé—´ã€å®‰è£…é€Ÿåº¦å¿«ã€ä¸¥æ ¼ä¾èµ–ç®¡ç†**ä¸‰å¤§ç‰¹æ€§è‘—ç§°ã€‚

### ğŸ”‘ æ ¸å¿ƒä¼˜åŠ¿

| ç‰¹æ€§                | è¯´æ˜                                                                 | å¯¹æ¯” npm/yarn          |
|---------------------|----------------------------------------------------------------------|------------------------|
| **ç¡¬é“¾æ¥ + ç¬¦å·é“¾æ¥** | æ‰€æœ‰ä¾èµ–ä»…å­˜å‚¨ä¸€ä»½åœ¨å…¨å±€ storeï¼Œé¡¹ç›®é€šè¿‡é“¾æ¥å¼•ç”¨                     | âš¡ï¸ èŠ‚çœ 60-70% ç£ç›˜ç©ºé—´ |
| **ä¸¥æ ¼ node_modules** | ä¾èµ–æ ‘æ‰å¹³åŒ–ä½†ä¿æŒéš”ç¦»æ€§ï¼Œé¿å…å¹½çµä¾èµ–                               | ğŸ›¡ï¸ è§£å†³ä¾èµ–å†²çªé—®é¢˜     |
| **å¹¶è¡Œå®‰è£…**         | ä¾èµ–ä¸‹è½½ä¸è§£å‹å¹¶è¡Œæ‰§è¡Œ                                               | â±ï¸ å®‰è£…é€Ÿåº¦æå‡ 2å€+    |
| **Monorepo æ”¯æŒ**    | å†…ç½®é«˜æ•ˆ workspace ç®¡ç†                                              | ğŸ—ï¸ ç®€åŒ–å¤šåŒ…é¡¹ç›®ç®¡ç†     |

### ğŸš€ åŸºç¡€ä½¿ç”¨

```bash
# å…¨å±€å®‰è£…
npm install -g pnpm

# åˆå§‹åŒ–é¡¹ç›®
pnpm init

# å®‰è£…ä¾èµ–
pnpm add <package>      # ç”Ÿäº§ä¾èµ–
pnpm add -D <package>   # å¼€å‘ä¾èµ–
pnpm add -g <package>   # å…¨å±€å®‰è£…

# è¿è¡Œå‘½ä»¤
pnpm run <script>
pnpm dlx <command>      # ä¸´æ—¶æ‰§è¡ŒåŒ…ï¼ˆæ— éœ€å®‰è£…ï¼‰
```

### ğŸ§  å·¥ä½œåŸç†
```mermaid
graph LR
    A[é¡¹ç›®A] -->|ç¬¦å·é“¾æ¥| C[å…¨å±€ store]
    B[é¡¹ç›®B] -->|ç¬¦å·é“¾æ¥| C
    C[(pnpm store<br>/Users/you/.pnpm-store)]
    D[Node_modules] -->|ç¡¬é“¾æ¥| C
```

1. **å…¨å±€å­˜å‚¨**ï¼šæ‰€æœ‰ä¾èµ–åŒ…å­˜å‚¨åœ¨ `~/.pnpm-store`
2. **ç¡¬é“¾æ¥**ï¼šé¡¹ç›® node_modules ä¸­çš„æ–‡ä»¶é“¾æ¥åˆ°å…¨å±€ store
3. **ç¬¦å·é“¾æ¥**ï¼š
   - ç›´æ¥ä¾èµ–ï¼š`node_modules/{package}` â†’ å…¨å±€ store
   - é—´æ¥ä¾èµ–ï¼šéšè—åœ¨ `.pnpm` ç›®å½•ä¸­ï¼Œé¿å…éæ³•è®¿é—®

### âš™ï¸ å¸¸ç”¨é…ç½®ï¼ˆ.npmrcï¼‰

```ini
# ä¿®æ”¹å…¨å±€å­˜å‚¨ä½ç½®
store-dir=/path/to/store

# è‡ªåŠ¨å®‰è£… peerDependencies
auto-install-peers=true

# æå‡ä¾èµ–åˆ°æ ¹ç›®å½•ï¼ˆå…¼å®¹éƒ¨åˆ†å·¥å…·ï¼‰
public-hoist-pattern[]=*eslint*
public-hoist-pattern[]=*babel*
```

### ğŸ”„ ä¸ npm/yarn å‘½ä»¤å¯¹æ¯”

| åŠŸèƒ½              | pnpm                   | npm/yarn              |
|-------------------|------------------------|-----------------------|
| å®‰è£…ä¾èµ–          | `pnpm install`         | `npm i` / `yarn`      |
| æ·»åŠ ç”Ÿäº§ä¾èµ–      | `pnpm add <pkg>`       | `npm i <pkg>`        |
| æ·»åŠ å¼€å‘ä¾èµ–      | `pnpm add -D <pkg>`    | `npm i -D <pkg>`     |
| è¿è¡Œè„šæœ¬          | `pnpm run <cmd>`       | `npm run <cmd>`      |
| å…¨å±€å®‰è£…          | `pnpm add -g <pkg>`    | `npm i -g <pkg>`     |
| æ›´æ–°ä¾èµ–          | `pnpm update`          | `npm update`         |
| åˆ é™¤ä¾èµ–          | `pnpm remove <pkg>`    | `npm uninstall <pkg>`|

### ğŸ› ï¸ é«˜çº§åŠŸèƒ½

1. **ä¾èµ–æ£€æŸ¥ä¸ä¼˜åŒ–**
   ```bash
   pnpm list             # æŸ¥çœ‹ä¾èµ–æ ‘
   pnpm why <pkg>        # æ£€æŸ¥åŒ…è¢«è°ä¾èµ–
   pnpm outdated         # æ£€æŸ¥è¿‡æ—¶ä¾èµ–
   ```

2. **Patch ä¾èµ–åŒ…**
   ```bash
   pnpm patch <pkg>      # åˆ›å»ºä¸´æ—¶ç¼–è¾‘ç›®å½•
   # ä¿®æ”¹æ–‡ä»¶å...
   pnpm patch-commit <temp_dir>  # ç”Ÿæˆè¡¥ä¸
   ```

3. **ä»…å®‰è£…ç”Ÿäº§ä¾èµ–**
   ```bash
   pnpm install --prod   # å¿½ç•¥ devDependencies
   ```

4. **å®‰å…¨å®¡è®¡**
   ```bash
   pnpm audit           # æ£€æŸ¥å®‰å…¨æ¼æ´
   pnpm audit --fix     # è‡ªåŠ¨ä¿®å¤
   ```

### ğŸ’¾ ç£ç›˜ç©ºé—´å¯¹æ¯”ï¼ˆå®æµ‹æ•°æ®ï¼‰

| é¡¹ç›®         | npm å ç”¨ | pnpm å ç”¨ | èŠ‚çœç©ºé—´ |
|--------------|----------|-----------|----------|
| ä¸­å‹é¡¹ç›®     | 1.2 GB   | 450 MB    | 62.5%    |
| create-react-app | 200 MB   | 80 MB     | 60%      |
| Nuxt.js é¡¹ç›® | 750 MB   | 280 MB    | 63%      |

### âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç¬¦å·é“¾æ¥å…¼å®¹æ€§**ï¼š
   - Windows éœ€è¦[å¼€å‘è€…æ¨¡å¼](https://learn.microsoft.com/en-us/windows/apps/get-started/enable-your-device-for-development)
   - Docker æ„å»ºéœ€æ·»åŠ  `--frozen-lockfile` é¿å…ç¬¦å·é“¾æ¥é—®é¢˜

2. **æ¸…é™¤ç¼“å­˜**ï¼š
   ```bash
   pnpm store prune  # æ¸…ç†æœªä½¿ç”¨çš„åŒ…
   ```

3. **æ··åˆä½¿ç”¨è­¦å‘Š**ï¼š
   - é¿å…åœ¨åŒä¸€ä¸ªé¡¹ç›®ä¸­æ··ç”¨ npm/yarn/pnpm
   - åˆ é™¤ `node_modules` å’Œ `package-lock.json`/`yarn.lock` åå†åˆ‡æ¢

### ğŸ“¦ é€‚ç”¨åœºæ™¯

- **ç£ç›˜ç©ºé—´æœ‰é™**ï¼ˆç¬”è®°æœ¬ç”µè„‘/CI ç¯å¢ƒï¼‰
- **å¤§å‹ Monorepo é¡¹ç›®**
- **éœ€è¦ä¸¥æ ¼ä¾èµ–éš”ç¦»**çš„åº“å¼€å‘
- **é¢‘ç¹åˆ›å»ºæ–°é¡¹ç›®**çš„å¼€å‘ç¯å¢ƒ

> ğŸ’¡ **è¿ç§»å»ºè®®**ï¼š  
> ç°æœ‰é¡¹ç›®è¿ç§»åªéœ€ï¼š  
> 1. åˆ é™¤ `node_modules` å’Œ `lockfile`  
> 2. è¿è¡Œ `pnpm install`  
> 3. æµ‹è¯•é¡¹ç›®è¿è¡Œï¼ˆå°¤å…¶æ³¨æ„ peerDependenciesï¼‰

[å®˜æ–¹æ–‡æ¡£](https://pnpm.io/zh/) | [GitHub ä»“åº“](https://github.com/pnpm/pnpm)