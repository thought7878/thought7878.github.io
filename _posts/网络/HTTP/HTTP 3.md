**HTTP/3** 是 HTTP 协议的最新版本，于 *2022 年*正式发布（RFC 9114）。它基于 **QUIC（Quick UDP Internet Connections）协议**，*旨在解决 HTTP/2 中仍然存在的性能瓶颈问题，特别是在网络不稳定或高延迟环境下的表现*。HTTP/3 的**核心目标**是提高连接建立速度、减少队头阻塞问题，并增强传输的可靠性。

---

## 一、HTTP/3 的特点
1. **基于 QUIC 协议**：
   - 使用 UDP 替代 TCP，减少了连接建立时间和丢包对性能的影响。
2. **0-RTT 握手**：
   - 支持快速握手，减少了首次连接的延迟。
3. **内置丢包恢复机制**：
   - 提供了更高效的丢包恢复能力，提高了传输效率。
4. **无队头阻塞**：
   - 即使某个流的数据包丢失，也不会影响其他流的传输。
5. **更强的安全性**：
   - 默认使用加密传输，基于 TLS 1.3 提供更高的安全性。

---

## 二、HTTP/3 的核心特性

### 1. 基于 QUIC 协议
- **背景**：
  - 在 HTTP/2 中，尽管引入了多路复用，但底层仍然依赖 TCP。*TCP 的队头阻塞问题*在高丢包率的情况下仍然存在。
- **改进**：
  - *专为解决 TCP 的队头阻塞问题设计*。参考：[[TCP的队头阻塞问题]]
  - HTTP/3 使用 `QUIC 协议`，基于 `UDP` 实现多路复用和可靠性，*避免了 TCP 的队头阻塞问题*。
  - QUIC 流是独立交付数据的。在大多数情况下，丢包影响一个流，不影响他人。**这是 QUIC 如何在传输层消除队头阻塞的方法**。
- **优点**：
  - 提高了网络不稳定环境下的性能。
  - *减少了连接建立时间*。

![[_posts/网络/HTTP/media/4d3faa8b1b6e9fe4b28cc2cf774ffc5a_MD5.jpeg]]

![[_posts/网络/media/07fddef406bdf423b62b43f1f8ea0a07_MD5.jpeg]]

---

### 2. 0-RTT 握手
参考：[[0-RTT 握手]]

- **定义**：
  - 在首次连接时，QUIC 支持 0-RTT 握手，客户端可以直接发送数据而无需等待服务器响应。基于UDP，在传输数据之前*不需要建立连接*。参考：[[UDP]]
- **应用场景**：
  - 适用于需要快速加载资源的场景（如网页加载、API 请求）。
- **优点**：
  - *显著减少了首次连接的延迟*。

![[_posts/网络/HTTP/media/473d6f22007a701a33225ad0a551ff72_MD5.jpeg]]

![[_posts/网络/HTTP/media/2dc614cf74111363adc27a3a37b7f51b_MD5.jpeg]]


---

### 3. 内置丢包恢复机制
- **定义**：
  - QUIC 协议*内置了丢包检测和恢复机制*，能够在网络不稳定的情况下快速恢复丢失的数据包。
- **实现方式**：
  - 每个流独立处理丢包，不会影响其他流的传输。
- **优点**：
  - 提高了传输的可靠性和效率。

---

### 4. 无队头阻塞
- **背景**：
  - 在 HTTP/2 中，尽管多路复用解决了请求级别的队头阻塞问题，*但底层 TCP 的队头阻塞问题仍然存在*。
- **改进**：
  - HTTP/3 的 QUIC 协议实现了完全无队头阻塞的传输。
- **优点**：
  - 即使某个流的数据包丢失，也不会影响其他流的传输。

---

### 5. 更强的安全性
- **TLS 1.3 加密**：
  - HTTP/3 默认使用 TLS 1.3 进行加密，提供了更高的安全性。
- **前向安全性**：
  - 即使私钥泄露，也无法解密过去的通信内容。
- **优点**：
  - 提高了数据传输的安全性和隐私保护。

![[_posts/网络/HTTP/media/1b466485522eb89cff3aff779248ae0f_MD5.jpeg]]

---

## 三、HTTP/3 的工作流程
1. **建立连接**：
   - 客户端和服务器通过 QUIC 协议建立连接，支持 0-RTT 握手。
2. **发送请求**：
   - 客户端将请求分割成多个流（Stream），并通过 QUIC 协议传输。
3. **处理响应**：
   - 服务器将响应分割成多个流，并通过 QUIC 协议返回。
4. **关闭连接**：
   - 连接保持打开状态以处理后续请求，或显式关闭。

---

## 四、HTTP/3 的优势
1. **更快的连接建立**：
   - 0-RTT 握手减少了首次连接的延迟。
2. **更高的传输效率**：
   - 内置丢包恢复机制和无队头阻塞设计提高了传输效率。
3. **更强的兼容性**：
   - HTTP/3 与现有的 HTTP/2 和 HTTP/1.1 应用兼容。
4. **更好的用户体验**：
   - 在高延迟或不稳定的网络环境下，HTTP/3 提供了更流畅的体验。

---

## 五、HTTP/3 的局限性

### 1. 部署成本
- **问题**：
  - 部署 HTTP/3 需要升级服务器和客户端支持 QUIC 协议。
- **解决方案**：
  - 逐步迁移，先在关键服务中启用 HTTP/3。

### 2. 中间设备兼容性
- **问题**：
  - 某些老旧的防火墙或代理可能不支持 UDP 或 QUIC 协议。
- **解决方案**：
  - 使用回退机制（Fallback to HTTP/2 或 HTTP/1.1）。

### 3. 生态系统尚未成熟
- **问题**：
  - HTTP/3 的*普及程度较低*，许多工具和库尚未完全支持。
- **解决方案**：
  - 随着技术的发展，HTTP/3 的支持会逐渐完善。

---

## 六、HTTP/3 的改进方向
HTTP/3 已经解决了 HTTP/2 的主要局限性，但仍有一些潜在的改进方向：
1. **进一步优化丢包恢复机制**：
   - 提高在极端网络条件下的性能。
2. **降低部署成本**：
   - 简化 QUIC 协议的实现和配置。
3. **增强生态系统支持**：
   - 推动更多工具和库对 HTTP/3 的支持。

---

## 七、示例：HTTP/3 的请求与响应
由于 HTTP/3 使用 QUIC 协议传输数据，以下是一个简化的逻辑示例：

### 请求：
```http
GET /index.html HTTP/3
Host: www.example.com
User-Agent: Mozilla/5.0
Accept: text/html
```

### 响应：
```http
HTTP/3 200 OK
Content-Type: text/html
Content-Length: 1234

<html>
  <body>
    <h1>Hello, World!</h1>
  </body>
</html>
```

---

## **八、总结**
HTTP/3 是 HTTP 协议发展的最新里程碑，通过基于 QUIC 协议的设计，显著提高了连接建立速度、传输效率和可靠性。尽管其部署和生态系统的成熟度仍需时间，但它代表了未来 Web 性能优化的方向。


## 相关资料
- [HTTP 1 Vs HTTP 2 Vs HTTP 3!](https://youtu.be/UMwQjFzTQXw?si=_nrvPzQ5QPgpQl58)
- [[31.HTTP3：甩掉TCP、TLS 的包袱，构建高效网络]]
- [HTTP/1 to HTTP/2 to HTTP/3](https://youtu.be/a-sBfyiXysI?si=lvH1QCawKRc-c5vo)
- 
- 