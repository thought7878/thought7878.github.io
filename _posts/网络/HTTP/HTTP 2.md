**HTTP/2** 是 HTTP 协议的一个重要升级版本，于 *2015 年*正式发布（RFC 7540）。它是基于 Google 的 SPDY 协议开发的，*旨在解决 HTTP/1.1 的性能瓶颈问题*，同时*保持与现有 Web 应用的兼容性*。HTTP/2 引入了多项创新技术，显著提高了网络性能和用户体验。


---

## 一、HTTP/2 的特点
1. **多路复用（Multiplexing）**：
   - 允许多个请求和响应同时在一个连接上传输，解决了队头阻塞问题。
2. **头部压缩（Header Compression）**：
   - 使用 HPACK 算法压缩头部信息，减少传输开销。
3. **二进制帧（Binary Framing）**：
   - 使用二进制格式传输数据，提高解析效率。
4. **服务器推送（Server Push）**：
   - 服务器可以主动向客户端推送资源，减少请求次数。
5. **优先级（Prioritization）**：
   - 支持为请求设置优先级，优化关键资源的加载顺序。
6. **增强的安全性**：
   - 虽然 HTTP/2 不强制要求加密，但大多数实现都基于 HTTPS。

---

## 二、HTTP/2 的核心特性

### 1. 多路复用（Multiplexing）*
- **定义**：
  - 在 HTTP/1.1 中，多个请求需要排队处理（*队头阻塞问题*）。
  - HTTP/2 允许*多个请求和响应同时在一个连接上传输*，互不干扰。
- **优点**：
  - 提高了并发能力，减少了延迟。
  - *缓解、避免*了队头阻塞问题（*未完全解决，队头阻塞问题是TCP带来的*）。
- **实现方式**：
  - 每个请求和响应被分割成多个小的`二进制帧`，通过`流（Stream）`进行传输。

![[_posts/网络/media/e1e62e492a6a17e5a5bfb0840bf5ec91_MD5.jpeg]]

![[_posts/网络/media/f0b4b89e8cfb77c0bb86580a6b958c35_MD5.jpeg]]

---

### 2. 头部压缩（Header Compression）
- **背景**：
  - HTTP 请求和响应的头部通常包含*大量重复信息*（如 `User-Agent`、`Accept`），增加了传输开销。
- **改进**：
  - *HTTP/2 使用 HPACK 算法对头部进行压缩，减少了传输的数据量*。
- **优点**：
  - 减少了带宽消耗，提高了传输效率。

---

### 3. 二进制帧（Binary Framing）
- **定义**：
  - HTTP/2 使用二进制格式传输数据，而不是 HTTP/1.1 的文本格式。
- **结构**：
  - 数据被分割成多个帧（Frame），每个帧包含一个流标识符（Stream ID）。
- **优点**：
  - *提高了解析效率，减少了错误率*。
  - 支持更复杂的协议功能（如多路复用和优先级）。

---

### 4. 服务器推送（Server Push）*
- **定义**：
  - 服务器可以*主动向客户端推送资源，而无需等待客户端发起请求*。
- **应用场景**：
  - *当客户端请求 HTML 文件时，服务器可以提前推送相关的 CSS 和 JavaScript 文件*。
- **优点**：
  - 减少了请求次数，提高了页面加载速度。
- **注意事项**：
  - 过度使用服务器推送可能会导致资源浪费。

![[_posts/网络/media/19b745bcd8abe728c59ef380321541f9_MD5.jpeg]]

---

### 5. 优先级（Prioritization）
- **定义**：
  - 客户端可以为请求设置优先级，指示服务器优先传输关键资源。
- **实现方式**：
  - 每个流（Stream）都有一个权重值和依赖关系，用于确定优先级。
- **优点**：
  - 优化了关键资源的加载顺序，提升了用户体验。

---

### 6. 增强的安全性
- **HTTPS 的普及**：
  - 尽管 HTTP/2 不强制要求加密，但大多数浏览器仅支持基于 HTTPS 的 HTTP/2。
- **TLS 加密**：
  - 使用 TLS（Transport Layer Security）保护数据传输的安全性。

---

## 三、HTTP/2 的工作流程
1. **建立连接**：
   - 客户端和服务器通过 TLS 握手建立安全连接。
2. **发送请求**：
   - 客户端将请求分割成多个二进制帧，并通过多路复用的方式发送。
3. **处理响应**：
   - 服务器将响应分割成多个二进制帧，并通过多路复用的方式返回。
4. **关闭连接**：
   - 连接保持打开状态以处理后续请求，或显式关闭。

---

## 四、HTTP/2 的优势
1. **更高的性能**：
   - 多路复用和头部压缩显著提高了页面加载速度。
2. **更好的用户体验**：
   - 关键资源的优先级和服务器推送优化了交互体验。
3. **更强的兼容性**：
   - HTTP/2 与现有的 HTTP/1.1 应用完全兼容。

---

## 五、HTTP/2 的局限性

### 1. 复杂性增加
- HTTP/2 的实现比 HTTP/1.1 更复杂，可能增加开发和调试的难度。

### 2. 过度依赖 HTTPS
- 大多数浏览器仅支持基于 HTTPS 的 HTTP/2，这可能增加部署成本。

### 3. 服务器推送的滥用
- 如果服务器推送不当，可能会导致资源浪费和性能下降。

---

## 六、HTTP/2 的改进方向 *
HTTP/3 对 HTTP/2 进行了进一步改进，解决了其主要局限性：
1. **基于 QUIC 协议**：
   - 使用 UDP 替代 TCP，*解决了队头阻塞问题*。
2. **更快的连接建立**：
   - QUIC 协议支持 0-RTT 握手，减少了连接建立时间。
3. **更高的可靠性**：
   - QUIC 提供了内置的丢包恢复机制，提高了传输效率。

---

## 七、示例：HTTP/2 的请求与响应
由于 HTTP/2 使用二进制帧传输数据，以下是一个简化的逻辑示例：

### 请求：
```http
GET /index.html HTTP/2
Host: www.example.com
User-Agent: Mozilla/5.0
Accept: text/html
```

### 响应：
```http
HTTP/2 200 OK
Content-Type: text/html
Content-Length: 1234

<html>
  <body>
    <h1>Hello, World!</h1>
  </body>
</html>
```

---

## **八、总结**
HTTP/2 是 HTTP 协议发展的重要里程碑，通过引入多路复用、头部压缩、二进制帧等技术，显著提高了网络性能和用户体验。尽管它存在一些局限性（如复杂性和对 HTTPS 的依赖），但它已经成为现代 Web 的基础协议之一。

## 相关资料
- [HTTP/1 to HTTP/2 to HTTP/3](https://youtu.be/a-sBfyiXysI?si=lvH1QCawKRc-c5vo)
- [HTTP 1 Vs HTTP 2 Vs HTTP 3!](https://youtu.be/UMwQjFzTQXw?si=_nrvPzQ5QPgpQl58)
- 