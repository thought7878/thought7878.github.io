[【干货】8分钟带你了解V8引擎是如何运行JS！都2020年了还不知道什么是V8？](https://www.bilibili.com/video/BV1zV411z7RX/?share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862)


视频讲述了V8引擎的定义、架构演变、工作流程及优化策略等内容，具体如下：

## V8引擎的定义
[00:46] 
`V8`是用C++编写的谷歌开源高性能JavaScript引擎，能接收、编译和执行JS代码，可在多种操作系统和处理器上运行，Chrome浏览器、Node.js、Electron等都依赖它。

## V8 引擎的主要工作
[01:13] 
包括*编译和执行 JS 代码、处理调用栈、内存分配、垃圾回收*，本次重点讲编译和执行 JS 代码。

## 早期V8引擎架构及问题
[02:05] 
5.9版本前无解释器，有两个编译器。`解析器`将JS源码生成抽象语法树，由FullCodegen`编译器`直接生成未优化的基准机器代码；运行一段时间后，分析线程收集数据，Crankshaft编译器优化生成机器代码。但存在生成的机器码占用大量内存、缺少中间层字节码导致性能优化难、对新JS语法支持和优化差等问题。

## 新V8引擎架构
[04:01] 
解析生成抽象语法树后，`解释器`Ignition将其生成字节码并清除抽象语法树释放内存，字节码大小为等效基准机器代码的25%-50%；运行中解释器收集信息发送给`编译器`TurboFan，由其生成优化的机器代码。

## V8引擎的优化策略
[04:52] 
函数仅声明未调用则不解析生成抽象语法树和字节码；函数只调用一次，Ignition生成字节码后直接解释执行，TurboFan不优化编译；函数被多次调用可能成为热点函数，Ignition收集确定类型信息后，TurboFan将字节码编译为优化机器代码。

## 去优化（Deoptimization）现象
[05:48] 
由于JS是动态语言，若优化后的机器代码基于错误类型信息生成（如函数参数类型后续改变），会回退到字节码由解释器执行，因此应尽量保持变量和函数参数类型固定以避免性能损失。

## 新架构的好处
[07:07] 
生成字节码速度远快于机器码，缩短网页初始化解析执行JS的时间，使网页加载更快；生成优化机器代码无需从源码重新编译，去优化时只需回退到字节码解释执行，提升了性能，模块功能更清晰，为JS新功能和优化铺路。