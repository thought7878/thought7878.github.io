【【现代前端开发必知13】持续集成和部署】 https://www.bilibili.com/video/BV1bUzPYPEnk/?share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862


前端代码完成之后，如何部署到服务器上供用户访问？  
发言人：简单做法是将源代码本地打包后手动上传到服务器上，但这种方式在多人协作场景下存在标准化约束不足、效率低下和安全风险等问题。持续集成和部署（CI/CD）技术解决了这些问题，通过自动化流水线对源代码进行处理、构建和测试，并生成集成产物。  
  
持续集成（CI）是如何运作的？  
发言人：持续集成系统会在版本控制系统中接收开发者提交的源代码，然后创建虚拟容器，拉取最新代码并执行自定义脚本进行安装依赖包、链接检查和单元测试等操作，最后生成测试报告和构建产物。  
  
DGS中如何配置自动化流水线以确保前端代码的兼容性和安全性？  
发言人：在DGS中，使用GitHub Actions设置流水线，在代码变更时自动执行测试流程。流水线会创建不同版本的Node.js虚拟环境来测试代码兼容性，并执行一系列安全检查，如依赖包安装、link检查、单元测试和覆盖率测试，并将报告上传，形成覆盖率报告。  
  
持续部署（CD）的主要功能和应用场景是什么？  
发言人：持续部署紧随持续集成之后，将集成产物部署到目标环境。其关键功能包括控制发布流程，支持向多个目标环境（如应用服务器、CDN等）发布构建产物，并进行灰度发布以减少故障影响面，同时允许在任意时间回滚变更至上一版本，确保应急情况下的快速恢复。  
  
持续部署系统如何实现环境隔离？对于个人开发者来说，如何低成本接入持续集成和部署系统？  
发言人：持续部署系统支持分支代码研发场景中，开发分支上的代码会部署到开发环境或线下环境进行测试，通过流水线确保代码经过充分测试后再合并至主干分支，随后部署到生产环境或线上环境，从而兼顾研发效率和生产环境稳定性。个人开发者可以低成本地接入持续集成和部署系统，如使用Drinks、Travis CI和GitHub Actions等工具，它们提供了便捷的CI/CD解决方案，即使对于个人项目来说也是不可或缺的一部分。

---

# 为什么使用CI/CD？

前端代码写完后，如何部署到服务器上供用户访问？
![[_posts/base/知识目录、路线图/现代前端开发必知/media/c0e9592f53f9d2ae05a53fe346369b23_MD5.jpeg]]
**简单粗暴的做法**是将源代码本地打包后，再*手动上传到服务器上*。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/dec3d4c1c3b3c97c91da19a2038f19da_MD5.jpeg]]
对于*简单的业余项目*来说，这没太大问题，但在现代化的多人协作场景下，**这种方式缺少标准化约束会导致许多问题：**
- 比如，本地打包*如何保证依赖包的健康和一致性*
- 手动上传构建产物*效率低下、存在安全风险*
![[_posts/base/知识目录、路线图/现代前端开发必知/media/f69b0e20f32e93a75a05058a7f7101c9_MD5.jpeg]]

**持续集成和部署系统的出现，就是为了将这个过程标准化和自动化**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/13d03c95980bdca1d6f53e462724f39f_MD5.jpeg]]


# 持续集成（CI）
持续集成（CI、Continuous Integration）

**持续集成系统，会按照预先编排好的自动化流水线（pipeline），对源代码进行处理，得到集成产物**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/9a3fc2b90fde8d193070e19a90c26dd0_MD5.jpeg]]
- 首先开发者*将源代码提交到版本控制系统*。
- 随后持续集成系统会*创建一个虚拟容器，拉取最新代码*。
- 然后*执行项目的自定义脚本*，通常是*安装、构建、测试*脚本等等。
- 最后*生成集成产物*（可以是测试报告、构建产物等）。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/c26fe20c6869f8313f745936c027cd56_MD5.jpeg]]

这是一个前端开源库dayjs，使用github actions持续集成服务，自动运行单元测试的流水线配置。我们可以看到流水线会在master或dev分支代码变更后自动执行。流水线会创建带有四个不同版本的node JS的虚拟环境来测试代码。对他们的兼容情况随然后执行依赖包安装link检查、单元测试和覆盖率脚本，然后将报告通过cot组件上传，最终形成这样一份覆盖率报告。

在这样一个简单的流水线中，我们还可以做更多有价值的事情。上期视频中我们提到持续集成过程中容易产生供应链安全的问题，可以通过依赖锁文件或接入安全组件来屏蔽恶意软件。除此之外，根据业务研发流程需要，还可以对流水线中的每个阶段设置门禁检查规则。比如拉取代码后检查基线是否最新，构建前对代码执行静态检查，构建后检查产物大小等等。

# 持续部署（CD）
和持续部署（CD、Continuous Deployment）

接下来我们说持续部署CD持续部署通常紧接着持续集成进行，即我们将持续集成阶段输出的构建产物作为持续部署的输入，通过自动化流水线部署到目标环境中。

持续部署系统的重要功能之一是对发布流程的控制。首先它可以控制将构建产物发布到应用服务器NPM和CDN等多个目标。其次它可以进行灰度发布，即按照白名单或百分比分批发布，而不是一次性全部发布，来减少故障影响面。最后，持续部署系统可以在任意时间回滚变更到上一个版本。假设灰度发布期间观测到预期外的异常，可以快速回滚到上一个版本，实现应急止血。

持续部署系统的另一个重要特性是环境隔离，在分支代码研发的场景中，开发者在开发分支上推送的代码会部署到开发环境或线下环境，代码经过测试后再合并到主干分支，随后部署到生产环境或线上环境，这样在保证研发效率的同时，又可以提升生产环境的稳定性。要自己从零建设一套持续集成和部署系统是非常复杂的，而drinkings travis CI和getting help actions都是不错的选择。你可能觉得持续集成和部署都是高阶玩法，我用不上，但实际上它是现代研发流程中不可缺少的一部分，即便是个人向，你也可以用非常低的成本接入它。本期我们介绍了持续集成和部署系统的相关概念、功能和应用，下一期我们聊聊应用发布上线后应该关注哪些问题。我是小麦，我们下期再见。