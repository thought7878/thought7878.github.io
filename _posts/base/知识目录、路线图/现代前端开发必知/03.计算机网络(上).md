【【现代前端开发必知03】计算机网络(上)】 https://www.bilibili.com/video/BV1dmvSe2EMo/?share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862

你是否思考过这些问题：
- DNS只是用于域名查询吗？
- 如何为网站绑定一个域名？
- 为什么首次打开网站比较慢？
- CDN是如何利用DNS加速静态资源的？
- DNS在现代前端开发中扮演着怎样的作用？

今天我们就来聊聊DNS。

## DNS是什么？
[00:15]

`DNS（Domain Name System）` `域名系统`，它的**主要功能**就是***将人们容易记住的域名转换成计算机能理解的IP地址***，从而***实现正确的网络连接***。

而*执行这项转换任务的*便是`DNS服务器`。DNS服务器除了*部署在互联网的各个角落*，其实*每一台终端设备都会内置`本地DNS服务器`*。

DNS查询时，会依次经过，*应用程序缓存（比如浏览器的缓存）、本地host、本地DNS服务器（家中路由器）、根服务器、顶级域名服务器、权威服务器*，**最后得到真正的IP地址**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/383e410100d3f61f4e67e09b2af6f16b_MD5.jpeg]]

作为开发者，我们*通常会从域名服务商购买顶级域名*。同时*服务商也会提供域名解析服务*，也会在类似这样一个页面中配置多种类型的DNS记录。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/4b82c723f5f79d3bef8111c00745802e_MD5.jpeg]]

## 域名管理

### A记录
`A记录`保存最终要返回的IP地址。在A记录上直接填写*固定IP地址*的方式，**只适用于简单的单机部署网站**。
### CNAME记录
`CNAME记录`*将子域名映射到另一个域名*，可以指向相同主域名，也可以是其他主域名

![[_posts/base/知识目录、路线图/现代前端开发必知/media/ad53fa0d276a3dd27238eaa4a510db3c_MD5.jpeg]]

## 大型应用的域名管理
[01:40]

**在大型应用中，应用服务器分布式部署，IP地址是动态变化的。**
**因此，大型应用会采用`动态解析`IP地址的方式：** 将同一域名，根据不同网络运营商、不同地区，解析到不同IP地址的服务器上。

![[_posts/base/知识目录、路线图/现代前端开发必知/media/0109db4c62725067863102c737483b19_MD5.jpeg]]

在这真实世界中，这些服务器大概率*并非最终的应用服务器*，而是*具备反向代理能力的`负载均衡服务器`、`web应用防火墙`* 等等。而*真正的应用服务器IP地址是不会暴露于公网环境的*。

![[_posts/base/知识目录、路线图/现代前端开发必知/media/ced8d76c98190e3511d6886e70f8eeeb_MD5.jpeg]]

## 现代DNS的额外功能
现代DNS服务器除了具备基本的*域名解析*功能外，还会提供*安全插件DNS分析、利用边缘网络加速解析、ddos防护*这些功能。他们都是*为了更快更安全地为用户提供服务*。

![[_posts/base/知识目录、路线图/现代前端开发必知/media/1f3885ddc71622c0e4b6f1333fd86036_MD5.jpeg]]

## CDN与DNS
内容分发网络CDN与DNS有着密切关系。**当不同地区的用户访问前端静态资源时，会从不同的CDN节点下载数据**。
**这归功于DNS系统的CNAME记录**，DNS服务器会**根据用户所在地区返回不同的CNAME域名**，我们通常称之为`CDN加速域名`。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/48b3ed47c69a4e13823b4223161ca643_MD5.jpeg]]

举一个*例子*，假设我们的图片资源托管在img.alicdn.com上，*如何知道用户实际上会访问到哪台CDN服务器呢？*
使用`nslookup`工具依次查询该域名的CNAME和A记录，最终我们会得到CDN服务器的IP地址，它的实际地理位置刚好就是用户所在地附近。

![[_posts/base/知识目录、路线图/现代前端开发必知/media/6f6d779a1b522310c7e4757d6e608f4a_MD5.jpeg]]
![[_posts/base/知识目录、路线图/现代前端开发必知/media/3493ad0be91ab7cca780d7305917828a_MD5.jpeg]]

## DNS的性能优化
通过前面的例子可以看到，在真实世界中，**DNS解析并非一轮完成，它背后会经历多次反复查询**。
**在没有任何缓存的情况下，它会非常慢**，以至于*显著影响到你的网站打开速度*。

因此无论是DNS云服务商还是互联网上的基础设施，都会**想尽办法加速DNS解析**。诸如**使用高性能的DNS服务器、配置DNS缓存、增加DNS记录的缓存时间（TTL）** 等等。

![[_posts/base/知识目录、路线图/现代前端开发必知/media/4a4cfe09f1cfba5c4d9a24f3d6d6d6f2_MD5.jpeg]]

![[_posts/base/知识目录、路线图/现代前端开发必知/media/acd04751628c63f281a0195f0c8fe419_MD5.jpeg]]

### 前端优化

作为前端，我们也可以**通过浏览器提供的DNS预取功能**来**指定需要提前解析的域名**。比如，通过*在HTML中添加DNS Prefetch link标签*，可以**让浏览器在解析完该标签后立即进行DNS查询**，来**提升用户后续访问该域名的速度**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/2ad7321330e80de376579c8e61d8fc79_MD5.jpeg]]

利用DNS的查询原理，我们可以通过*修改本地hosts的方式来给项目配置一个域名，而不是直接使用localhost*，**这能有效解决与服务端联调时cookie无法跨域传输的问题**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/bbb13b8e525837a0e437e359f6b708f3_MD5.jpeg]]
![[_posts/base/知识目录、路线图/现代前端开发必知/media/eac1390c9ec6f3fc188657bec16d33c0_MD5.jpeg]]

另外，*如果项目依赖中硬编码了线上域名*，通过修改本地DNS记录，可以**在不改变代码的情况下，将线上域名映射到本地或者联调环境，方便问题验证和多环境联调**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/b9ca6f4ba53e6ee0715256da1aa5fa97_MD5.jpeg]]