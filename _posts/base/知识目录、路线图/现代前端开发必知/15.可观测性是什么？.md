【【现代前端开发必知15】可观测性是什么？】 https://www.bilibili.com/video/BV1CkqPYnECo/?share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862

本期我们介绍**前端如何实践`可观测性（Observability）` ，它对于前端的价值是什么，为什么它如此重要**。聊聊***应用发布上线后应该关注哪些问题***。


**当我们顺利将一个前端应用发布上线后，它的生命历程才刚刚开始：**
- 如何监测异常事件？
- 如何跟踪接口请求？
- 如何分析用户转化？

而`可观测性`就是**通过日志、追踪、度量三个不同的视角来综合评估一个应用上线后的整体状态**。

# 日志
首先是日志，我们很容易想到console.log，它的主要作用就是在本地打印一条信息，辅助开发者调试代码。**在可观测性系统中，本地日志通常需要上传到服务端**，同时*包含更多上下文，帮助开发者定位错误和分析特定事件的细节*。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/029b66bf8b8366edf33db1f3ef60260d_MD5.jpeg]]


## 监控
前端常说的`监控`和`埋点`**就是通过日志手段来实现的**。

`监控`是**针对异常、错误信息的收集**，而`埋点`**则侧重用户行为的记录**。

**前端常见的异常**包括*代码运行异常、网络请求异常、用户输入异常、页面渲染异常*等等。

而**收集这些异常的方式主要是：**
- 通过try catch
  ![[_posts/base/知识目录、路线图/现代前端开发必知/media/59fcedb43986e9961cb9d43176884919_MD5.jpeg]]
- window.onerror事件
  ![[_posts/base/知识目录、路线图/现代前端开发必知/media/1260f14d8d80d83068ede89d8f9e0df7_MD5.jpeg]]
- 框架提供的异常捕获方法，如error boundary组件来完成。
  ![[_posts/base/知识目录、路线图/现代前端开发必知/media/f860e71be7fc5209cff93925b6f6a282_MD5.jpeg]]

## 埋点
`埋点`则是**在代码特定位置插入上报代码**。比如：

- **在页面加载完成后，上报一次，用户访问PV；**
  ![[_posts/base/知识目录、路线图/现代前端开发必知/media/abef6fd499fd22c28ee18d7316df2be6_MD5.jpeg]]
- **在某个组件出现在可见范围内，上报一次曝光；**
  ![[_posts/base/知识目录、路线图/现代前端开发必知/media/a29d8803a64d4e0c0a51d7a5db270ad4_MD5.jpeg]]
- **在用户点击某个按钮后，上报一次点击click**，后续便可**根据这些数据分析用户行为**，发现产品链路中的优化点。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/d52e6a9de8ac70048d1691418513f696_MD5.jpeg]]

### 接入SDK
前端可以**接入日志系统提供的SDK，收集日志并上报到服务端**。`Sentry`是一个*强大的可观测性工具*，它为许多语言和框架提供了SDK，*既可以监控应用异常，又可以记录用户行为*。

我们**以它为例，来看看典型的前端日志系统实际是如何工作的**。这是一个*在Vue 3项目中接入Sentry SDK的配置方法：*
- Sentry.init背后会自动为我们监听window.onerror等事件。
- 当代码中产生异常后，自动完成上报或手动上报特定异常。
  ![[_posts/base/知识目录、路线图/现代前端开发必知/media/f53659eb326be186ef642544733ab7bf_MD5.jpeg]]
- 随后我们可以*在日志后台看到关于异常的丰富信息*。比如，触发该异常的用户设备信息，该异常在每个时间段的产生数量，异常的堆栈、异常的设备分布比例等等。
- *通过这些信息，我们可以很快定位到错误的原因，并且制定修复方案*。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/a99a917e7e222e037255add24ec9d51d_MD5.jpeg]]

# 追踪（Tracking）
如果说*日志记录的是单一事件*，那么**追踪则更关注端到端**。比如，*一个请求从哪里发起，经过哪些系统，到哪里结束，用户完成 “保险投保” 动作，经历了哪些操作*。
而**追踪系统的主要任务**就是**记录一个完整的过程**。

**在典型的追踪系统中，生成和传递`Trace ID`是普遍的做法**。这是Sentry提供的追踪页面，可以通过这样一个Trace ID分析出用户在chrome浏览器中发起了一个接口请求，经过了从前端到服务端的不同节点，同时提供了节点的调用耗时、上下文、参数信息等等。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/062f3fe844f65e2127afcc6253410db7_MD5.jpeg]]
另外**Sentry提供的replace功能也是追踪的一部分**，它*可以将用户的所有操作录制下来*，而不必担心隐私泄露问题。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/c7848d0af038a156ef3d90c3b4f7b865_MD5.jpeg]]

追踪对前端来说并非一无是处，`追踪`除了**能帮助开发者分析上下游系统间的问题**外，也可以**为业务合规提供数据依据**，比如*之前提到的投保流程录制*就是为了满足业务合规要求，而这必须依赖前端才能做到。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/7df77b54a373704d434789fb4819157f_MD5.jpeg]]

# 度量（Metrics）
如果说 **`日志`和`追踪`是记录**，那么`度量`就是**给出定量指标，关注系统的整体状态**。

同样，*以Centry为例，它提供的performance面板其实就是一种性能度量*。在这里我们可以看到*每个页面的LCP、FCP等多个性能指标*，包括他们的数据分布情况。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/37a3ae81f2a508cbaefa078e24ccc509_MD5.jpeg]]

另外**页面访问量、曝光点击率、留存转换率**，这些指标也是非常值得我们前端关注的。这是微信小程序`We分析平台`的数据大盘。可以看到平台展示了小程序的*访问量、留存、交易、行为*等数据，而**这些数据就是利用埋点日志完成度量的结果**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/74e6e30d4c984d1598b9fe328579a617_MD5.jpeg]]

***通过度量，我们可以从更高的维度观察应用的整体状态，为产品迭代提供数据依据。***
  
# 总结
最后，为了方便记忆，我们可以做个**总结：**
- `日志`是点，
- `追踪`是线，
- `度量`是面，
**它们共同构成了一个完整的可观测性系统**。本期我们讨论了可观测性。它对于前端的价值，并非遥不可及，而是必不可少的。相信你一定有不少收获。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/12be21f82da420d902d19438679cdcaf_MD5.jpeg]]
![[_posts/base/知识目录、路线图/现代前端开发必知/media/0c690f0b5dbaaab72956e22366d73aeb_MD5.jpeg]]
![[_posts/base/知识目录、路线图/现代前端开发必知/media/39468fda6de7a153f1c4ad116418e89f_MD5.jpeg]]


---

到这里，我们的现代前端开发必知系列的正片就告一段落了。由于这个系列视频涉及到的知识点非常多，因此我打算再出一个总结篇，带大家快速回顾一下我们介绍过的内容，并预告接下来打算做什么
