【【现代前端开发必知04】你需要知道的 HTTP 协议】 https://www.bilibili.com/video/BV1MJYveXEEM/?share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862


## HTTP协议：连接世界的桥梁与前端基石  
[00:00]
视频介绍了HTTP协议作为互联网基石的重要性，涵盖**超文本传输特性、工作于应用层、主要版本（HTTP1.1、HTTP2、HTTP3）、其性能提升与安全性增强**，特别指出*HTTPS的加密安全特性*，强调**每代协议升级均围绕性能与安全展开**。  

---

原文

---

`HTTP协议`是*连接世界的桥梁*，也是人们*打开互联网大门的钥匙*，它对于前端的重要性是毫无疑问的。由于HTTP协议的内容众多，几分钟视频无法尽善尽美，*因此本期视频只介绍HTTP协议中最为重要的部分，以及它在大型客户端应用中的变体*。

`HTTP`的全称是**超文本传输协议（HyperText Transfer Protocol）**。`超文本`意味着它*不仅仅可以传递文本内容，还可以传递图片、视频等其他形式的数据*。虽然它叫传输协议，但它实际上*工作在TCP、IP协议上的应用层，底层的数据传输由TCP或udp负责*。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/b817ae425ac7ca0d210c7447454259f5_MD5.jpeg]]

![[_posts/base/知识目录、路线图/现代前端开发必知/media/becd9501556301615748e60340a62204_MD5.jpeg]]

*HTTP协议发展至今已有多个版本*，其中最常用的是*HTTP1.1、HTTP2和HTTP3*。
`HTTP1.1`目前依然被广泛使用。
`HTTP2`引入了*多路复用、二进制帧层、头部压缩*等特性，**提升了不少传输性能**。
`HTTP3`*基于QUIC协议，使用udp作为传输层*，**进一步降低了连接延迟和提升了传输性能**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/407e691e2e04261be16e1119bbc67ce3_MD5.jpeg]]

值得注意的是，`HTTPS`是**HTTP的加密安全版本**，它*在原始HTTP协议的基础上加盖了一层SSL/TLS*来**实现加密传输**。除了HTTP3，TLS在其他版本中并不是强制要求的。

可以看到**每一代协议升级都是围绕性能和安全性**展开的。

## HTTP协议与异步请求详解  
[01:37]
对话深入探讨了HTTP协议的工作原理，包括请求与响应机制、响应状态码分类、请求与响应头部字段的作用，以及如何通过fetch API和Node.js的原生HTTP模块管理异步请求，强调了content type在实际应用中的重要性。  

### 原文
HTTP协议大体上是一种问答形式，客户端发出请求，服务器处理请求，然后再给出响应。无论是HTML文档还是图片、视频等资源，都是通过这种问答来传输的。服务器会根据不同场景返回不同的响应码。具体可以参照这张表格，只需要记住，二开头表示成功处理，三开头表示重定向，四开头表示客户端错误，五开头表示服务端错误。
在请求和响应报文中，除了请求方法和响应码外，最值得关注的就是请求头和响应头。比如，用于请求上下文的host referral user agent，用于响应上下文的allow server。用于缓存的cash control last modified，last modified since和e tag if long match。用于cookie的cookie和seat cookie，用于安全的x frame options，strict transport security和content security policy等。用于跨域控制的origin和access control。
一套用于描述消息主体的content，一套浏览器加载资源会使用HTTP协议，前端与服务端的异步请求通常也通过HTTP协议完成。最早我们通过XML HTTP request在浏览器中发起一个异步请求，后来许多三方库基于它做了功能扩展，比如jaque、ajax、super agent和X等，直到出现了新的face标准。虽然API都长得一样，但face标准在不同环境下有不同的实现。比如node JS环境下的fetch是基于od t实现的，而在边缘运行时中fetch API也会依据平台有所不同。因此在现代前端应尽可能使用face API或其封装库来管理异步请求。下面使用face API和note GS原生HTTP模块举例说明content type是如何工作的。请求代码和报文是这样的，对应的服务端处理代码和响应报文是这样的。

## Content-Type理解与HTTP调试技巧  
[03:54]
对话深入探讨了Content-Type在HTTP请求与响应中的关键作用，指出客户端与服务端处理数据类型不匹配时的常见问题，强调理解Content-Type的重要性。此外，介绍了多种调试HTTP请求的方法，包括使用浏览器开发者工具、CURL命令行工具、Postman自动化工具，以及针对移动设备HTTPS和远程环境的调试策略，如安装信任证书、网络代理工具和抓包分析服务端日志。  

### 原文
需要注意的是，请求头和响应头中的content type表示消息主体的数据类型。它可以是Jason form，也可以是其他任何MIME类型。不同的类型就要有不同的处理程序。在这个例子中，客户端发送了一段Jason类型的数据，服务端应通过Jason pass处理。然后响应了一段纯文本类型，客户端应通过text的方法处理它。这是一个在实际工作中相当容易犯错的问题。前端使用三方库时默认为Jason请求，而服务端默认以form处理时会百思不得其解，为什么我处理不了你的请求？原因就是没有理解content type的含义。

在不同的场景和环境下调试HTTP有不同的方法。最常见的当然是使用浏览器开发者工具。比如在chrome dev tools的network选项卡下，可以看到非常详细的HTTP请求和响应信息。有时候只想快速看看服务端的响应情况，则可以通过CURL的命令行工具完成。在针对API测试的场景下，可以通过postman等自动化工具来批量测试。而要调试移动设备类的HTTPS，则需要安装信任证书以及通过网络代理工具来实现。对于远程或是生产环境，则更多是通过抓包和分析服务端日志来完成。

## 定制化HTTP协议提升大型客户端应用效率与安全性  
[05:23]
讨论了在大型客户端应用中，为提高数据传输效率和安全性，通常会设计无线网关并定制HTTP协议，增加如登录验证、请求跟踪、监控限流等功能。以哔哩哔哩客户端为例，通过gRPC请求至网关，发送自定义请求头，实现更复杂的功能。相比原始HTTP，定制化协议能带来更强大的功能，适应高并发场景。

### 原文
HTTTP的功能很强大，它足够满足大多数应用场景。但在大型客户端应用中，为了更高效和安全的传输数据，同时兼容HTTP协议会有一些变化。我们应该知道，不是所有的客户端环境都支持先进的HTTP2或HTTP3原始HTTP协议，在更复杂的高并发场景下会不够高效和稳定。因此大型技术基建通常会设计一层无线网关gateway，并对HTTP协议进行定制，增加登录验证、请求跟踪、监控限流等功能。而前端代码通过远程过程调用RPC的方式，而非直接使用原始HTTP。

以哔哩哔哩客户端为例，前端发起一个gRPC请求至网关，同时发送了多个自定义请求头。比如XBDMID表示当前用户，x bd trace, ID用于链路日志跟踪，x bd device bin表示设备信息等等。在服务端的响应头中，content type表示，这是一个gRPC响应x bd trace ID用于日志跟踪等。可以看到相比浏览器中的HTTP，在客户端中的HTTP会更复杂，定制化的HTTP协议能带来更强大的功能。

本期内容只是简要介绍了HTTP协议本身，更多内容我们会在之后的视频中一一展开。如果这期视频对你有帮助，记得点个赞。我是小麦，我们下期不见不散。
