【【现代前端开发必知12】前端的质量和安全怎么建设】 https://www.bilibili.com/video/BV1GCUrYvEYi/?share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862



**质量和安全是软件工程时常提及的问题**，前端自然也不例外。代码写得好不好，有没有安全漏洞只是其中一个维度，**它更是一个系统性工程**。对于前端开发来说，可以从这四个方面讨论：`编码质量`、`测试`、`攻击防御`、`稳定性`。

# 编码质量
[00:21]
我们会经常讨论编码质量的问题。每个人的编程经验和习惯不同，写出来的代码自然就不会一样。
采用`防御性编程`、`质量管理工具`、实施`代码评审`是**常用的提升编码质量的手段**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/7bff63502c1a6716dbf0c05d2a52db1d_MD5.jpeg]]

## 防御性编程
`防御性编程`要求程序员在编写代码时**预见可能出现的问题，并提前采取措施来规避这些问题**，*特别是对于弱类型的前端编程语言*，做到这一点非常重要。比如：
- **判空处理**，*对不确定的输入参数*，采用短路写法，提前判空返回。
- **异常处理**，使用try catch，*对可能抛出异常的调用进行错误处理*。
- **降级处理**，*对允许出错的弱依赖场景，可以返回默认值*，增加系统的容错性。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/d910b18581edba9dee3f531e76ed2401_MD5.jpeg]]

## 质量管理工具
**防御性编程无法规避一些难以察觉的问题，需要借助质量管理工具来自动分析代码问题**。

常用的代码质量管理工具，包括：`静态检查工具`和`风格控制工具`两类。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/1b4012f92a5d166806ce69f7db1b5183_MD5.jpeg]]

我们常用的`ESLink`就属于静态检查工具，它**内置了许多判断规则**，这些规则内部**对抽象语法树（AST）进行分析判断，来确定是否存在已知问题**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/1f1ea36685e130acbdcf74a8ec68ffb2_MD5.jpeg]]

其次是风格控制，`Prettier`是一种**代码格式化工具**，可以**根据需要，自定义风格偏好，来统一团队的代码风格**。

## 代码评审
最后是代码评审，`代码评审`是指**不同的人交叉验证代码设计是否合理**。

我们之前提到的**质量管理工具并不能理解代码设计，只能发现和解决特定的问题，而多数更复杂的问题出现在架构设计阶段**。

*因此，多人开发时很有必要进行代码评审*。许多版本控制系统会*集成pull request的功能*，其实就是发起代码评审，*评审时可以根据代码diff，提出问题或者修改意见，当所有问题解决后再合并代码*。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/199a8269060180c965c4a371771e60ed_MD5.jpeg]]

# 测试
[02:18]
接下来是测试，`测试`是一种**通过编写测试用例来检查程序执行结果是否符合预期**的一种方式。

前端开发**常采用的测试手段**包括`单元测试`、`集成测试`、`兼容性测试`、`性能测试`、`UI测试`。

## 单元测试
单元测试的**范围最小**，通常是**对实现某一特定功能的函数进行测试**。*常用的单元测试框架*包括`Jest`和`Mocha`等。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/6b5f37e7202709ce2ae604aeb2428779_MD5.jpeg]]

## 集成测试
相比单元测试，**集成测试的重点**是*验证各模块之间的正确性*，**它的测试范围更大**。*常用的集成测试框架*包括`Cypress`和`Playwright`。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/0f9f2d992e5edff30f84559691104782_MD5.jpeg]]

## 兼容性测试
前端代码的运行环境通常是不稳定的，**兼容性问题**是*前端需要解决的难题之一*。尽管许多工具和框架都保证了在绝大多数环境中的兼容性，但*在实际生产过程中总有漏网之鱼*，**因此兼容性测试是非常有必要的**。

我们可以**利用`特性探针`验证生产环境中某个API是否可用**。如果**再配合`埋点日志`收集检测数据**，就可以提前准备兼容方案。常用的检测工具`Modernizr`可以做到这一点。此外我们还经常使用`CanIUse`、`BrowserStack`、`Puppeteer`等工具*在应用上线前进行兼容性测试*。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/13128e7b5ca43bd5e0ca0b1722a40654_MD5.jpeg]]

![[_posts/base/知识目录、路线图/现代前端开发必知/media/4c470ee83cf5c4f256a52aa2627c1423_MD5.jpeg]]

## 性能测试
接下来是性能测试，我们在用户体验章节介绍过性能测试的常用方法，可以翻看之前的视频进一步了解。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/5d57c12564866bd4e68716384ee3d946_MD5.jpeg]]

## UI测试
`UI测试`，**关注用户界面的展示和交互前后是否符合预期**，可以*使用UI框架推荐的测试工具来完成*。比如，React的`React Testing Library`、Vue的`Vue Test Utils`。**他们为框架做了深度优化，相比自己封装更容易使用**。
`UI测试`**既可以进行单元测试，也可以进行端到端测试，甚至是实际录制测试用例，减少测试用例的编写成本**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/dae21c3393bd4f2ff740b36fb80b8697_MD5.jpeg]]

# 攻击防御
前端攻防也是老生常谈的问题了。`跨站脚本攻击（XSS）`和`跨站请求伪造（CSRF）`是*最典型的两类针对前端应用的攻击方式*。

## 跨站脚本攻击
`跨站脚本攻击`是攻击者通过某些手段**将恶意代码注入到用户的网页中**来**窃取敏感信息**或是**执行恶意操作**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/b58d2fa3c419094b97ac18e9946f0125_MD5.jpeg]]
**常用的防御措施**就是**在代码注入环节进行校验、过滤**，比如，*采用sanitize-html对用户输入进行过滤*，**特别是需要展示用户输入的业务场景**，比如*文章发布、评论留言*等等。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/9312dd5837c92359701c3946d2f15b94_MD5.jpeg]]

## 跨站请求伪造
`跨站请求伪造`是**攻击者诱导用户访问包含恶意代码的网页，在用户不知情的情况下，向没有做好防护的服务器发送恶意请求**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/d28690ac5125856f95296f66385ae9f7_MD5.jpeg]]
它的**防御方法**主要有两种，`同源检查`和`token检查`，不过*这些都需要依赖服务端的检验保护*。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/2b4f50d00d1ac805bc2beb5fb3f61186_MD5.jpeg]]

# 稳定性
## 供应链安全
最后是稳定性，*稳定性时常被我们忽视，但它却影响着前端开发的方方面面*。在一个标准研发流程中，我们采用持续集成的方式迭代应用，*构建系统会从公网或者内网NPM仓库中下载和安装依赖*。同时也伴随着不稳定因素，比如*第三方依赖的错误更新导致构建失败、恶意脚本植入导致敏感信息泄露*等，这就是`供应链安全`。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/9f2c190f8b99de088666b917e76526f7_MD5.jpeg]]
我们**有许多手段提升供应链的稳定性和安全性**，比如，*使用`依赖锁文件（package-lock.json）`并定期更新；在构建系统中，接入安全组件，屏蔽恶意版本*。

## 应急预案
`应急预案`**也是能够有效提升系统稳定性的途径**，它是指**在系统出现故障或紧急情况时使用的一套预先制定的处理方案和步骤**。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/c7565171b9e8a8df4d1152c78cdac4b5_MD5.jpeg]]
比如，*在大促场景下*，我们可以*提前在代码中加入特性开关（Feature Switch），配合KV服务推送配置，控制黄条公告的展示，实现快速应急*。
![[_posts/base/知识目录、路线图/现代前端开发必知/media/c9aebed91b37c5f26000d4399a009d3c_MD5.jpeg]]

---

本期我们从编码质量、测试、攻击防御、稳定性四个方面介绍了前端的质量和安全性应该怎么去建设。

下一期我们进一步聊聊在本章中提到的持续集成和部署相关的话题。

