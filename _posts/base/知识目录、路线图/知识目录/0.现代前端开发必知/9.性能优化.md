【【现代前端开发必知09】你想要的性能优化方案都在这里了】 https://www.bilibili.com/video/BV1R9xNeaEsa/?share_source=copy_web&vd_source=9c1e19a73fa7bd23bb37aa8d7467d862


## 内容介绍
[00:00]


## 性能分析工具
[00:41]

通过性能分析工具，观察页面各阶段的耗时和性能指标，有针对性的进行优化，避免过早、过渡优化。

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/6e2b0ed51d7dbc28b6fde3745fddd2c4_MD5.jpeg]]
 
### Chrome DevTools
参考：[[performance、性能面板]]

Performance面板：
- Network栏中标红的资源（Render blocking），这些资源*会阻塞页面渲染*
- Timings栏中的性能指标FCP、LCP（时间戳）
- Main栏火焰图中标红的函数调用，表示*执行耗时较长的函数（Long Task）*，是我们排查低性能代码的重要途径

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/6fa079fd0da61a10063071e6fe0cafd7_MD5.jpeg]]

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/79c6430faf20f62c7f8254676cbab302_MD5.jpeg]]

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/856a9806129907cfd934f7626cd5d6e3_MD5.jpeg]]


## 性能问题
[01:27]
前端的性能问题，归结为三个方面：
- 页面加载时间太长 
- 交互过程不流畅 
- 资源消耗过度

### 页面加载时间太长
页面加载时间太长的原因：
- 资源体积过大 
- 网络延迟较高 
- 缺少缓存 
- 渲染受阻

#### 资源体积过大
[01:44]

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/18d00d0109a343bf803f7ea1958a1390_MD5.jpeg]]

##### 减小产物大小 
###### 压缩（Compression） 
###### 树摇（Tree Shaking）
###### 依赖外置（External Modules）

##### 减少传输量
![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/9de9cf3924ce93ab836b2a924390945e_MD5.jpeg]]

###### 代码拆分（Code Splitting）
###### 按需加载（Lazy Loading）
###### 服务端渲染（Server Side Rendering）
###### React服务器组件（React Server Component）
###### 流式渲染（Streaming Rendering）

###### 静态生成（Static Generation）
在构建阶段就生成好静态页面，用户直接访问静态页面，省掉了大量的客户端脚本。

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/b85c97865cfba29e083585ef6958793d_MD5.jpeg]]


#### 网络延迟较高
[02:42]

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/f22243c9983c7dba9ee354d6fd16f6ed_MD5.jpeg]]


##### HTTP/2、3 
启用HTTP/2协议提升网络并发传输效率

##### CDN 
使用CDN分发静态资源

##### 边缘计算 
在边缘计算节点部署无服务器（Serverless）应用

##### 浏览器资源提示 
- preload：
- prefetch：
- dns-prefetch：
- preconnect：

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/39182ab07508628271cbcc6641fe9595_MD5.jpeg]]


##### 图片优化
- 使用现代图片格式webp、avif
- 预渲染缩略图
- 在标准Img的*loading、fetchPriority、decoding、srcset属性上进行优化*

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/71b48d449996ed909c02f8a93346411c_MD5.jpeg]]


#### 缺少缓存
[03:28]

缓存分为两类：
- 本地缓存（Local Cache）：存储在用户设备（终端）
- 远端缓存（Remote Cache）：存储在服务设备（远端）

##### 本地缓存（Local Cache）

###### HTTP协议的缓存头

利用HTTP协议的缓存头，Cache-Control、Last-Modified、ETag等来协商缓存的存储方式

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/b619f28f3268505888b92ffaa9c821d6_MD5.jpeg]]

###### Web Storage API 
利用浏览器的存储API，如LocalStorage、IndexedDB来手动管理缓存

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/b57d15f51ad28b8861f1f8badab3bc2a_MD5.jpeg]]

###### Service Worker
利用Service Worker天生的缓存功能，来最大程度缩短页面加载时间


##### 远端缓存（Remote Cache）
在服务端、代理设备上，配置远端缓存，如*内存缓存、边缘缓存、网关缓存*


#### 渲染受阻
[04:25]

##### 异步加载JS（async或defer）
为了进一步缩短由于渲染过程带来的白屏窗口，将非关键的JS文件标记为异步加载（async或defer），来避免同步加载JS阻塞HTML解析。
![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/96ed97284b49845ac8f6a04917304ca5_MD5.jpeg]]

##### Web Worker
采用Web Worker、Web Assembly，将非常消耗计算资源的任务移出主线程，加速计算

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/57f9247c4427d566010a297aca11335f_MD5.jpeg]]

##### Web Assembly

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/86b2b69e4a45ac77835469d9b81247a8_MD5.jpeg]]

##### 针对SPA应用的优化
对于白屏时间较长的SPA单页应用，可以*在主文档的全局变量中，预写入数据，来减少首屏代码中的接口请求，加速页面渲染*。
![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/9c1cfd3619cd265bf69067caee8bb4e7_MD5.jpeg]]



### 交互过程不流畅
[05:18]

#### 海量的数据 
*海量数据的渲染场景*：长列表展示、大数据可视化。

###### 长列表展示
可以通过`分页（Pagination）`和`虚拟滚动（Virtual Scrolling）`技术，选择性渲染在用户可见范围内的元素，而不是整个列表。比如，Ant Design组件库的Select组件就使用了虚拟滚动技术。
![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/37c1f7b16bb90ebe5d91664e2944d485_MD5.jpeg]]

###### 大数据可视化
对于大数据可视化，可以借助数据抽样、分片渲染、Canvas渲染、WebGL加速，来分摊图形计算压力。许多开源图表库和2D、3D渲染引擎都支持Canvas和WebGL
![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/16f3e61872a2684f409dc6ce147d1117_MD5.jpeg]]

###### 离屏渲染（Offscreen Rendering）
通过离屏渲染（Offscreen Rendering），在屏幕外的缓冲区中进行图像合成，再一次性显示，减少屏幕卡顿和闪烁。

#### 大量的动画 
[06:16]
大量的动画需求，也是容易引起交互过程不流畅的重要因素。例如，许多页面会包含动效，特别是*大促、产品营销*场景。如果全部使用*未经优化的animation或JS动画，会显著影响页面的帧率（FPS*）。
![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/061ada1464e561be3810ccd479e4ef9c_MD5.jpeg]]

##### 开启CSS硬件加速
- 首先最基本的，应该多在动画上**使用带有硬件加速功能的CSS属性**，如*transform、opacity、perspective*等。
- 也可以**使用浏览器提供的requestAnimationFrame函数**。
- **使用开源动画方案**，如Lottie、Framer Motion等，它们都可以*提供不错的性能和效果*

#### 频繁的交互
[06:55]
许多用户在界面*反馈不及时*的情况下，会*更频繁地点击、输入、滑动*，严重时可能导致程序异常。

除了`防抖（Debounce）`和`节流（Throttle）`。还可以**利用UI框架提供的方案**：*React的useTransition、useDeferredValue、useOptimistic*；Vue的v-show、<KeepAlive/>组件

![[_posts/base/知识目录、路线图/知识目录/0.现代前端开发必知/media/fe69a9ec7a40fa987d08d72e05c68c68_MD5.jpeg]]


### 资源消耗过度
[07:20]
*导致资源消耗过度的因素*：不合理的资源加载、代码质量问题

#### 不合理的资源加载
不合理的资源加载，这里的资源包括*计算资源（CPU、内存占用）、网络资源（带宽、流量）、电池电量*等

**错误的构建设置、未经优化的静态资源、第三方库滥用、无效的缓存等，都会导致不合理的资源加载**。

要解决这些问题：
- 首先需要选择主流的应用框架，
- 其次是克制地使用第三方依赖，
- 使用分析工具了解构建产物的组成，去除或拆分过大的依赖包等



#### 代码质量问题
[08:01]





