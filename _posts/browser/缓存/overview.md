# 一、浏览器缓存的定义和基本概念

**浏览器缓存**是指浏览器将用户访问过的网页资源（如 HTML 文件、图片、CSS 样式表、JavaScript 脚本等）存储在本地计算机的临时存储区域中。*当用户再次访问相同的网页或者资源时，浏览器可以直接从缓存中获取这些资源，而不必再次从服务器下载。这样可以大大提高网页的加载速度，减少服务器的负载，同时也能节省用户的数据流量。*


# 二、缓存的位置

## 内存缓存（Memory Cache）

**内存缓存**是存储在计算机内存中的缓存。它的读取速度非常快，通常用于存储那些在浏览器*会话期间频繁使用的资源*。例如，当用户在一个网站的不同页面之间快速切换时，一些公共的脚本或者样式文件可能会被存储在内存缓存中。不过，*内存缓存的存储容量相对较小，并且当浏览器关闭后，内存缓存中的内容会被清除*。

## 磁盘缓存（Disk Cache）

**磁盘缓存**是存储在计算机硬盘中的缓存。*它的存储容量比内存缓存大得多*，可以存储大量的网页资源。*即使浏览器关闭后，磁盘缓存中的内容仍然存在*。当用户再次打开浏览器访问之前访问过的网页时，浏览器可以从磁盘缓存中获取资源。例如，一些不经常访问但之前访问过的网站的图片可能会存储在磁盘缓存中。

# 三、缓存的工作原理

1. **首次访问网页**
    - 当用户首次访问一个网页时，浏览器会向服务器发送请求，请求该网页及其相关资源（如图片、脚本等）。服务器接收到请求后，会将这些资源发送给浏览器。**浏览器在收到资源后，会根据资源的类型、缓存策略等因素决定**是否将这些资源存储在缓存中。
2. **再次访问网页**
    - 当用户再次访问同一个网页时，浏览器会首先检查本地缓存。*它会根据资源的 URL、缓存过期时间*等信息来判断缓存中的资源是否可用。如果缓存中的资源是可用的（没有过期且内容没有被修改），浏览器就会直接从缓存中加载资源，而不会向服务器发送请求。这样就大大提高了网页的加载速度。
    - 如果缓存中的资源不可用（例如*缓存已经过期*或者*服务器上的资源已经被更新*），浏览器就会向服务器发送请求，获取最新的资源，并更新缓存。
  

# 四、缓存策略

通常浏览器缓存策略分为两种：**强缓存**和**协商缓存**，并且缓存策略都是*通过设置 HTTP Header 来实现的*。

## 强缓存（Cache-Control 和 Expires）

- **Cache-Control**：这是一个 HTTP/1.1 头信息，用于控制缓存的行为。例如，`Cache-Control: max-age = 3600`表示资源在缓存中的有效时间为 3600 秒（1 小时）。*在这个时间内，浏览器可以直接从缓存中获取资源，而不必向服务器发送请求*。

- **Expires**：这是一个 HTTP/1.0 头信息，它指定了一个日期和时间，在此之后，缓存的资源被认为是过期的。*不过，Expires 的时间是基于服务器的时间来判断的，而如果服务器和客户端的时间不一致，**可能会导致缓存判断不准确***。相比之下，Cache-Control 的 max-age 是基于相对时间的，更加可靠。


## 协商缓存（Last-Modified 和 ETag）

- **Last-Modified**：服务器在响应资源时，会在响应头中添加 Last-Modified 字段，*该字段的值是资源最后一次修改的时间*。当浏览器再次请求该资源时，*会在请求头中带上 `If-Modified-Since` 字段*，其值为之前服务器返回的 Last-Modified 的值。服务器收到请求后，会比较资源的实际最后修改时间和 If-Modified-Since 的值。如果资源没有被修改，服务器会返回 304 Not Modified 状态码，告诉浏览器可以使用缓存中的资源。
- **ETag**：这是服务器为每个资源生成的一个唯一标识符，类似于**资源的指纹**。当浏览器再次请求资源时，*会在请求头中带上 `If-None-Match` 字段*，其值为之前服务器返回的 ETag 的值。服务器收到请求后，会比较资源的实际 ETag 和 If-None-Match 的值。如果两者相同，说明资源没有被修改，服务器会返回 304 Not Modified 状态码，允许浏览器使用缓存中的资源。


# 五、缓存的优点和缺点

1. **优点**
    - **提高性能**：通过减少对服务器的请求次数，能够显著加快网页的加载速度。例如，对于一个包含大量图片的网页，在第二次访问时，如果图片已经被缓存，浏览器可以直接从本地获取图片，而不是等待服务器逐个发送图片。
    - **节省网络资源**：减少了服务器的负载，节省了用户的数据流量。在移动设备上，这一点尤为重要，因为用户的数据流量是有限的。
2. **缺点**
    - **数据更新不及时**：如果缓存的过期时间设置过长或者缓存没有正确更新，用户可能会看到旧版本的网页内容。例如，一个新闻网站更新了一篇重要新闻，但由于用户的浏览器缓存没有及时更新，用户可能仍然看到旧的新闻内容。
    - **安全问题**：缓存可能会存储一些敏感信息，如用户的登录凭证等。如果缓存被恶意利用，可能会导致用户信息泄露。不过，现代浏览器通常会采取一些措施来保护敏感信息，如不缓存包含敏感信息的页面或者对缓存的数据进行加密等。

# 参考
[[13.浏览器缓存机制]]
