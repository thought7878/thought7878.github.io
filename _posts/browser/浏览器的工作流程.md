参考：[[04.导航流程：从输入URL到页面展示，这中间发生了什么？]]

浏览器从接收到用户请求到最终渲染页面的过程，*从输入URL到页面展示的全流程*，是一个复杂而有序的流程，涉及多个阶段和组件的协作。

以下是这一过程的详细分解：

### 1. **用户输入 URL**
用户在浏览器地址栏中输入 URL 或点击链接，触发页面加载请求。

---

### 2. **DNS 解析**
- 浏览器首先需要将域名（如 `www.example.com`）解析为 IP 地址。
- 浏览器会检查本地缓存（如 DNS 缓存、hosts 文件），如果没有找到，则向 DNS 服务器发起查询。
- DNS 服务器返回对应的 IP 地址。

---

### 3. **建立 TCP 连接**
- 浏览器通过 IP 地址与目标服务器建立 TCP 连接。
- 如果使用 HTTPS，还需要进行 TLS 握手，协商加密算法并验证证书。

---

### 4. **发送 HTTP 请求**
- 浏览器向服务器发送 HTTP 请求（通常是 GET 请求），请求的内容包括：
  - 请求行（如 `GET /index.html HTTP/1.1`）。
  - 请求头（如 `Host`、`User-Agent` 等）。
  - 可选的请求体（如 POST 请求中的数据）。

---

### 5. **服务器处理请求**
- 服务器接收到请求后，根据请求路径查找对应的资源（如 HTML 文件）。
- 如果是动态内容（如 PHP、Node.js），服务器会执行相应的脚本，生成 HTML 响应。

---

### 6. **接收响应**
- 服务器返回 HTTP 响应，包括：
  - 状态码（如 `200 OK`、`404 Not Found`）。
  - 响应头（如 `Content-Type`、`Cache-Control` 等）。
  - 响应体（通常是 HTML 文档）。

---

### 7. **解析 HTML**
- 浏览器开始解析 HTML 文档，逐步构建 DOM 树。
- 在解析过程中，如果遇到外部资源（如 CSS 文件、JavaScript 文件、图片等），会发起新的请求。

---

### 8. **解析 CSS 和 JavaScript**
#### （1）**CSS**
- 浏览器解析 CSS 文件，生成 CSSOM 树。
- CSSOM 树与 DOM 树结合，生成渲染树。

#### （2）**JavaScript**
- 如果遇到 `<script>` 标签，浏览器会暂停 HTML 解析（除非使用了 `async` 或 `defer` 属性）。
- 执行 JavaScript 代码，可能会修改 DOM 或 CSSOM。

---

### 9. **构建渲染树**
- 浏览器将 DOM 树和 CSSOM 树结合起来，生成渲染树。
- 渲染树只包含可见的元素，并包含了每个元素的样式信息。

---

### 10. **布局（Layout / Reflow）**
- 浏览器根据渲染树，计算每个元素的几何信息（如位置、大小）。
- 布局的结果决定了元素在页面中的具体排列方式。

---

### 11. **绘制（Paint）**
- 浏览器根据布局结果，将每个元素的内容绘制为像素。
- 绘制操作包括填充背景颜色、绘制边框、渲染文本等。

---

### 12. **合成（Composite）**
- 浏览器将多个图层按照层级关系叠加在一起，生成最终的页面图像。
- 合成操作通常由 GPU 完成，以提高性能。

---

### 13. **显示页面**
- 合成后的图像被发送到显示器，用户可以看到最终的页面效果。

---

### 14. **后续优化**
- **懒加载**：对于非关键资源（如图片、视频），浏览器可能会延迟加载。
- **缓存**：浏览器会缓存静态资源（如 HTML、CSS、JavaScript、图片），以便下次访问时更快加载。
- **异步加载**：对于某些资源（如 JavaScript 文件），可以通过 `async` 或 `defer` 属性实现异步加载，避免阻塞页面渲染。

---

### 关键点总结
- **网络请求**：DNS 解析、TCP 连接、HTTP 请求和响应。
- **资源解析**：HTML、CSS、JavaScript 的解析和执行。
- **渲染流程**：构建 DOM 树、CSSOM 树、渲染树，以及布局、绘制和合成。
- **用户体验**：通过懒加载、缓存和异步加载等技术优化页面加载速度。

---

### 性能优化建议
为了提升页面加载和渲染的性能，可以采取以下措施：
1. **减少 HTTP 请求**：合并文件、使用雪碧图（Sprite）等。
2. **压缩资源**：对 HTML、CSS、JavaScript 和图片进行压缩。
3. **使用 CDN**：通过内容分发网络加速资源加载。
4. **优化关键渲染路径**：减少阻塞渲染的资源，优先加载关键内容。
5. **启用缓存**：利用浏览器缓存和 HTTP 缓存机制。
6. **延迟加载**：对非关键资源使用懒加载。


