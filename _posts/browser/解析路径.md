# 浏览器如何解析静态资源的路径

当浏览器加载HTML页面时，需要正确解析页面中引用的CSS、JavaScript、图片等静态资源的路径。理解路径解析机制对前端开发非常重要。

## 基本路径类型

浏览器会根据路径的不同形式采用不同的解析策略：

### 1. 完整URL（绝对URL）
```html
<script src="https://example.com/js/script.js"></script>
```
- **解析方式**：直接使用，无需转换
- **特点**：包含协议、域名和完整路径

### 2. 协议相对URL
```html
<link rel="stylesheet" href="//example.com/css/style.css">
```
- **解析方式**：添加当前页面使用的协议（http或https）
- **示例**：
  - 如果当前页面是 `https://mydomain.com/blog`
  - 则资源路径变为 `https://example.com/css/style.css`

### 3. 绝对路径（根路径）
```html
<img src="/images/logo.png">
```
- **解析方式**：*从域名根目录开始*
- **示例**：
  - 当前页面：`https://example.com/blog/post.html`
  - 解析结果：`https://example.com/images/logo.png`

### 4. 相对路径
```html
<link rel="stylesheet" href="css/style.css">
```
- **解析方式**：*相对于当前文档所在目录*
- **示例**：
  - 当前页面：`https://example.com/blog/post.html`
  - 解析结果：`https://example.com/blog/css/style.css`

## 路径解析规则详解

### 相对路径的解析逻辑
浏览器会基于**当前文档的URL**（不是文件系统路径）来解析相对路径：

1. *如果路径以 `/` 开头：从域名根目录开始*
2. *如果路径不以 `/` 开头：相对于当前文档的**目录**（不是文件）*

> **注意**：`https://example.com/blog/post.html` 的目录是 `/blog/`，而 `https://example.com/blog/` 的目录也是 `/blog/`

### 特殊路径符号处理
- `.` 表示当前目录
- `..` 表示上一级目录
- 浏览器会规范化这些路径

**示例**：
- 当前页面：`https://example.com/a/b/c.html`
- 资源路径：`../../d/e/../f.css`
- 解析结果：`https://example.com/d/f.css`

## `<base>` 标签的影响

HTML中的`<base>`标签可以**全局改变所有相对路径的基准：**

```html
<head>
  <base href="https://cdn.example.com/static/">
</head>
<body>
  <img src="logo.png"> <!-- 实际请求: https://cdn.example.com/static/logo.png -->
  <link rel="stylesheet" href="css/main.css"> <!-- https://cdn.example.com/static/css/main.css -->
</body>
```

- `<base>`标签必须放在`<head>`中
- 同一页面只能有一个`<base>`标签
- 它会影响所有相对路径，包括`<a>`标签的href

## 实际解析过程

浏览器解析路径的步骤：

1. **确定基础URL**：
   - 优先使用`<base>`标签指定的URL
   - 若无`<base>`，则使用当前文档的URL

2. **解析给定路径**：
   - 完整URL：直接使用
   - 协议相对URL：添加当前协议
   - 绝对路径：替换基础URL的路径部分
   - 相对路径：与基础URL的路径部分结合

3. **规范化路径**：
   - 处理`.`和`..`
   - 进行必要的URL编码

## 常见陷阱与最佳实践

1. **开发环境与生产环境路径不一致**
   - 解决方案：使用相对路径或构建时替换

2. **SPA应用中的路径问题**
   - 使用`<base href="/">`确保路由正确

3. **CDN资源加载**
   - 协议相对URL (`//cdn.example.com/file.js`) 可避免混合内容警告

4. **路径大小写问题**
   - 服务器可能区分大小写（Linux系统），保持一致性

理解这些路径解析规则，能帮助你避免资源加载失败的问题，特别是在部署到不同环境时。